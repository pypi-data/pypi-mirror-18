/*
 * Copyright (c) AppDynamics Inc
 * All rights reserved
 */
option java_package = "com.appdynamics.controller.eventsvc.verifier";

option java_outer_classname = "DTO";

message ElasticSearchAccount {
    required string globalAccountName = 1;
    required string accessKey = 2;
}

enum DocType {
    event = 0;
    rsd = 1;
}

message VerificationQuery {
    required string esQuery = 1; // ElasticSearch DSL query string
    required string debugMsg = 2; // query filter object serialized in json
    required string location = 3; // code invocation location
    required DocType docType = 4; // docType
    required string expectedResult = 5; // expected result set converted from sql resultset, for count it's a number
    required int32 expectedResultCount = 6; // resultset count
    required ElasticSearchAccount account = 7; // account info
    required int64 sqlQueryTime = 8; // time taken for MySql
    repeated string includedFields = 9; // ES is in denormalized form, the expectedResult might contain partial doc
    optional bool countQuery = 10; // indicates if the query is count query or not
    repeated string excludeFields = 11; // if exclude fields are set, it won't check include fields
    repeated string includeFields = 12; // check included fields
    required string controllerHost = 13; // controller host name
    optional bool archiveOnly = 14; // query archive index only
    optional int64 timeHandle = 15; // when time bucket enabled, the handle (timestamp) where mysql stops
}

message ElasticSearchResult {
    required string actualResult = 1; // result from ElasticSearch
    required int64 esQueryTime = 2; // time taken to query ElasticSearch
}

// convenient utility for quick name field reference of the ElasticSearch document
enum EventFieldNames {
    ids = 0;
    subType = 1;
    severity = 2;
    eventType = 3;
    entityType = 4;
    timestampMsec = 5;
    linkedEntities = 6;
    triggeredEntity = 7;
}

enum VerificationResult {
    matchedRegular = 0;
    mismatchedRegular = 1;
    matchedCount = 2;
    mismatchedCount = 3;
}

message Difference {
    enum Missed {
        NONE = 0;
        EXPECTED = 1;
        ACTUAL = 2;
    }
    optional int64 objectId = 1;
    optional string fieldName = 2;
    optional Missed missed = 3;
    repeated int64 missingValues = 4;
}

message VerificationLog {
    repeated string summaries = 1;
    required VerificationQuery query = 2;
    required ElasticSearchResult result = 3;
    optional VerificationResult verification = 4;
    optional Difference difference = 5;
    optional string refCode = 6;
    optional int64 timestamp = 7;
}
