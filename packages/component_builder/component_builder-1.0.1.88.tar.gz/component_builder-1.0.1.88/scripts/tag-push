#! /bin/bash

export CLOUDSDK_PYTHON_SITEPACKAGES=1
STABLE_TAG=stable
DOCKER_CMD_AUTHED=${DOCKER_CMD_AUTHED:-"docker"}

docker tag $DOCKER_IMAGE:$DOCKER_TAG $REMOTE_DOCKER_PATH/$DOCKER_IMAGE:$DOCKER_TAG
docker tag $DOCKER_IMAGE:$DOCKER_TAG $REMOTE_DOCKER_PATH/$DOCKER_IMAGE:$STABLE_TAG

if [ -z ${DOCKER_PRE_PUSH+x} ]; then
    exec $DOCKER_PRE_PUSH
fi

exec $DOCKER_CMD_AUTHED push $REMOTE_DOCKER_PATH/$DOCKER_IMAGE:$DOCKER_TAG
exec $DOCKER_CMD_AUTHED push $REMOTE_DOCKER_PATH/$DOCKER_IMAGE:$STABLE_TAG

# TODO: Remove stable stuff from here. Have the caller decide
