<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">javascript/ievv_jsbase/http/QueryString.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ievv_jsbase</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/SignalHandlerSingleton.js~ReceivedSignalInfo.html">ReceivedSignalInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/SignalHandlerSingleton.js~SentSignalInfo.html">SentSignalInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/SignalHandlerSingleton.js~SignalHandlerSingleton.html">SignalHandlerSingleton</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeCustomError">makeCustomError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DuplicateReceiverNameForSignal">DuplicateReceiverNameForSignal</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ievv_jsbase/__testhelpers__</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/__testhelpers__/XMLHttpRequestMock.js~XMLHttpRequestMock.html">XMLHttpRequestMock</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ievv_jsbase/dom</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/dom/DOMReplace.js~DOMReplace.html">DOMReplace</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/dom/DOMReplaceFromUrl.js~DOMReplaceFromUrl.html">DOMReplaceFromUrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/dom/DOMReplaceWithSameElementFromUrl.js~DOMReplaceWithSameElementFromUrl.html">DOMReplaceWithSameElementFromUrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/dom/HtmlParser.js~HtmlParser.html">HtmlParser</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ievv_jsbase/http</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/http/HttpCookies.js~HttpCookies.html">HttpCookies</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/http/HttpDjangoJsonRequest.js~HttpDjangoJsonRequest.html">HttpDjangoJsonRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/http/HttpJsonRequest.js~JsonHttpRequest.html">JsonHttpRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/http/HttpJsonResponse.js~HttpJsonResponse.html">HttpJsonResponse</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/http/HttpRequest.js~HttpRequest.html">HttpRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/http/HttpResponse.js~HttpResponse.html">HttpResponse</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/http/QueryString.js~QueryString.html">QueryString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/http/UrlParser.js~UrlParser.html">UrlParser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HttpCookieNotFoundError">HttpCookieNotFoundError</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ievv_jsbase/log</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/log/AbstractLogger.js~AbstractLogger.html">AbstractLogger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/log/Logger.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/log/LoggerSingleton.js~LoggerSingleton.html">LoggerSingleton</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/log/loglevel.js~LogLevels.html">LogLevels</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ievv_jsbase/utils</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-onDocumentReady">onDocumentReady</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ievv_jsbase/widget</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/widget/AbstractWidget.js~AbstractWidget.html">AbstractWidget</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/javascript/ievv_jsbase/widget/WidgetRegistrySingleton.js~WidgetRegistrySingleton.html">WidgetRegistrySingleton</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ElementHasNoWidgetInstanceIdError">ElementHasNoWidgetInstanceIdError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ElementIsNotInitializedAsWidget">ElementIsNotInitializedAsWidget</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ElementIsNotWidgetError">ElementIsNotWidgetError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-InvalidWidgetAliasError">InvalidWidgetAliasError</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">javascript/ievv_jsbase/http/QueryString.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * Query-string creator and parser.
 *
 * @example &lt;caption&gt;Basics - build a querystring&lt;/caption&gt;
 * const querystring = new QueryString();
 * querystring.set(&apos;name&apos;, &apos;Peter&apos;);
 * querystring.setIterable(&apos;tags&apos;, [&apos;person&apos;, &apos;male&apos;]);
 * const encodedQuerystring = querystring.urlencode();
 * // encodedQuerystring === &apos;name=Peter&amp;tags=person&amp;tags=male&apos;  // order may vary
 *
 * @example &lt;caption&gt;Parse a querystring&lt;/caption&gt;
 * const querystring = new QueryString(&apos;name=Peter&amp;tags=person&amp;tags=male&apos;);
 * const name = querystring.get(&apos;name&apos;);
 * const tags = querystring.getArray(&apos;tags&apos;);
 * const firstTag = querystring.get(&apos;tags&apos;);
 *
 * @example &lt;caption&gt;Parse and modify a querystring&lt;/caption&gt;
 * const querystring = new QueryString(&apos;name=Peter&amp;tags=person&amp;tags=male&apos;);
 * querystring.set(&apos;name&apos;, &apos;John&apos;);
 * querystring.append(&apos;tags&apos;, &apos;important&apos;);
 * // querystring.urlencode() === &apos;name=John&amp;tags=person&amp;tags=male&amp;tags=important&apos;
 * querystring.setIterable(&apos;tags&apos;, [&apos;male&apos;]);
 * // querystring.urlencode() === &apos;name=John&amp;tags=male&apos;
 */
export default class QueryString {
    /**
     *
     * @param {string} querystring Optional input querystring to parse.
     */
    constructor(querystring) {
        this._queryStringMap = new Map();
        if(typeof querystring !== &apos;undefined&apos;) {
            if(typeof querystring !== &apos;string&apos;) {
                throw new TypeError(&apos;The querystring argument must be a string.&apos;)
            }
            this._parseQueryString(querystring);
        }
    }

    /**
     * Returns ``true`` if the querystring is empty, otherwise ``false``.
     *
     * @returns {boolean}
     */
    isEmpty() {
        return this._queryStringMap.size === 0;
    }

    /**
     * Remove all keys and values from the QueryString.
     */
    clear() {
        this._queryStringMap.clear();
    }

    _parseQueryStringItem(querystringItem) {
        const splitPair = querystringItem.split(&apos;=&apos;);
        const key = decodeURIComponent(splitPair[0]);
        const value = decodeURIComponent(splitPair[1]);
        this.append(key, value);
    }

    _parseQueryString(querystring) {
        const splitQueryString = querystring.split(&apos;&amp;&apos;);
        for(const querystringItem of splitQueryString) {
            this._parseQueryStringItem(querystringItem);
        }
    }

    _addToKey(key, value) {
        if(typeof key !== &apos;string&apos;) {
            throw new TypeError(&apos;All keys added to a QueryString must be strings.&apos;)
        }
        if(typeof value !== &apos;string&apos;) {
            throw new TypeError(&apos;All values added to a QueryString must be strings.&apos;)
        }
        this._queryStringMap.get(key).push(value);
    }

    _setKeyToEmptyArray(key) {
        this._queryStringMap.set(key, []);
    }

    /**
     * Set value from an iterable.
     *
     * @param {string} key The key to set.
     * @param iterable Something that can be iterated with a
     *      ``for(const value of iterable)`` loop.
     *      All the values in the iterable must be strings.
     *      If the iterable is empty the key will be removed
     *      from the QueryString.
     *
     * @example
     * const querystring = QueryString();
     * querystring.setIterable(&apos;names&apos;, [&apos;Peter&apos;, &apos;Jane&apos;]);
     */
    setIterable(key, iterable) {
        this._setKeyToEmptyArray(key);
        for(const value of iterable) {
            this._addToKey(key, value);
        }
        if(this._queryStringMap.get(key).length === 0) {
            this.remove(key);
        }
    }

    /**
     * Set a value.
     *
     * @param {string} key The key to store the value as.
     * @param {string} value The value to set.
     *
     * @example
     * const querystring = QueryString();
     * querystring.set(&apos;name&apos;, &apos;Peter&apos;);
     */
    set(key, value) {
        this.setIterable(key, [value]);
    }

    /**
     * Get a value.
     *
     * @param {string} key The key to get the value for.
     * @param {string} fallback An optional fallback value if the key is
     *      not in the QueryString. Defaults to ``undefined``.
     */
    get(key, fallback) {
        const value = this._queryStringMap.get(key);
        if(typeof value === &apos;undefined&apos;) {
            return fallback;
        } else {
            return value[0];
        }
    }

    /**
     * Append a value to a key.
     *
     * @param {string} key The key to append a value to.
     * @param {string} value The value to append.
     *
     * @example
     * const querystring = QueryString();
     * querystring.append(&apos;names&apos;, &apos;Jane&apos;);
     * querystring.append(&apos;names&apos;, &apos;Joe&apos;);
     * // querystring.urlencode() === &apos;names=Jane&amp;names=Joe&apos;
     */
    append(key, value) {
        if (!this._queryStringMap.has(key)) {
            this._setKeyToEmptyArray(key);
        }
        this._addToKey(key, value);
    }

    /**
     * Get the values for the specified key as an array.
     *
     * Always returns an array, even if the value was set
     * with {@link QueryString#set}.
     *
     * @param {string} key The key to get the values for.
     * @param {Array} fallback An optional fallback value if they
     *      key is not in the QueryString. Defaults to an empty array.
     * @returns {Array}
     */
    getArray(key, fallback) {
        if (this._queryStringMap.has(key)) {
            const valueArray = this._queryStringMap.get(key);
            return Array.from(valueArray);
        }
        if(typeof falback !== &apos;undefined&apos;) {
            return [];
        }
        return fallback;
    }

    /**
     * Remove the specified key from the QueryString.
     *
     * @param {string} key The key to remove.
     */
    remove(key) {
        this._queryStringMap.delete(key);
    }

    /**
     * Check if the QueryString contains the given key.
     *
     * @param {string} key The key to check for.
     * @returns {boolean}
     */
    has(key) {
        return this._queryStringMap.has(key);
    }

    _encodeKeyValue(key, value) {
        return `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;
    }

    /**
     * Get the QueryString object as a string in query-string format.
     *
     * @example
     * const querystring = QueryString();
     * querystring.set(&apos;next&apos;, &apos;/a&amp;b/&apos;);
     * querystring.set(&apos;name&apos;, &apos;john&apos;);
     * let urlEncodedQuerystring = querystring.urlencode();
     * // urlEncodedQuerystring === &apos;name=john&amp;next=%2Fa%26b%2F&apos;  // order may vary
     */
    urlencode() {
        let urlEncodedArray = [];
        for(let [key, valueArray] of this._queryStringMap) {
            for(const value of valueArray) {
                urlEncodedArray.push(this._encodeKeyValue(key, value));
            }
        }
        return urlEncodedArray.join(&apos;&amp;&apos;);
    }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
