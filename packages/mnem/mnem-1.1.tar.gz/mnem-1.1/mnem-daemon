#!/usr/bin/python2

from daemon.pidfile import PIDLockFile
from daemon import DaemonContext
from os.path import join, expanduser
from mnemcore import Mnem, Dzen2
import signal
import sys
import time

dzen2 = Dzen2()
mnem  = Mnem(join(expanduser('~'), '.mnem.data'), dzen2)

def reload(*args):
    mnem.load()

def exit(*args):
    sys.exit(0)

mnem_pid = PIDLockFile(
join(expanduser('~'), '.mnem.pid'))

context = DaemonContext(pidfile = mnem_pid, 
stdout = sys.stdout, stderr = sys.stderr, 
signal_map = {signal.SIGUSR1: reload, signal.SIGTERM: exit})

with context:
    print 'Daemon started.'
    mnem.mainloop()











