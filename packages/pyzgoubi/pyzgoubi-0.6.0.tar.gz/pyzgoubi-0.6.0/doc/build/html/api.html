<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>API Reference &mdash; PyZgoubi 0.6.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="PyZgoubi 0.6.0 documentation" href="index.html" />
    <link rel="prev" title="PyZgoubi Documentation" href="doc.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="doc.html" title="PyZgoubi Documentation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">PyZgoubi 0.6.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="api-reference">
<h1>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-zgoubi.core">
<span id="zgoubi-core"></span><h2><a class="reference internal" href="#module-zgoubi.core" title="zgoubi.core"><tt class="xref py py-mod docutils literal"><span class="pre">zgoubi.core</span></tt></a><a class="headerlink" href="#module-zgoubi.core" title="Permalink to this headline">¶</a></h2>
<p>This contains the main PyZgoubi classes: Line and Results</p>
<div class="section" id="zgoubi-core-line">
<h3><a class="reference internal" href="#zgoubi.core.Line" title="zgoubi.core.Line"><tt class="xref py py-class docutils literal"><span class="pre">zgoubi.core.Line</span></tt></a><a class="headerlink" href="#zgoubi-core-line" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="zgoubi.core.Line">
<em class="property">class </em><tt class="descclassname">zgoubi.core.</tt><tt class="descname">Line</tt><big>(</big><em>name</em><big>)</big><a class="headerlink" href="#zgoubi.core.Line" title="Permalink to this definition">¶</a></dt>
<dd><p>The Line object holds a series of elements, to represent an accelerator lattice.</p>
<dl class="method">
<dt id="zgoubi.core.Line.add">
<tt class="descname">add</tt><big>(</big><em>*elements</em><big>)</big><a class="headerlink" href="#zgoubi.core.Line.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an elements to the line. Can also be used to add one line into another.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.add_input_files">
<tt class="descname">add_input_files</tt><big>(</big><em>file_paths=None</em>, <em>pattern=None</em><big>)</big><a class="headerlink" href="#zgoubi.core.Line.add_input_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Add some extra input files to the directory where zgoubi is run.
This is useful for field map files.
file_paths can be a string:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">l</span><span class="o">.</span><span class="n">add_input_files</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>an iterable, for example a list:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">l</span><span class="o">.</span><span class="n">add_input_files</span><span class="p">([</span><span class="s1">&#39;map1&#39;</span><span class="p">,</span> <span class="s1">&#39;map2&#39;</span><span class="p">,</span> <span class="s1">&#39;map3&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>To add many files use a pattern eg:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">l</span><span class="o">.</span><span class="n">add_input_files</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;maps/*&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Will use symlinks when avaliable (Linux/UNIX), falls back to copying otherwise.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.check_line">
<tt class="descname">check_line</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Line.check_line" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that line has OBJET or MCOBJET at the start, and an END at the end. Gives warnings otherwise. Called by run() if in debug mode.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.clean">
<tt class="descname">clean</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Line.clean" title="Permalink to this definition">¶</a></dt>
<dd><p>clean up temp directories</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.elements">
<tt class="descname">elements</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Line.elements" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterator for elements in line, including sub lines.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.find_elements">
<tt class="descname">find_elements</tt><big>(</big><em>element</em><big>)</big><a class="headerlink" href="#zgoubi.core.Line.find_elements" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all the positions of element in line, treats sub lines as linear list</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.full_tracking">
<tt class="descname">full_tracking</tt><big>(</big><em>enable=True</em>, <em>drift_to_multi=False</em><big>)</big><a class="headerlink" href="#zgoubi.core.Line.full_tracking" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable full tracking on magnetic elements.
This works by setting IL=2 for any element with an IL parameter.
use line.full_tracking(False) to disable tracking
drift_to_multi=True replaces drifts with weak (B_1 = 1e-99) multipoles</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.get_objet">
<tt class="descname">get_objet</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Line.get_objet" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the OBJET element</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.insert">
<tt class="descname">insert</tt><big>(</big><em>index</em>, <em>*elements</em><big>)</big><a class="headerlink" href="#zgoubi.core.Line.insert" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert elements into the line before position given by index, treats sub lines as linear list</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.output">
<tt class="descname">output</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Line.output" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate the zgoubi.dat file, and return it as a string</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.prepend">
<tt class="descname">prepend</tt><big>(</big><em>*elements</em><big>)</big><a class="headerlink" href="#zgoubi.core.Line.prepend" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a elements to the start of the line</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.remove">
<tt class="descname">remove</tt><big>(</big><em>index</em><big>)</big><a class="headerlink" href="#zgoubi.core.Line.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove element at index, treats sub lines as linear list</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.remove_looping">
<tt class="descname">remove_looping</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Line.remove_looping" title="Permalink to this definition">¶</a></dt>
<dd><p>removes any REBELOTE elements from the line</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.replace">
<tt class="descname">replace</tt><big>(</big><em>elementold</em>, <em>elementnew</em>, <em>select_index=0</em><big>)</big><a class="headerlink" href="#zgoubi.core.Line.replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Replace an element in the line. setting select_index to n will replace the nth occurence of that item. If select index is not set, the first occurence is replaced.</p>
<p>Note: elementold must be the same instance as an element in the Line</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.run">
<tt class="descname">run</tt><big>(</big><em>xterm=False</em>, <em>tmp_prefix='/tmp'</em>, <em>silence=False</em>, <em>timer=False</em><big>)</big><a class="headerlink" href="#zgoubi.core.Line.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run zgoubi on line.
If xterm is true, stop after running zgoubi, and open an xterm for the user in the tmp dir. From here zpop can be run.
Returns a <a class="reference internal" href="#zgoubi.core.Results" title="zgoubi.core.Results"><tt class="xref py py-class docutils literal"><span class="pre">Results</span></tt></a> object</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.track_bunch">
<tt class="descname">track_bunch</tt><big>(</big><em>bunch</em>, <em>binary=False</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#zgoubi.core.Line.track_bunch" title="Permalink to this definition">¶</a></dt>
<dd><p>Track a bunch through a Line, and return the bunch. This function will uses the OBJET_bunch object, and so need needs a Line that does not already have a OBJET. If binary is true then particles are sent to zgoubi in binary (needs a version of zgoubi that supports this)</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Line.track_bunch_mt">
<tt class="descname">track_bunch_mt</tt><big>(</big><em>bunch</em>, <em>n_threads=4</em>, <em>max_particles=None</em>, <em>binary=False</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#zgoubi.core.Line.track_bunch_mt" title="Permalink to this definition">¶</a></dt>
<dd><p>This function should be used identically to the track_bunch function, apart from the addition of the n_threads argument. This will split the bunch into several slices and run them simultaneously. Set n_threads to the number of CPU cores that you have. max_particle can be set to limit how many particles are sent at a time.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="zgoubi-core-results">
<h3><a class="reference internal" href="#zgoubi.core.Results" title="zgoubi.core.Results"><tt class="xref py py-class docutils literal"><span class="pre">zgoubi.core.Results</span></tt></a><a class="headerlink" href="#zgoubi-core-results" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="zgoubi.core.Results">
<em class="property">class </em><tt class="descclassname">zgoubi.core.</tt><tt class="descname">Results</tt><big>(</big><em>line=None</em>, <em>rundir=None</em>, <em>element_types=None</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results" title="Permalink to this definition">¶</a></dt>
<dd><p>This class lets you analyse the results after running a line.</p>
<p>It is created automatically and returned by <a class="reference internal" href="#zgoubi.core.Line.run" title="zgoubi.core.Line.run"><tt class="xref py py-meth docutils literal"><span class="pre">Line.run()</span></tt></a></p>
<dl class="method">
<dt id="zgoubi.core.Results.b_fai">
<tt class="descname">b_fai</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.b_fai" title="Permalink to this definition">¶</a></dt>
<dd><p>return binary fai file as string</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.b_fai_fh">
<tt class="descname">b_fai_fh</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.b_fai_fh" title="Permalink to this definition">¶</a></dt>
<dd><p>return file handle for binary fai file</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.b_plt">
<tt class="descname">b_plt</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.b_plt" title="Permalink to this definition">¶</a></dt>
<dd><p>return binary plt file as string</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.b_plt_fh">
<tt class="descname">b_plt_fh</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.b_plt_fh" title="Permalink to this definition">¶</a></dt>
<dd><p>return file handle for binary plt file</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.check_bounds">
<tt class="descname">check_bounds</tt><big>(</big><em>file</em>, <em>min_bounds</em>, <em>max_bounds</em>, <em>coord='Y'</em>, <em>part_ids=None</em>, <em>assume_in_order=False</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.check_bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>read whole file. for each chunk, check if it is an element with bounds, if yes check if it is inside
record crashes, by particle id
min_bounds and max_bounds should be of the form {&#8216;label&#8217;: bound, &#8216;label&#8217;: bound}
returns numpy arrays
note: lost particles dont crash</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.clean">
<tt class="descname">clean</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.clean" title="Permalink to this definition">¶</a></dt>
<dd><p>clean up temp directory</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.dat">
<tt class="descname">dat</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.dat" title="Permalink to this definition">¶</a></dt>
<dd><p>return dat file as string</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.dat_fh">
<tt class="descname">dat_fh</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.dat_fh" title="Permalink to this definition">¶</a></dt>
<dd><p>return file handle for dat file</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.fai">
<tt class="descname">fai</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.fai" title="Permalink to this definition">¶</a></dt>
<dd><p>return fai file as string</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.fai_fh">
<tt class="descname">fai_fh</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.fai_fh" title="Permalink to this definition">¶</a></dt>
<dd><p>return file handle for fai file</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.get_all">
<tt class="descname">get_all</tt><big>(</big><em>file='plt'</em>, <em>id=None</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.get_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Read all the data out of the file.
Set file to plt or fai
if using the new headered data formats will return a numpy array with named columns, otherwise returns a list of dicts. each dict has the particle coordinates at a point</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.get_bunch">
<tt class="descname">get_bunch</tt><big>(</big><em>file</em>, <em>end_label=None</em>, <em>old_bunch=None</em>, <em>drop_lost=True</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.get_bunch" title="Permalink to this definition">¶</a></dt>
<dd><p>&#8220;Get back a bunch object from the fai file. It is recommended that you put a MARKER before the last FAISCNL, and pass its label as end_label, so that only the bunch at the final position will be returned. All but the final lap is ignored automatically.
Optionally the an old_bunch can be passed to the function, its mass and charge will be copyed to the new bunch.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.get_extremes">
<tt class="descname">get_extremes</tt><big>(</big><em>file</em>, <em>element_label=None</em>, <em>coord='Y'</em>, <em>id=None</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.get_extremes" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the max and min positions of a certain coordinate, in a certain element</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.get_track">
<tt class="descname">get_track</tt><big>(</big><em>file</em>, <em>coord_list</em>, <em>multi_list=None</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.get_track" title="Permalink to this definition">¶</a></dt>
<dd><p>returns a list of coordinates specified, and multiply them by the multiplier if not none
eg get_trac(&#8216;plt&#8217;, [&#8216;X&#8217;,&#8217;Y&#8217;,&#8217;element_label&#8217;],[0.01,0.01,None])</p>
<p>If all the columns requested are numerical, and new headered data formats are being used then this function will return a numpy array</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.get_transfer_matrix">
<tt class="descname">get_transfer_matrix</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.get_transfer_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a transfer matrix of the line in (MKSA units).
Needs a beam line is an OBJET type 5, and a MATRIX element.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.get_tune">
<tt class="descname">get_tune</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.get_tune" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a tuple (NU_Y, NU_Z) of the tunes.
Needs a beam line is an OBJET type 5, and a MATRIX element.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.get_twiss_parameters">
<tt class="descname">get_twiss_parameters</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.get_twiss_parameters" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Returns a tuple (beta_y, alpha_y, gamma_y, disp_y, disp_py, beta_z, alpha_z, gamma_z, disp_z, disp_pz) from </dt>
<dd>the twiss parameter matrix.</dd>
</dl>
<p>The results are stored a in structured numpy array containing the following elements</p>
<p>#Outputs
beta_y, alpha_y, gamma_y: horizontal Twiss parameters
beta_y, alpha_y, gamma_y: vertical Twiss parameters
disp_y, disp_py : horizontal dispersion and dispersion-prime
disp_z, disp_pz : vertical dispersion and dispersion-prime</p>
<p>Needs a beam line is an OBJET type 5, and a MATRIX element.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.impdev">
<tt class="descname">impdev</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.impdev" title="Permalink to this definition">¶</a></dt>
<dd><p>return impdev file as string</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.impdev_fh">
<tt class="descname">impdev_fh</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.impdev_fh" title="Permalink to this definition">¶</a></dt>
<dd><p>return file handle for impdev file</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.in_bounds">
<tt class="descname">in_bounds</tt><big>(</big><em>file</em>, <em>element_label</em>, <em>min_bound</em>, <em>max_bound</em>, <em>coord='Y'</em>, <em>verbose=False</em>, <em>id=None</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.in_bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>check if particle exceeded bounds in this element. pass bounds in zgoubi&#8217;s default unit for that coordinate</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.loss_summary">
<tt class="descname">loss_summary</tt><big>(</big><em>coords=None</em>, <em>file='plt'</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.loss_summary" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns False if no losses, otherwise returns a summery of losses</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">loss</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">loss_summary</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;plt&#39;</span><span class="p">)</span>
<span class="c1">#or</span>
<span class="nb">all</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="s1">&#39;plt&#39;</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">loss_summary</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span> <span class="c1"># if you already have got the coordinates</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.parse_matrix">
<tt class="descname">parse_matrix</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.parse_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse data from output of MATRIX element</p>
<p>Used by get_tune(), get_transfer_matrix() and get_twiss_parameters()</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.plt">
<tt class="descname">plt</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.plt" title="Permalink to this definition">¶</a></dt>
<dd><p>return plt file as string</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.plt_fh">
<tt class="descname">plt_fh</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.plt_fh" title="Permalink to this definition">¶</a></dt>
<dd><p>return file handle for plt file</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.res">
<tt class="descname">res</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.res" title="Permalink to this definition">¶</a></dt>
<dd><p>return res file as string</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.res_fh">
<tt class="descname">res_fh</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.res_fh" title="Permalink to this definition">¶</a></dt>
<dd><p>return file handle for res file</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.run_success">
<tt class="descname">run_success</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.run_success" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks that zgoubi completed</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.save_b_fai">
<tt class="descname">save_b_fai</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.save_b_fai" title="Permalink to this definition">¶</a></dt>
<dd><p>save binary fai file to path</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.save_b_plt">
<tt class="descname">save_b_plt</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.save_b_plt" title="Permalink to this definition">¶</a></dt>
<dd><p>save binary plt file to path</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.save_dat">
<tt class="descname">save_dat</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.save_dat" title="Permalink to this definition">¶</a></dt>
<dd><p>save dat file to path</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.save_fai">
<tt class="descname">save_fai</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.save_fai" title="Permalink to this definition">¶</a></dt>
<dd><p>save fai file to path</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.save_impdev">
<tt class="descname">save_impdev</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.save_impdev" title="Permalink to this definition">¶</a></dt>
<dd><p>save impdev file to path</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.save_plt">
<tt class="descname">save_plt</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.save_plt" title="Permalink to this definition">¶</a></dt>
<dd><p>save plt file to path</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.save_res">
<tt class="descname">save_res</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.save_res" title="Permalink to this definition">¶</a></dt>
<dd><p>save res file to path</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.save_spn">
<tt class="descname">save_spn</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#zgoubi.core.Results.save_spn" title="Permalink to this definition">¶</a></dt>
<dd><p>save spn file to path</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.show_particle_info">
<tt class="descname">show_particle_info</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.show_particle_info" title="Permalink to this definition">¶</a></dt>
<dd><p>show the particle info, a good check of energies, mass etc</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.spn">
<tt class="descname">spn</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.spn" title="Permalink to this definition">¶</a></dt>
<dd><p>return spn file as string</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.spn_fh">
<tt class="descname">spn_fh</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.spn_fh" title="Permalink to this definition">¶</a></dt>
<dd><p>return file handle for spn file</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.core.Results.test_rebelote">
<tt class="descname">test_rebelote</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.core.Results.test_rebelote" title="Permalink to this definition">¶</a></dt>
<dd><p>Return true if end of REBELOTE procedure reported
Needs a REBELOTE element.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-zgoubi.bunch">
<span id="zgoubi-bunch"></span><h2><a class="reference internal" href="#module-zgoubi.bunch" title="zgoubi.bunch"><tt class="xref py py-mod docutils literal"><span class="pre">zgoubi.bunch</span></tt></a><a class="headerlink" href="#module-zgoubi.bunch" title="Permalink to this headline">¶</a></h2>
<p>A bunch object to hold the coordinates for many particles</p>
<p>Note that all values are in SI units, m, rad, eV, s</p>
<dl class="class">
<dt id="zgoubi.bunch.Bunch">
<em class="property">class </em><tt class="descclassname">zgoubi.bunch.</tt><tt class="descname">Bunch</tt><big>(</big><em>nparticles=0</em>, <em>ke=None</em>, <em>rigidity=0</em>, <em>mass=0</em>, <em>charge=1</em>, <em>particles=None</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch" title="Permalink to this definition">¶</a></dt>
<dd><p>Object to store a bunch of particles efficiently using numpy.
All values are in SI units, m, rad, eV, s
Can be use to create a bunch of particles with all there coordinates set to zero (appart from the D coordinate which is set to 1):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">my_bunch</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">nparticles</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ke</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="n">PROTON_MASS</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>It can also be used to create a bunch from some existing coordinates stored in a numpy array:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">my_bunch</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">ke</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="n">PROTON_MASS</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">particles</span><span class="o">=</span><span class="n">existing_coords</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="zgoubi.bunch.Bunch.check_bunch">
<tt class="descname">check_bunch</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.check_bunch" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that the bunch is not empty, and contains finite values</p>
</dd></dl>

<dl class="staticmethod">
<dt id="zgoubi.bunch.Bunch.gen_gauss_x_xp_y_yp">
<em class="property">static </em><tt class="descname">gen_gauss_x_xp_y_yp</tt><big>(</big><em>npart</em>, <em>emit_y</em>, <em>emit_z</em>, <em>beta_y</em>, <em>beta_z</em>, <em>alpha_y</em>, <em>alpha_z</em>, <em>seed=None</em>, <em>ke=None</em>, <em>rigidity=0</em>, <em>mass=0</em>, <em>charge=1</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.gen_gauss_x_xp_y_yp" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a Gaussian bunch in x-xp (Y-T) and in y-yp (Z-P). S and D are set to 0 and 1 respectively.
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">my_bunch</span> <span class="o">=</span> <span class="n">Bunch</span><span class="o">.</span><span class="n">gen_kv_x_xp_y_yp</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">2e-2</span><span class="p">,</span> <span class="n">ke</span><span class="o">=</span><span class="mf">50e6</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="n">PROTON_MASS</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>creates a Gaussian bunch called my_bunch with 1000 particles of the given parameters.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="zgoubi.bunch.Bunch.gen_gauss_x_xp_y_yp_s_dp">
<em class="property">static </em><tt class="descname">gen_gauss_x_xp_y_yp_s_dp</tt><big>(</big><em>npart</em>, <em>emit_y</em>, <em>emit_z</em>, <em>beta_y</em>, <em>beta_z</em>, <em>alpha_y</em>, <em>alpha_z</em>, <em>mom_spread=0</em>, <em>bunch_length=0</em>, <em>disp=0</em>, <em>disp_prime=0</em>, <em>seed=None</em>, <em>ke=None</em>, <em>rigidity=0</em>, <em>mass=0</em>, <em>charge=1</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.gen_gauss_x_xp_y_yp_s_dp" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a Gaussian bunch in transverse and longitudinal phase space
emit_y, emit_z : horizontal and vertical plane geometric emittance (1 sigma)
beta_y, beta_z : horizontal and vertical betatron function
alpha_y, alpha_z : horizontal and vertical alpha
mom_spead : sigma of momentum spread (percentage) 
bunch_length : sigma of bunch length (metres)
disp, disp_prime : dispersion and dispersion prime (D&#8217;) in horizontal plane</p>
</dd></dl>

<dl class="staticmethod">
<dt id="zgoubi.bunch.Bunch.gen_halo_x_xp_y_yp">
<em class="property">static </em><tt class="descname">gen_halo_x_xp_y_yp</tt><big>(</big><em>npart</em>, <em>emit_y</em>, <em>emit_z</em>, <em>beta_y</em>, <em>beta_z</em>, <em>alpha_y</em>, <em>alpha_z</em>, <em>seed=None</em>, <em>ke=None</em>, <em>rigidity=0</em>, <em>mass=0</em>, <em>charge=1</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.gen_halo_x_xp_y_yp" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a halo bunch, i.e. an elipse outline in x-xp (Y-T) and in y-yp (Z-P). S and D are set to 0 and 1 respectively.
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">my_bunch</span> <span class="o">=</span> <span class="n">Bunch</span><span class="o">.</span><span class="n">gen_halo_x_xp_y_yp</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">2e-2</span><span class="p">,</span> <span class="n">ke</span><span class="o">=</span><span class="mf">50e6</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="n">PROTON_MASS</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>creates a halo bunch called my_bunch with 1000 particles of the given parameters.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="zgoubi.bunch.Bunch.gen_kv_x_xp_y_yp">
<em class="property">static </em><tt class="descname">gen_kv_x_xp_y_yp</tt><big>(</big><em>npart</em>, <em>emit_y</em>, <em>emit_z</em>, <em>beta_y</em>, <em>beta_z</em>, <em>alpha_y</em>, <em>alpha_z</em>, <em>seed=None</em>, <em>ke=None</em>, <em>rigidity=0</em>, <em>mass=0</em>, <em>charge=1</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.gen_kv_x_xp_y_yp" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a uniform (KV) bunch, i.e. a surface of a 4D hypershere in x-xp-y-yp (Y-T-Z-P). S and D are set to 0 and 1 respectively.
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">my_bunch</span> <span class="o">=</span> <span class="n">Bunch</span><span class="o">.</span><span class="n">gen_kv_x_xp_y_yp</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">2e-2</span><span class="p">,</span> <span class="n">ke</span><span class="o">=</span><span class="mf">50e6</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="n">PROTON_MASS</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>creates a KV bunch called my_bunch with 1000 particles of the given parameters.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="zgoubi.bunch.Bunch.gen_waterbag_x_xp_y_yp">
<em class="property">static </em><tt class="descname">gen_waterbag_x_xp_y_yp</tt><big>(</big><em>npart</em>, <em>emit_y</em>, <em>emit_z</em>, <em>beta_y</em>, <em>beta_z</em>, <em>alpha_y</em>, <em>alpha_z</em>, <em>seed=None</em>, <em>ke=None</em>, <em>rigidity=0</em>, <em>mass=0</em>, <em>charge=1</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.gen_waterbag_x_xp_y_yp" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a waterbag bunch, i.e. a filled hypersphere in x-xp-y-yp (Y-T-Z-P). S and D are set to 0 and 1 respectively.
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">my_bunch</span> <span class="o">=</span> <span class="n">Bunch</span><span class="o">.</span><span class="n">gen_waterbag_x_xp_y_yp</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">2e-2</span><span class="p">,</span> <span class="n">ke</span><span class="o">=</span><span class="mf">50e6</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="n">PROTON_MASS</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>creates a waterbag bunch called my_bunch with 1000 particles of the given parameters.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.get_bunch_ke">
<tt class="descname">get_bunch_ke</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.get_bunch_ke" title="Permalink to this definition">¶</a></dt>
<dd><p>Get bunch kinetic energy</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.get_bunch_rigidity">
<tt class="descname">get_bunch_rigidity</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.get_bunch_rigidity" title="Permalink to this definition">¶</a></dt>
<dd><p>Get bunch rigidity</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.get_centers">
<tt class="descname">get_centers</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.get_centers" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the center of the bunch in each dimension Y,T,Z,P,S,D</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.get_emittance">
<tt class="descname">get_emittance</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.get_emittance" title="Permalink to this definition">¶</a></dt>
<dd><p>return emittance h and v in m rad. Uses the bunch full width, so should only be used for a hard edge distribution</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.get_emittance_rms">
<tt class="descname">get_emittance_rms</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.get_emittance_rms" title="Permalink to this definition">¶</a></dt>
<dd><p>return emittance h and v in m rad. Uses the RMS quantities</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.get_min_BORO">
<tt class="descname">get_min_BORO</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.get_min_BORO" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the minimum rigidity of the bunch</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.get_twiss">
<tt class="descname">get_twiss</tt><big>(</big><em>emittance</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.get_twiss" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the twiss valuse Beta_h, Alpha_h, Beta_v, Alpha_v, calculated from bunch width extent</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.get_twiss_rms">
<tt class="descname">get_twiss_rms</tt><big>(</big><em>emittance</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.get_twiss_rms" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the rms twiss valuse Beta_h, Alpha_h, Beta_v, Alpha_v, calculated from bunch rms width</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.get_widths">
<tt class="descname">get_widths</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.get_widths" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the width of the bunch in each dimension Y,T,Z,P,S,D</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.get_widths_rms">
<tt class="descname">get_widths_rms</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.get_widths_rms" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the rms width of the bunch in each dimension Y,T,Z,P,S,D</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.particles">
<tt class="descname">particles</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.particles" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the numpy array that holds the coordinates, as a structured numpy array</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.plot">
<tt class="descname">plot</tt><big>(</big><em>fname=None</em>, <em>lims=None</em>, <em>add_bunch=None</em>, <em>fmt=None</em>, <em>longitudinal=True</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot a bunch, if no file name give plot is displayed on screen. lims can be used to force axis limits eg [lY,lT,lZ,lP,lX,lD] would plot limit plot from -lY to +lY in Y, etc. Additional bunches can be passed, as add_bunch, to overlay onto the same plot.
fmt can be a list of formats in matplotlib style, eg [&#8216;rx&#8217;, &#8216;bo&#8217;]</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.raw_particles">
<tt class="descname">raw_particles</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.raw_particles" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the numpy array that holds the coordinates, as a 2d numpy array and a list of comumn names. It is possible that the column names may change or reorder, so if you use this you may want to protect against it with something like</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">assert</span><span class="p">(</span><span class="n">pbunch</span><span class="o">.</span><span class="n">raw_particles</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">,</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span><span class="s2">&quot;T&quot;</span><span class="p">,</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span><span class="s2">&quot;P&quot;</span><span class="p">,</span><span class="s2">&quot;S&quot;</span><span class="p">,</span><span class="s2">&quot;TOF&quot;</span><span class="p">,</span><span class="s2">&quot;X&quot;</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="zgoubi.bunch.Bunch.read_YTZPSD">
<em class="property">static </em><tt class="descname">read_YTZPSD</tt><big>(</big><em>fname</em>, <em>ke=None</em>, <em>rigidity=0</em>, <em>mass=0</em>, <em>charge=1</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.read_YTZPSD" title="Permalink to this definition">¶</a></dt>
<dd><p>Read in a bunch from a file. assumes columns are Y, T, Z, P, X, D, separated by white space::
my_bunch = Bunch.read_YTZPSD(&#8220;mybunch.dat&#8221;, ke=1e9, mass=ELECTRON_MASS, charge=-1)</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.set_bunch_ke">
<tt class="descname">set_bunch_ke</tt><big>(</big><em>ke</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.set_bunch_ke" title="Permalink to this definition">¶</a></dt>
<dd><p>Set bunch kinetic energy</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.set_bunch_rigidity">
<tt class="descname">set_bunch_rigidity</tt><big>(</big><em>rigidity</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.set_bunch_rigidity" title="Permalink to this definition">¶</a></dt>
<dd><p>Set bunch rigidity</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.split_bunch">
<tt class="descname">split_bunch</tt><big>(</big><em>max_particles</em>, <em>n_slices</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.split_bunch" title="Permalink to this definition">¶</a></dt>
<dd><p>Split a bunch into n_slices smaller bunches, or more if they would have too many particles in.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.bunch.Bunch.write_YTZPSD">
<tt class="descname">write_YTZPSD</tt><big>(</big><em>fname</em>, <em>binary=False</em><big>)</big><a class="headerlink" href="#zgoubi.bunch.Bunch.write_YTZPSD" title="Permalink to this definition">¶</a></dt>
<dd><p>Output a bunch, compatible with read_YTZPSD</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-zgoubi.common">
<span id="zgoubi-common"></span><h2><a class="reference internal" href="#module-zgoubi.common" title="zgoubi.common"><tt class="xref py py-mod docutils literal"><span class="pre">zgoubi.common</span></tt></a><a class="headerlink" href="#module-zgoubi.common" title="Permalink to this headline">¶</a></h2>
<p>Common functions that can be used anywhere in pyzgoubi</p>
<dl class="function">
<dt id="zgoubi.common.mkdir_p">
<tt class="descclassname">zgoubi.common.</tt><tt class="descname">mkdir_p</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#zgoubi.common.mkdir_p" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a directory. Make parents if needed. Don&#8217;t raise error if it already exists</p>
<p>From: <a class="reference external" href="http://stackoverflow.com/questions/600268/mkdir-p-functionality-in-python">http://stackoverflow.com/questions/600268/mkdir-p-functionality-in-python</a> code by tzotzioy <a class="reference external" href="http://stackoverflow.com/users/6899/">http://stackoverflow.com/users/6899/</a></p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.common.open_file_or_name">
<tt class="descclassname">zgoubi.common.</tt><tt class="descname">open_file_or_name</tt><big>(</big><em>forn</em>, <em>mode='r'</em>, <em>mkdir=False</em><big>)</big><a class="headerlink" href="#zgoubi.common.open_file_or_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Pass either a filename or file handle like object. Returns a file like object</p>
<p>If mode is &#8216;w&#8217; or &#8216;a&#8217; then can set mkdir=True to make sure the directory is created if needed.</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.common.twiss_param_array">
<tt class="descclassname">zgoubi.common.</tt><tt class="descname">twiss_param_array</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#zgoubi.common.twiss_param_array" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to make the twiss param array used as input to get_twiss_profiles() or get_cell_properties_nonperiodic()</p>
<p>tp = twiss_param_array(beta_y=2, alpha_y=-1 ...)
all unspecified will be left at 0</p>
</dd></dl>

</div>
<div class="section" id="module-zgoubi.constants">
<span id="zgoubi-constants"></span><h2><a class="reference internal" href="#module-zgoubi.constants" title="zgoubi.constants"><tt class="xref py py-mod docutils literal"><span class="pre">zgoubi.constants</span></tt></a><a class="headerlink" href="#module-zgoubi.constants" title="Permalink to this headline">¶</a></h2>
<p>Some physical constants.</p>
<dl class="data">
<dt id="zgoubi.constants.ATOMIC_MASS_UNIT">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">ATOMIC_MASS_UNIT</tt><em class="property"> = 931494028.0</em><a class="headerlink" href="#zgoubi.constants.ATOMIC_MASS_UNIT" title="Permalink to this definition">¶</a></dt>
<dd><p>Atomic mass unit (eV)</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.ELECTRON_ANOM_MAG_MOM">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">ELECTRON_ANOM_MAG_MOM</tt><em class="property"> = 0.0011596521810999239</em><a class="headerlink" href="#zgoubi.constants.ELECTRON_ANOM_MAG_MOM" title="Permalink to this definition">¶</a></dt>
<dd><p>Electron anomalous magnetic moment</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.ELECTRON_CHARGE">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">ELECTRON_CHARGE</tt><em class="property"> = -1.60217653e-19</em><a class="headerlink" href="#zgoubi.constants.ELECTRON_CHARGE" title="Permalink to this definition">¶</a></dt>
<dd><p>Electron charge (C)</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.ELECTRON_MASS">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">ELECTRON_MASS</tt><em class="property"> = 510998.92</em><a class="headerlink" href="#zgoubi.constants.ELECTRON_MASS" title="Permalink to this definition">¶</a></dt>
<dd><p>Electron mass (eV)</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.ELECTRON_MEAN_LIFE">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">ELECTRON_MEAN_LIFE</tt><em class="property"> = 0</em><a class="headerlink" href="#zgoubi.constants.ELECTRON_MEAN_LIFE" title="Permalink to this definition">¶</a></dt>
<dd><p>Electron lifetime</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.MUON_ANOM_MAG_MOM">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">MUON_ANOM_MAG_MOM</tt><em class="property"> = 0.001165919800000026</em><a class="headerlink" href="#zgoubi.constants.MUON_ANOM_MAG_MOM" title="Permalink to this definition">¶</a></dt>
<dd><p>Muon anomalous magnetic moment</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.MUON_CHARGE">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">MUON_CHARGE</tt><em class="property"> = -1.60217653e-19</em><a class="headerlink" href="#zgoubi.constants.MUON_CHARGE" title="Permalink to this definition">¶</a></dt>
<dd><p>Muon charge (C)</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.MUON_MASS">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">MUON_MASS</tt><em class="property"> = 105658370.0</em><a class="headerlink" href="#zgoubi.constants.MUON_MASS" title="Permalink to this definition">¶</a></dt>
<dd><p>Muon mass (eV)</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.MUON_MEAN_LIFE">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">MUON_MEAN_LIFE</tt><em class="property"> = 2.197029e-06</em><a class="headerlink" href="#zgoubi.constants.MUON_MEAN_LIFE" title="Permalink to this definition">¶</a></dt>
<dd><p>Muon lifetime</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.PION_CHARGE">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">PION_CHARGE</tt><em class="property"> = 1.60217653e-19</em><a class="headerlink" href="#zgoubi.constants.PION_CHARGE" title="Permalink to this definition">¶</a></dt>
<dd><p>Pion charge (C)</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.PION_MASS">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">PION_MASS</tt><em class="property"> = 139570180.0</em><a class="headerlink" href="#zgoubi.constants.PION_MASS" title="Permalink to this definition">¶</a></dt>
<dd><p>Pion mass (eV)</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.PION_MEAN_LIFE">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">PION_MEAN_LIFE</tt><em class="property"> = 2.6033e-08</em><a class="headerlink" href="#zgoubi.constants.PION_MEAN_LIFE" title="Permalink to this definition">¶</a></dt>
<dd><p>Pion lifetime</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.PROTON_ANOM_MAG_MOM">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">PROTON_ANOM_MAG_MOM</tt><em class="property"> = 1.7928473505000002</em><a class="headerlink" href="#zgoubi.constants.PROTON_ANOM_MAG_MOM" title="Permalink to this definition">¶</a></dt>
<dd><p>Proton anomalous magnetic moment</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.PROTON_CHARGE">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">PROTON_CHARGE</tt><em class="property"> = 1.602176487e-19</em><a class="headerlink" href="#zgoubi.constants.PROTON_CHARGE" title="Permalink to this definition">¶</a></dt>
<dd><p>Proton charge (C)</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.PROTON_MASS">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">PROTON_MASS</tt><em class="property"> = 938272030.0</em><a class="headerlink" href="#zgoubi.constants.PROTON_MASS" title="Permalink to this definition">¶</a></dt>
<dd><p>Proton mass (eV)</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.PROTON_MEAN_LIFE">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">PROTON_MEAN_LIFE</tt><em class="property"> = 0</em><a class="headerlink" href="#zgoubi.constants.PROTON_MEAN_LIFE" title="Permalink to this definition">¶</a></dt>
<dd><p>Proton lifetime</p>
</dd></dl>

<dl class="data">
<dt id="zgoubi.constants.SPEED_OF_LIGHT">
<tt class="descclassname">zgoubi.constants.</tt><tt class="descname">SPEED_OF_LIGHT</tt><em class="property"> = 299792458</em><a class="headerlink" href="#zgoubi.constants.SPEED_OF_LIGHT" title="Permalink to this definition">¶</a></dt>
<dd><p>Speed of light (m/s)</p>
</dd></dl>

</div>
<div class="section" id="module-zgoubi.ellipse">
<span id="zgoubi-ellipse"></span><h2><a class="reference internal" href="#module-zgoubi.ellipse" title="zgoubi.ellipse"><tt class="xref py py-mod docutils literal"><span class="pre">zgoubi.ellipse</span></tt></a><a class="headerlink" href="#module-zgoubi.ellipse" title="Permalink to this headline">¶</a></h2>
<p>Algorithm by J. Scott Berg to find the smallest circle that enclose a set of ellipses that lie on the midplane.</p>
<dl class="class">
<dt id="zgoubi.ellipse.BestCircle">
<em class="property">class </em><tt class="descclassname">zgoubi.ellipse.</tt><tt class="descname">BestCircle</tt><a class="headerlink" href="#zgoubi.ellipse.BestCircle" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to allow one to find a circle enclosing a set of ellipses.
append((a, b, c)) adds an ellipse to the set of ellipses, where a is the
half width, b is the half height, and c is the horizontal center.</p>
<p>radius(z) returns the radius of a circle with horizontal center at z
which encloses all the ellipses.</p>
<p>get_circle() returns a sequence (z, r) giving the horizontal center z and
radius r of the smallest circle enclosing all of the ellipses</p>
<dl class="method">
<dt id="zgoubi.ellipse.BestCircle.append">
<tt class="descname">append</tt><big>(</big><em>e</em><big>)</big><a class="headerlink" href="#zgoubi.ellipse.BestCircle.append" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an ellipse e to the set of ellipses</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.ellipse.BestCircle.get_circle">
<tt class="descname">get_circle</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.ellipse.BestCircle.get_circle" title="Permalink to this definition">¶</a></dt>
<dd><p>Return (z,r), where z is the center and r is the radius of the
circle with the smallest radius that encloses all the ellipses</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.ellipse.BestCircle.radius">
<tt class="descname">radius</tt><big>(</big><em>z</em><big>)</big><a class="headerlink" href="#zgoubi.ellipse.BestCircle.radius" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the radius of a circle, centered at z, enclosing all of the
ellipses</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="zgoubi.ellipse.ivl_add">
<tt class="descclassname">zgoubi.ellipse.</tt><tt class="descname">ivl_add</tt><big>(</big><em>l</em>, <em>ivl</em><big>)</big><a class="headerlink" href="#zgoubi.ellipse.ivl_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the interval ivl=(min, max) to the interval list l</p>
</dd></dl>

</div>
<div class="section" id="module-zgoubi.exceptions">
<span id="zgoubi-execptions"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">zgoubi.execptions</span></tt><a class="headerlink" href="#module-zgoubi.exceptions" title="Permalink to this headline">¶</a></h2>
<p>Exceptions raised by PyZgoubi</p>
<dl class="exception">
<dt id="zgoubi.exceptions.BadFormatError">
<em class="property">exception </em><tt class="descclassname">zgoubi.exceptions.</tt><tt class="descname">BadFormatError</tt><a class="headerlink" href="#zgoubi.exceptions.BadFormatError" title="Permalink to this definition">¶</a></dt>
<dd><p>Can&#8217;t parse file format</p>
</dd></dl>

<dl class="exception">
<dt id="zgoubi.exceptions.BadLineError">
<em class="property">exception </em><tt class="descclassname">zgoubi.exceptions.</tt><tt class="descname">BadLineError</tt><a class="headerlink" href="#zgoubi.exceptions.BadLineError" title="Permalink to this definition">¶</a></dt>
<dd><p>Line not sufficient for this function</p>
</dd></dl>

<dl class="exception">
<dt id="zgoubi.exceptions.EmptyFileError">
<em class="property">exception </em><tt class="descclassname">zgoubi.exceptions.</tt><tt class="descname">EmptyFileError</tt><a class="headerlink" href="#zgoubi.exceptions.EmptyFileError" title="Permalink to this definition">¶</a></dt>
<dd><p>File contains no records</p>
</dd></dl>

<dl class="exception">
<dt id="zgoubi.exceptions.NoTrackError">
<em class="property">exception </em><tt class="descclassname">zgoubi.exceptions.</tt><tt class="descname">NoTrackError</tt><a class="headerlink" href="#zgoubi.exceptions.NoTrackError" title="Permalink to this definition">¶</a></dt>
<dd><p>No particle track</p>
</dd></dl>

<dl class="exception">
<dt id="zgoubi.exceptions.OldFormatError">
<em class="property">exception </em><tt class="descclassname">zgoubi.exceptions.</tt><tt class="descname">OldFormatError</tt><a class="headerlink" href="#zgoubi.exceptions.OldFormatError" title="Permalink to this definition">¶</a></dt>
<dd><p>Old file format passed to function that expects new format</p>
</dd></dl>

<dl class="exception">
<dt id="zgoubi.exceptions.ZgoubiRunError">
<em class="property">exception </em><tt class="descclassname">zgoubi.exceptions.</tt><tt class="descname">ZgoubiRunError</tt><a class="headerlink" href="#zgoubi.exceptions.ZgoubiRunError" title="Permalink to this definition">¶</a></dt>
<dd><p>Zgoubi hit a fatal error</p>
</dd></dl>

</div>
<div class="section" id="module-zgoubi.gcp">
<span id="zgoubi-gcp"></span><h2><a class="reference internal" href="#module-zgoubi.gcp" title="zgoubi.gcp"><tt class="xref py py-mod docutils literal"><span class="pre">zgoubi.gcp</span></tt></a><a class="headerlink" href="#module-zgoubi.gcp" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="zgoubi.gcp.GCPData">
<em class="property">class </em><tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">GCPData</tt><a class="headerlink" href="#zgoubi.gcp.GCPData" title="Permalink to this definition">¶</a></dt>
<dd><p>Subclass of numpy.ndarray to add an info field</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.cell_properties_table">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">cell_properties_table</tt><big>(</big><em>data</em>, <em>keys</em>, <em>sep='\t'</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.cell_properties_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Quick function for printing parameter tables, eg:</p>
<p>print gcp.cell_properties_table(data_arc, [&#8220;KE&#8221;, &#8220;stable&#8221;, &#8220;Y&#8221;, &#8220;T&#8221;, &#8220;NU_Y&#8221;, &#8220;NU_Z&#8221;])</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.get_cell_properties">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">get_cell_properties</tt><big>(</big><em>cell</em>, <em>min_ke</em>, <em>max_ke=None</em>, <em>ke_steps=1</em>, <em>particle=None</em>, <em>tol=1e-06</em>, <em>stop_at_first_unstable=False</em>, <em>closed_orbit_range=None</em>, <em>closed_orbit_range_count=None</em>, <em>closed_orbit_init_YTZP=None</em>, <em>reuse_co_coords=True</em>, <em>closed_orbit_debug=False</em>, <em>full_tracking=False</em>, <em>smart_co_search=False</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.get_cell_properties" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the closed orbits and basic properties of a periodic cell.</p>
<p>cell: A PyZgoubi Line object containing the beamline elements
min_ke, max_ke, ke_steps: kinetic energy in eV. For a single step just set min_ke
particle: &#8220;p&#8221;, &#8220;e&#8221;, &#8220;mu-&#8221;, &#8220;mu+&#8221;, or &#8220;Bismuth&#8221;
tol: tolerance when finding closed orbit
stop_at_first_unstable: If an energy is found to be unstable, give up
closed_orbit_range, closed_orbit_range_count, closed_orbit_init_YTZ: see zgoubi.utils.find_closed_orbit_range()
reuse_co_coords: use closed orbit from previous energy to start search for next energy
closed_orbit_debug: output debuging information
full_tracking=True is required in order get minimum and maximum magnetic fields along orbit</p>
<p>returns orbit_data, an array with ke_steps elements, with the following data
KE : particle KE in eV
stable, found_co, stable_tm_YT, stable_tm_ZP : boolean stability flags
Y, T, Z, P : closed orbit at start of cell, in cm and mrad
BETA_Y, BETA_Z, ALPHA_Y, ALPHA_Z, GAMMA_Y, GAMMA_Z, DISP_Y, DISP_Z, DISP_PY, DISP_PZ, NU_Y, NU_Z: periodic twiss functions
tof, S: time of flight and path length along closed orbit
matrix, matrix_trace_YT, matrix_trace_ZP: transfer matrix and traces
MAX_BY, MIN_BY, MAX_BZ, MIN_BZ: minimum and maximum fields seen along closed orbit (requires full_tracking=True)</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.get_cell_properties_nonperiodic">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">get_cell_properties_nonperiodic</tt><big>(</big><em>cell</em>, <em>min_ke</em>, <em>max_ke=None</em>, <em>ke_steps=1</em>, <em>particle=None</em>, <em>init_YTZP=None</em>, <em>init_twiss=None</em>, <em>full_tracking=False</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.get_cell_properties_nonperiodic" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the basic properties of a non-periodic cell.</p>
<p>Works similarly to get_cell_properties(), but rather than finding a periodic solution for closed orbit and twiss parameters, takes them as input:
init_YTZP: list of the Y, T, Z and P at the start of the cell
init_twiss: initial twiss params, use twiss_param_array() to create</p>
<p>cell: A PyZgoubi Line object containing the beamline elements
min_ke, max_ke, ke_steps: kinetic energy in eV. For a single step just set min_ke
particle: &#8220;p&#8221;, &#8220;e&#8221;, &#8220;mu-&#8221;, &#8220;mu+&#8221;, or &#8220;Bismuth&#8221;
full_tracking=True is required in order get minimum and maximum magnetic fields along orbit</p>
<p>returns orbit_data, an array with ke_steps elements, with the following data
KE : particle KE in eV
stable : boolean stability flags, always true, but useful for controlling which orbits are processed by other functions
Y0, T0, Z0, P0 : position and angles at start of cell, in cm and mrad
Y, T, Z, P : position and angles at end of cell, in cm and mrad
BETA_Y0, BETA_Z0, ALPHA_Y0, ALPHA_Z0, GAMMA_Y0, GAMMA_Z0, DISP_Y0, DISP_Z0, DISP_PY0, DISP_PZ0, NU_Y0, NU_Z0: twiss functions at start of cell
BETA_Y, BETA_Z, ALPHA_Y, ALPHA_Z, GAMMA_Y, GAMMA_Z, DISP_Y, DISP_Z, DISP_PY, DISP_PZ, NU_Y, NU_Z: twiss functions at end of cell
tof, S: time of flight and path length along closed orbit
matrix, matrix_trace_YT, matrix_trace_ZP: transfer matrix and traces
MAX_BY, MIN_BY, MAX_BZ, MIN_BZ: minimum and maximum fields seen along closed orbit (requires full_tracking=True)</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.get_cell_tracks">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">get_cell_tracks</tt><big>(</big><em>cell</em>, <em>data</em>, <em>particle</em>, <em>full_tracking=False</em>, <em>xterm=False</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.get_cell_tracks" title="Permalink to this definition">¶</a></dt>
<dd><p>Get tracks along the closed orbit for values in data
cell: periodic cell
data: the data structure return from get_cell_properties()
particle: see get_cell_properties()
full_tracking: record all steps in the magnet</p>
<p>tracks are added in the data structures ftrack and ptrack fields</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.get_dynamic_aperture">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">get_dynamic_aperture</tt><big>(</big><em>cell</em>, <em>data</em>, <em>particle</em>, <em>npass</em>, <em>nangles=3</em>, <em>tol=0.01</em>, <em>quick_mode=False</em>, <em>debug_log=None</em>, <em>island_avoid=0.01</em>, <em>start=1e-06</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.get_dynamic_aperture" title="Permalink to this definition">¶</a></dt>
<dd><p>Get Dynamic Aperture.</p>
<p>cell: the cell to run
data: data structure containing the closed orbit to be used initial conditions, see get_cell_properties()</p>
<p>tol: tolerance 0.01 give result to 1% precision
npass: number of passes through the cell
quick_mode: &#8220;+y+z&#8221; 1 particle at [dY,0,dZ,0]</p>
<blockquote>
<div>&#8220;+t+p&#8221; 1 particle at [0,dT,0,dP]
False:16 combinations of plus and minus offsets are used</div></blockquote>
<p>nangles: number of realspace angles to use. 1 will give the 45degree DA, i.e. with equal horizontal and vertical excitation, 2 will give pure horizontal (0 deg) and pure vertical (90deg), for other numbers will use numpy.linspace(0,pi/2,nangles).
island_avoid: when an unstable amplitude is found take a small step up, to see if it just a small island. set to zero to disable
debug_log: file name to write debug information to
start: starting emittance</p>
<p>From the starting emittance a search for the stability boundary is made.</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.get_phase_space">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">get_phase_space</tt><big>(</big><em>cell</em>, <em>data</em>, <em>particle</em>, <em>npass</em>, <em>emits=None</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.get_phase_space" title="Permalink to this definition">¶</a></dt>
<dd><p>Track particle for npass turns</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.get_tracks">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">get_tracks</tt><big>(</big><em>cell</em>, <em>start_YTZP</em>, <em>particle</em>, <em>ke</em>, <em>full_tracking=False</em>, <em>return_zgoubi_files=False</em>, <em>xterm=False</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.get_tracks" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a particle through a cell from a give starting point and return track from fai and plt files.</p>
<p>This is mostly used by other functions in this module, but can be useful for debugging a lattice</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.get_twiss_params">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">get_twiss_params</tt><big>(</big><em>cell</em>, <em>data</em>, <em>particle</em>, <em>output_prefix='results/twiss_profiles_'</em>, <em>full_tracking=False</em>, <em>calc_dispersion=False</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.get_twiss_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the periodic Twiss (Courant and Snyder) parameters for the cell. Tracks a bunch of particles containing pairs offset in each plane.</p>
<p>Must pass in data returned from get_cell_properties() to give initial conditions. The profile is added to the &#8216;twiss_profile&#8217; key in the data structure. If full_tracking is enabled, the Twiss parameters are every integration step are recorded, otherwise parameters are recorded at the end of each magnetic element.</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.part_info">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">part_info</tt><big>(</big><em>particle</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.part_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Look up a particle by name and return the zgoubi PARTICUL, mass and charge sign</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.plot_cell_properties">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">plot_cell_properties</tt><big>(</big><em>data</em>, <em>output_prefix='results/cell_'</em>, <em>file_fmt='.pdf'</em>, <em>ncells=1</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.plot_cell_properties" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce a set of standard plots from the data structure</p>
<p>data: the data structure returned by get_cell_properties()</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.plot_cell_tracks">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">plot_cell_tracks</tt><big>(</big><em>cell</em>, <em>data</em>, <em>particle</em>, <em>output_file='results/track.pdf'</em>, <em>show=False</em>, <em>plot_unstable=False</em>, <em>draw_field_midplane=False</em>, <em>sector_width=None</em>, <em>aspect='equal'</em>, <em>style=None</em>, <em>draw_tracks=True</em>, <em>min_y=None</em>, <em>max_y=None</em>, <em>y_steps=None</em>, <em>angle=0</em>, <em>plot_extents=None</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.plot_cell_tracks" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot particle track through cell, starting from in the closed orbits stored in data.</p>
<p>output_file: file to save plot
show: display plot to screen
plot_unstable: show tracks for initial coordinates marked as unstable in data structure
draw_field_midplane: show the magnet field on the magnet midplane
sector_width: width to draw sector magnets
aspect: &#8220;equal&#8221;, use same scale for x and y, &#8220;auto&#8221; stretch to fit
style: style for plotting, see lab_plot.LabPlot
draw_tracks: draw particle tracks
min_y, max_y, y_steps, angle: starting coordinates for test particles for sampling the midplane field
plot_extents: list of extents [left, right, bottom, top]</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.plot_dynamic_aperture">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">plot_dynamic_aperture</tt><big>(</big><em>cell</em>, <em>data</em>, <em>particle</em>, <em>npass</em>, <em>output_prefix='results/da_'</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.plot_dynamic_aperture" title="Permalink to this definition">¶</a></dt>
<dd><p>Make phase space plots showing dynamic aperture</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.plot_element_fields">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">plot_element_fields</tt><big>(</big><em>cell</em>, <em>min_y</em>, <em>max_y</em>, <em>y_steps</em>, <em>angle=None</em>, <em>output_prefix_rad='results/mag_field_rad_%s.pdf'</em>, <em>output_prefix_long=''</em>, <em>output_prefix_2d=''</em>, <em>rad_method='interp'</em>, <em>extra_test_range=0.5</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.plot_element_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots radial, longitudinal and 2d mid-plane magnetic field for each element, using high rigidity rays to sample field.</p>
<p>min_y, max_y, y_steps, angle set the starting positions and angle for the test rays
If angle=None, then 0 will be used for rectangular magnets, and AT/2 for sector magnets</p>
<p>output_prefix_rad, output_prefix_long, output_prefix_long should contain a &#8216;%s&#8217; that is replaced with the element label, eg
&#8220;results/mag_field_rad_%s.pdf&#8221;
output_prefix_long and output_prefix_2d will be skipped if they are left blank
The longitudinal profile is along the straight lines of the test rays, not the closed orbit.</p>
<p>For the radial plot method can be:
interp: points along a radial line are interpolated from a 2d profile
max: use the max field seen by the ray</p>
<p>extra_test_range factor to extend the range (min_y, max_y) for test particles, to improve interpolation edges</p>
<p>In 2d plots the trick of making rectangular magnets by using large radii is recognised for radii over 1e6cm</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.plot_twiss_params">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">plot_twiss_params</tt><big>(</big><em>data</em>, <em>output_prefix='results/twiss_profiles_'</em>, <em>fields=None</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.plot_twiss_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the Twiss profiles found with get_twiss_params()</p>
<p>fields: list of fields to plot, beta_y, beta_z, alpha_y, alpha_z, gamma_y, gamma_z, disp_y, disp_z, disp_py, disp_pz</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.profile1d">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">profile1d</tt><big>(</big><em>magnet</em>, <em>min_y</em>, <em>max_y</em>, <em>y_steps</em>, <em>angle=0</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.profile1d" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a 1d transverse horizontal (radial) profile of the magnet. At mid point, or ACN for DIPOLES. Used by plot_element_fields()</p>
<p>returns field, ys</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.profile2d">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">profile2d</tt><big>(</big><em>magnet</em>, <em>min_y</em>, <em>max_y</em>, <em>y_steps</em>, <em>angle=0</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.profile2d" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a 2d interpolated field profile. Used by plot_element_fields</p>
<p>returns a y_steps by y_steps grid of interpolated field values, and the extents of that grid:</p>
<blockquote>
<div>returns int_field, (xmin,xmax,ymin,ymax)</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="zgoubi.gcp.profile_get_tracks">
<tt class="descclassname">zgoubi.gcp.</tt><tt class="descname">profile_get_tracks</tt><big>(</big><em>magnet</em>, <em>min_y</em>, <em>max_y</em>, <em>y_steps</em>, <em>angle=0</em><big>)</big><a class="headerlink" href="#zgoubi.gcp.profile_get_tracks" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal function used by profile1d() and profile2d()</p>
</dd></dl>

</div>
<div class="section" id="module-zgoubi.io">
<span id="zgoubi-io"></span><h2><a class="reference internal" href="#module-zgoubi.io" title="zgoubi.io"><tt class="xref py py-mod docutils literal"><span class="pre">zgoubi.io</span></tt></a><a class="headerlink" href="#module-zgoubi.io" title="Permalink to this headline">¶</a></h2>
<p>Module to handle reading and writing of Zgoubi files</p>
<dl class="function">
<dt id="zgoubi.io.define_file">
<tt class="descclassname">zgoubi.io.</tt><tt class="descname">define_file</tt><big>(</big><em>fname</em>, <em>allow_lookup=False</em><big>)</big><a class="headerlink" href="#zgoubi.io.define_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Read header from a file and determine formating. Returns a dict that describes the file</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.io.listreplace">
<tt class="descclassname">zgoubi.io.</tt><tt class="descname">listreplace</tt><big>(</big><em>l</em>, <em>old</em>, <em>new</em><big>)</big><a class="headerlink" href="#zgoubi.io.listreplace" title="Permalink to this definition">¶</a></dt>
<dd><p>Replace all occurrences of &#8216;old&#8217; with &#8216;new&#8217; in &#8216;l&#8217;</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.io.read_file">
<tt class="descclassname">zgoubi.io.</tt><tt class="descname">read_file</tt><big>(</big><em>fname</em><big>)</big><a class="headerlink" href="#zgoubi.io.read_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a zgoubi output file. Return a numpy array with named column headers. The format is automatically worked out from the header information.</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.io.read_fortran_record">
<tt class="descclassname">zgoubi.io.</tt><tt class="descname">read_fortran_record</tt><big>(</big><em>fh</em><big>)</big><a class="headerlink" href="#zgoubi.io.read_fortran_record" title="Permalink to this definition">¶</a></dt>
<dd><p>Read 1 record from a fortran file</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.io.store_def_all">
<tt class="descclassname">zgoubi.io.</tt><tt class="descname">store_def_all</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.io.store_def_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Run define file on set of files, and output a code block that can be put into the to of this file to save rerunning define_file at program runtime</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.io.write_fortran_record">
<tt class="descclassname">zgoubi.io.</tt><tt class="descname">write_fortran_record</tt><big>(</big><em>fh</em>, <em>record</em><big>)</big><a class="headerlink" href="#zgoubi.io.write_fortran_record" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a record, adds record length to start and end</p>
</dd></dl>

</div>
<div class="section" id="module-zgoubi.lab_plot">
<span id="zgoubi-lab-plot"></span><h2><a class="reference internal" href="#module-zgoubi.lab_plot" title="zgoubi.lab_plot"><tt class="xref py py-mod docutils literal"><span class="pre">zgoubi.lab_plot</span></tt></a><a class="headerlink" href="#module-zgoubi.lab_plot" title="Permalink to this headline">¶</a></h2>
<p>Module for drawing plots of a lattice in lab coordinates</p>
<dl class="class">
<dt id="zgoubi.lab_plot.LabPlot">
<em class="property">class </em><tt class="descclassname">zgoubi.lab_plot.</tt><tt class="descname">LabPlot</tt><big>(</big><em>line</em>, <em>boro=None</em>, <em>sector_width=None</em>, <em>aspect='equal'</em>, <em>style=None</em><big>)</big><a class="headerlink" href="#zgoubi.lab_plot.LabPlot" title="Permalink to this definition">¶</a></dt>
<dd><p>A plotter for beam lines and tracks.</p>
<dl class="method">
<dt id="zgoubi.lab_plot.LabPlot.add_tracks">
<tt class="descname">add_tracks</tt><big>(</big><em>ftrack=None</em>, <em>ptrack=None</em>, <em>draw=1</em>, <em>field=1</em><big>)</big><a class="headerlink" href="#zgoubi.lab_plot.LabPlot.add_tracks" title="Permalink to this definition">¶</a></dt>
<dd><p>Add tracks from plt or fai files.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.lab_plot.LabPlot.draw">
<tt class="descname">draw</tt><big>(</big><em>draw_tracks=True</em>, <em>draw_field_points=False</em>, <em>draw_field_midplane=False</em>, <em>field_component='z'</em>, <em>field_steps=100</em>, <em>field_int_mode='kd'</em>, <em>plot_extents=None</em><big>)</big><a class="headerlink" href="#zgoubi.lab_plot.LabPlot.draw" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw the plot in memory, then use <a class="reference internal" href="#zgoubi.lab_plot.LabPlot.show" title="zgoubi.lab_plot.LabPlot.show"><tt class="xref py py-meth docutils literal"><span class="pre">show()</span></tt></a> to display to screen or <a class="reference internal" href="#zgoubi.lab_plot.LabPlot.save" title="zgoubi.lab_plot.LabPlot.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> to save to file.</p>
<p>plot_extents: list of extents [left, right, bottom, top]</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.lab_plot.LabPlot.save">
<tt class="descname">save</tt><big>(</big><em>fname</em><big>)</big><a class="headerlink" href="#zgoubi.lab_plot.LabPlot.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save plot to file, call <a class="reference internal" href="#zgoubi.lab_plot.LabPlot.draw" title="zgoubi.lab_plot.LabPlot.draw"><tt class="xref py py-meth docutils literal"><span class="pre">draw()</span></tt></a> first.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.lab_plot.LabPlot.set_style">
<tt class="descname">set_style</tt><big>(</big><em>style</em><big>)</big><a class="headerlink" href="#zgoubi.lab_plot.LabPlot.set_style" title="Permalink to this definition">¶</a></dt>
<dd><p>Style is a nested dictionary, that updates the defaults, eg:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;track&quot;</span><span class="p">:{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;g&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<p>Elements to be styled include &#8220;track&#8221;, &#8220;magnet_outline&#8221;, &#8220;element_outline&#8221;, &#8220;reference&#8221;. Each can take a &#8220;color&#8221;, &#8220;linestyle&#8221; and &#8220;linewidth&#8221;, using matplotlib notations.</p>
</dd></dl>

<dl class="method">
<dt id="zgoubi.lab_plot.LabPlot.show">
<tt class="descname">show</tt><big>(</big><big>)</big><a class="headerlink" href="#zgoubi.lab_plot.LabPlot.show" title="Permalink to this definition">¶</a></dt>
<dd><p>Display plot to screen, call <a class="reference internal" href="#zgoubi.lab_plot.LabPlot.draw" title="zgoubi.lab_plot.LabPlot.draw"><tt class="xref py py-meth docutils literal"><span class="pre">draw()</span></tt></a> first.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-zgoubi.rel_conv">
<span id="zgoubi-rel-conv"></span><h2><a class="reference internal" href="#module-zgoubi.rel_conv" title="zgoubi.rel_conv"><tt class="xref py py-mod docutils literal"><span class="pre">zgoubi.rel_conv</span></tt></a><a class="headerlink" href="#module-zgoubi.rel_conv" title="Permalink to this headline">¶</a></h2>
<p>All values in 
energy eV,
momentum eV/c,
mass ev/c**2,
speed c,
charge elementry charge</p>
<dl class="function">
<dt id="zgoubi.rel_conv.beta_to_gamma">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">beta_to_gamma</tt><big>(</big><em>beta</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.beta_to_gamma" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert speed to lorentz factor</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.beta_to_ke">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">beta_to_ke</tt><big>(</big><em>mass</em>, <em>beta</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.beta_to_ke" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert speed to kinetic energy</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.gamma_to_beta">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">gamma_to_beta</tt><big>(</big><em>gamma</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.gamma_to_beta" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert lorentz factor to speed</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.gamma_to_ke">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">gamma_to_ke</tt><big>(</big><em>mass</em>, <em>gamma</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.gamma_to_ke" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert lorentz factor to kinetic energy</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.ke_to_beta">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">ke_to_beta</tt><big>(</big><em>mass</em>, <em>ke</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.ke_to_beta" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert kinetic energy to speed</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.ke_to_gamma">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">ke_to_gamma</tt><big>(</big><em>mass</em>, <em>ke</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.ke_to_gamma" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert kinetic energy to lorentz factor</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.ke_to_mom">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">ke_to_mom</tt><big>(</big><em>mass</em>, <em>ke</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.ke_to_mom" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert kinetic energy to momentum</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.ke_to_rigidity">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">ke_to_rigidity</tt><big>(</big><em>mass</em>, <em>ke</em>, <em>charge</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.ke_to_rigidity" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert kinetic energy to magnetic rigitity</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.ke_to_te">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">ke_to_te</tt><big>(</big><em>mass</em>, <em>ke</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.ke_to_te" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert kinetic energy to total energy</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.mom_to_ke">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">mom_to_ke</tt><big>(</big><em>mass</em>, <em>mom</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.mom_to_ke" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert momentum to kinetic energy</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.mom_to_rigidity">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">mom_to_rigidity</tt><big>(</big><em>mom</em>, <em>charge</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.mom_to_rigidity" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert momentum to magnetic rigitity</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.mom_to_te">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">mom_to_te</tt><big>(</big><em>mass</em>, <em>mom</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.mom_to_te" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert momentum to total energy</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.rigidity_to_ke">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">rigidity_to_ke</tt><big>(</big><em>mass</em>, <em>rigidity</em>, <em>charge</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.rigidity_to_ke" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert magnetic rigitity to kinetic energy</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.rigidity_to_mom">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">rigidity_to_mom</tt><big>(</big><em>rigidity</em>, <em>charge</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.rigidity_to_mom" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert magnetic rigitity to momentum</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.te_to_ke">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">te_to_ke</tt><big>(</big><em>mass</em>, <em>te</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.te_to_ke" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert total energy to kinetic energy</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.rel_conv.te_to_mom">
<tt class="descclassname">zgoubi.rel_conv.</tt><tt class="descname">te_to_mom</tt><big>(</big><em>mass</em>, <em>te</em><big>)</big><a class="headerlink" href="#zgoubi.rel_conv.te_to_mom" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert total energy to momentum</p>
</dd></dl>

</div>
<div class="section" id="module-zgoubi.utils">
<span id="zgoubi-utils"></span><h2><a class="reference internal" href="#module-zgoubi.utils" title="zgoubi.utils"><tt class="xref py py-mod docutils literal"><span class="pre">zgoubi.utils</span></tt></a><a class="headerlink" href="#module-zgoubi.utils" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="zgoubi.utils.calc_area_simple">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">calc_area_simple</tt><big>(</big><em>ellipse</em>, <em>centre=(0</em>, <em>0)</em><big>)</big><a class="headerlink" href="#zgoubi.utils.calc_area_simple" title="Permalink to this definition">¶</a></dt>
<dd><p>can&#8217;t handle noise. finds closest and furthest point from centre, assumes they are a and b</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.calc_momentum_compaction">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">calc_momentum_compaction</tt><big>(</big><em>phase_slip</em>, <em>gamma_lorentz</em><big>)</big><a class="headerlink" href="#zgoubi.utils.calc_momentum_compaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a phase slip and Lorentz gamma, find momentum compaction factor and transition gamma</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.calc_phase_ad_from_matrix">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">calc_phase_ad_from_matrix</tt><big>(</big><em>trans_matrix</em><big>)</big><a class="headerlink" href="#zgoubi.utils.calc_phase_ad_from_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the phase advance (mu_y,mu_z) from a transfer matrix. Either use Results.get_transfer_matrix() or calc_transfer_matrix() to get matrix.</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.calc_phase_slip">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">calc_phase_slip</tt><big>(</big><em>line, tof_ref, del_p=0.0001, init_YTZP=[0, 0, 0, 0], tol_co=1e-06, D=1</em><big>)</big><a class="headerlink" href="#zgoubi.utils.calc_phase_slip" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate phase slip at relative momentum D (D=1 by default). Reference TOF must be supplied 
(tof_ref). Optionally set 
del_p: momentum shift
tol_co: adjust tolerance of find_closed_orbit calculation. 
init_YTZP: set initial guess in find_closed_orbit search.</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.calc_transfer_matrix">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">calc_transfer_matrix</tt><big>(</big><em>start_bunch</em>, <em>end_bunch</em><big>)</big><a class="headerlink" href="#zgoubi.utils.calc_transfer_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Track a bunch generated with OBJET5 through a line, and pass the start and end bunch to this function to calculate the twiss matrix. No unit conversion is done, so units match the passed bunch.
NOT COMPLETE:
only use cells in top 4 rows</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.calc_twiss_from_matrix">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">calc_twiss_from_matrix</tt><big>(</big><em>trans_matrix</em><big>)</big><a class="headerlink" href="#zgoubi.utils.calc_twiss_from_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the twiss parameters (beta_y, alpha_y, gamma_y, beta_z, alpha_z, gamma_z) from a transfer matrix. Either use Results.get_transfer_matrix() or calc_transfer_matrix() to get matrix.</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.coords_grid">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">coords_grid</tt><big>(</big><em>min_c=None</em>, <em>max_c=None</em>, <em>step=None</em>, <em>dtype=&lt;type 'float'&gt;</em><big>)</big><a class="headerlink" href="#zgoubi.utils.coords_grid" title="Permalink to this definition">¶</a></dt>
<dd><p>make a list of coordinate aranged in a grid in a generalised space eg:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">coords_grid</span><span class="p">(</span><span class="n">min_c</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">max_c</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">step</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
<p>will give you 100 points in 2 dimensions between 0 and 1</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.emittance_to_coords">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">emittance_to_coords</tt><big>(</big><em>emit_horizontal</em>, <em>emit_vertical</em>, <em>alphayz</em>, <em>betayz</em>, <em>beta_gamma_input=1</em>, <em>ncoords=1</em><big>)</big><a class="headerlink" href="#zgoubi.utils.emittance_to_coords" title="Permalink to this definition">¶</a></dt>
<dd><p>Given some emittance in horizonal and vertical space</p>
<p>If ncoords &lt;= 1 return points where phase space ellipse crosses the y,y&#8217; and z,z&#8217; axis.</p>
<dl class="docutils">
<dt>If ncoords &gt; 1, will instead give a distribution of points (y,t) around the phase space ellipse uniform in angle theta where::</dt>
<dd>y = a*cos(theta)*cos(phi) - b*sin(theta)*sin(phi)
t = a*cos(theta)*sin(phi) + b*sin(theta)*cos(phi)</dd>
</dl>
<p>where (a,b) are major and minor radii and phi is the tilt of the major radius w.r.t horizontal axis. A (z,p) distribution is 
similarly calculated.</p>
<p>Can use these points, returned in coords_YTZP to start tracking at the desired emittance (assuming that the optical functions don&#8217;t change with amplitude).</p>
<p>Emittances in both the horizontal and vertical planes may be supplied. Twiss parameters beta and gamma in 
both places may be determined calling get_twiss_parameters beforehand i.e.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">twissparam</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get_twiss_parameters</span><span class="p">()</span>
<span class="n">betayz</span> <span class="o">=</span> <span class="p">[</span><span class="n">twissparam</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">twissparam</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span>
<span class="n">gammayz</span> <span class="o">=</span> <span class="p">[</span><span class="n">twissparam</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">twissparam</span><span class="p">[</span><span class="mi">7</span><span class="p">]]</span>
</pre></div>
</div>
<p>Note coords are returned in &#8216;Zgoubi units&#8217;, i.e. cm and mrad</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.find_centre">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">find_centre</tt><big>(</big><em>ellipse</em><big>)</big><a class="headerlink" href="#zgoubi.utils.find_centre" title="Permalink to this definition">¶</a></dt>
<dd><p>find centre by using mean of coords, this assumes that point are evenly distributed around ellipse</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.find_closed_orbit">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">find_closed_orbit</tt><big>(</big><em>line</em>, <em>init_YTZP=None</em>, <em>max_iterations=100</em>, <em>fai_label=None</em>, <em>tol=1e-06</em>, <em>D=1</em>, <em>record_fname=None</em>, <em>plot_search=False</em>, <em>extra_iterations=2</em><big>)</big><a class="headerlink" href="#zgoubi.utils.find_closed_orbit" title="Permalink to this definition">¶</a></dt>
<dd><p>Find a closed orbit for the line. can optionally give a list of initial coordinates, init_YTZP, eg:
find_closed_orbit(line, init_YTZP=[1.2,2.1,0,0])
otherwise [0,0,0,0] are used.</p>
<p>The line is expected to have a OBJET2 and either a FAISCNL at the end or, using FAISTORE, a MARKER at the end of the cell identified by fai_label. The latter option allows the zgoubi.fai file to contain coordinates throughout the lattice while using just those points with fai_label in this function.</p>
<p>It is recommend to have a REBELOTE, with several laps. The area of the phase space ellipse is approximated from the coordinates from the FAISCNL (or MARKER with fai_label), and the center is used for the new coordinates. Once the relative variation between iterations is less that the tolerance, the function returns the closed orbit coordinates. If a coordinate is close to zero (less than the tolerance) then it is compared absolutely instead of relatively.</p>
<p>record_fname is used to record search details to a file that can be used with plot_find_closed_orbit().
extra_iterations allows some extra iterations to improve accuracy, even after tolerance reached</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.find_closed_orbit_range">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">find_closed_orbit_range</tt><big>(</big><em>line</em>, <em>init_YTZP=None</em>, <em>max_iterations=100</em>, <em>fai_label=None</em>, <em>tol=1e-06</em>, <em>D=1</em>, <em>range_YTZP=None</em>, <em>count_YTZP=None</em>, <em>record_fname=None</em>, <em>extra_iterations=2</em><big>)</big><a class="headerlink" href="#zgoubi.utils.find_closed_orbit_range" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as find_closed_orbit, but if init_YTZP is unstable, will generate a bunch or particles, with a spread of range_YTZP, and if any of those are stable will do a closed orbit search with that particle:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">init_YTZP</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">range_YTZP</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">count_YTZP</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>will vary the Y coordinate from -5 to 15 cm in 50 steps:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">range_YTZP</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">count_YTZP</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>would create 100 particles in a grid.</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.find_indices">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">find_indices</tt><big>(</big><em>a_list</em>, <em>list_element</em><big>)</big><a class="headerlink" href="#zgoubi.utils.find_indices" title="Permalink to this definition">¶</a></dt>
<dd><p>Find all occurences of list_element in list. Return the indices.</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.flatten">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">flatten</tt><big>(</big><em>sequence</em><big>)</big> &rarr; list<a class="headerlink" href="#zgoubi.utils.flatten" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a single, flat list which contains all elements retrieved
from the sequence and all recursively contained sub-sequences
(iterables).</p>
<p><a class="reference external" href="http://kogs-www.informatik.uni-hamburg.de/~meine/python_tricks">http://kogs-www.informatik.uni-hamburg.de/~meine/python_tricks</a></p>
<p>Examples:
&gt;&gt;&gt; [1, 2, [3,4], (5,6)]
[1, 2, [3, 4], (5, 6)]
&gt;&gt;&gt; flatten([[[1,2,3], (42,None)], [4,5], [6], 7, MyVector(8,9,10)])
[1, 2, 3, 42, None, 4, 5, 6, 7, 8, 9, 10]</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.fourier_tune">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">fourier_tune</tt><big>(</big><em>line</em>, <em>initial_YTZP</em>, <em>D_in</em>, <em>nfourierturns</em>, <em>plot_fourier=False</em>, <em>coords=None</em><big>)</big><a class="headerlink" href="#zgoubi.utils.fourier_tune" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate tune using FFT. nfourierturns determines the number of passes through the lattice.
Can supply set of horizontal and vertical coordinates in coords = [ycoords,zcoords], otherwise</p>
<blockquote>
<div>routine will calculate coordinates</div></blockquote>
<p>Set plot_fourier= True to show Fourier spectrum. Default is False</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.gaussian_cutoff">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">gaussian_cutoff</tt><big>(</big><em>npoints</em>, <em>mean</em>, <em>sigma</em>, <em>sigma_cutoff</em>, <em>seed=None</em><big>)</big><a class="headerlink" href="#zgoubi.utils.gaussian_cutoff" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate Gaussian distribution about mean with standard deviation sigma
npoints - number of points in distribution required
sigma_cutoff - the cutoff factor i.e. points outside sigma*sigma_cutoff eliminated</p>
<p>Seed - Optional parameter to set random seed</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.get_cmd_param">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">get_cmd_param</tt><big>(</big><em>key</em>, <em>default=None</em><big>)</big><a class="headerlink" href="#zgoubi.utils.get_cmd_param" title="Permalink to this definition">¶</a></dt>
<dd><p>get things formated like key=value from the commandline. returns the requested value</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.get_cmd_param_bool">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">get_cmd_param_bool</tt><big>(</big><em>key</em>, <em>default=None</em><big>)</big><a class="headerlink" href="#zgoubi.utils.get_cmd_param_bool" title="Permalink to this definition">¶</a></dt>
<dd><p>get things formated like key=value from the commandline.
returns true for: yes, on, true, 1
returns false for: no, off, false, 0
case insensitve</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.get_enclosing_circle">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">get_enclosing_circle</tt><big>(</big><em>ellipse_data</em><big>)</big><a class="headerlink" href="#zgoubi.utils.get_enclosing_circle" title="Permalink to this definition">¶</a></dt>
<dd><p>Find smallest circle that encloses a set of ellipses centred on the midplane. The ellipses are defined by their horizontal and vertical radii and by their centre along the horizontal axis (a,b,c). The algorithm optimised both the centre of the enclosing circle and its radius.</p>
<p>Ellipse algorithm by J. Scott Berg (BNL)</p>
<p>Reference - J. Scott Berg. &#8216;Finding the Circular Magnet Aperture which Encloses and Arbitrary number of midplace-centered Beam Ellipses&#8217;, Proc. EPAC04, 5-9 July, Lucerne Congress Centre, Lucerne, Switzerland</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.get_twiss_profiles">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">get_twiss_profiles</tt><big>(</big><em>line</em>, <em>file_result=None</em>, <em>input_twiss_parameters=None</em>, <em>calc_dispersion=True</em>, <em>interpolate=True</em><big>)</big><a class="headerlink" href="#zgoubi.utils.get_twiss_profiles" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the twiss parameters at all points written to zgoubi.plt. 11 particle trajectories are used to calculate the
transfer matrix, just as is done in zgoubi. The code mirrors that found in mat1.f, mksa.f. The twiss parameters are first
calculated at the end of the cell using either input_twiss_parameters (format given below) or, if this is not supplied, 
it assumes the cell is periodic and uses get_twiss_parameters to find the boundary condition.</p>
<p>The optional input_twiss_parameters should be supplied in the form of a numpy structured array containing the following information at
the start of the cell
[beta_y, alpha_y, gamma_y, disp_y, disp_py, beta_z, alpha_z, gamma_z, disp_z, disp_pz]
This is the same format as the output of get_twiss_parameters allowing one to conveniently obtain twiss parameters at the end of one section
of beam line and apply them as starting conditions for the next section, i.e.</p>
<p>r = line1.run()
twiss_line1 = r.get_twiss_parameters()
twiss_profiles = get_twiss_profiles(line2, input_twiss_parameters = twiss_line1)</p>
<p>Dispersion and dispersion-prime are also calculated if calc_dispersion is True (default).</p>
<p>interpolate: If a azimuthal coordinate X exists, interpolate onto the reference X. X is azimuthal angle in the case of radial elements.</p>
<p>The results are stored a in structured numpy array called twiss_profiles containing the following elements at every point tracked in the magnets 
(i.e. a point in zgoubi.plt)
[s_coord, label,  mu_y, beta_y, alpha_y, gamma_y, disp_y, disp_py, mu_z, beta_z, alpha_z, gamma_z, disp_z, disp_p]</p>
<p>The results are also stored in file specified by file_result (optional)</p>
<p>Requires an OBJET type 5, and a MATRIX element.</p>
<p>Note - This calculation uses trajectories as measured in the local coordinate system of the magnet.</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.ke_to_relativistic_beta">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">ke_to_relativistic_beta</tt><big>(</big><em>ke</em>, <em>mass</em><big>)</big><a class="headerlink" href="#zgoubi.utils.ke_to_relativistic_beta" title="Permalink to this definition">¶</a></dt>
<dd><p>ke in eV, mass in eV/c^2</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.ke_to_relativistic_beta_gamma">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">ke_to_relativistic_beta_gamma</tt><big>(</big><em>ke</em>, <em>mass</em><big>)</big><a class="headerlink" href="#zgoubi.utils.ke_to_relativistic_beta_gamma" title="Permalink to this definition">¶</a></dt>
<dd><p>ke in eV, mass in eV/c^2</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.ke_to_rigidity">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">ke_to_rigidity</tt><big>(</big><em>ke</em>, <em>mass</em><big>)</big><a class="headerlink" href="#zgoubi.utils.ke_to_rigidity" title="Permalink to this definition">¶</a></dt>
<dd><p>ke in eV, mass in eV/c^2
gives result in kGauss cm, which is handy for OBJET</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.misalign_element">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">misalign_element</tt><big>(</big><em>line</em>, <em>element_indices</em>, <em>mean</em>, <em>sigma</em>, <em>sigma_cutoff</em>, <em>misalign_dist=None</em>, <em>seed=None</em><big>)</big><a class="headerlink" href="#zgoubi.utils.misalign_element" title="Permalink to this definition">¶</a></dt>
<dd><p>Misalign the set of elements identified by element_indices. The misalignment is Gaussian
with sigma, sigma_cutoff and mean among the input parameters. If sigma = 0.0, the misalignment is constant 
and given by mean</p>
<p>Alternatively, misalignments specified by list misalign_dist</p>
<p>Returns the misailgnment distribution (misalign_dist), unit meters</p>
<p>element_indices can be determined using line.find_elements(element_name)</p>
<p>mean and sigma should be input in meters</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.mom_to_ke">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">mom_to_ke</tt><big>(</big><em>mom</em>, <em>mass</em><big>)</big><a class="headerlink" href="#zgoubi.utils.mom_to_ke" title="Permalink to this definition">¶</a></dt>
<dd><p>mom in eV/c
gives results in eV</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.mom_to_rigidity">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">mom_to_rigidity</tt><big>(</big><em>mom</em><big>)</big><a class="headerlink" href="#zgoubi.utils.mom_to_rigidity" title="Permalink to this definition">¶</a></dt>
<dd><p>mom in eV/c
gives result in kGauss cm, which is handy for OBJET</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.plot_data_xy_multi">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">plot_data_xy_multi</tt><big>(</big><em>data_x_list</em>, <em>data_y_list</em>, <em>filename</em>, <em>labels=None</em>, <em>style=''</em>, <em>legend=' '</em>, <em>legend_location='best'</em>, <em>legend_title=None</em>, <em>xlim=None</em>, <em>ylim=None</em>, <em>tick_multiple=None</em><big>)</big><a class="headerlink" href="#zgoubi.utils.plot_data_xy_multi" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots multiple sets of data where the X and Y coordinates are each specified in a list of lists. Should also
work if a single set of X, Y data is specified or if one X is supplied with multiple Y data points (as long 
the dimensions of Y equals that of X in all cases).</p>
<blockquote>
<div><p>Required input -
data_x_list - Set of X data. May be a single list or a list of lists each with the same dimension. 
data_y_list - Set of Y data. May be a single list or a list of lists each with the same dimension. Can have a single list of X data and multiple lists of data_y_list.
filename - Plot saved to filename.png</p>
<p>Optional parameters -
labels = [&#8220;Plot Title&#8221;,&#8221;X axis label&#8221;,&#8221;Y axis label&#8221;]
style - The plot style can be supplied as a list or as a single value. If no style is specified,  will cycle over a predefined style list.
legend - Legends can be supplied as a list of strings or as a single string. 
legend_location - Default of location of legend box is &#8216;best&#8217;, otherwise can select &#8216;upper right&#8217; or numerical code for position. See matplotlib documentation. 
xlim = [lower_value, upper_value] - Limit horizontal axis
ylim = [lower_value, upper_value] - Limit vertical axis
majorLocator = horizontal axis tick marks defined as multiple of majorLocator</p>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.plot_find_closed_orbit">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">plot_find_closed_orbit</tt><big>(</big><em>data_fname</em>, <em>outfile=None</em><big>)</big><a class="headerlink" href="#zgoubi.utils.plot_find_closed_orbit" title="Permalink to this definition">¶</a></dt>
<dd><p>When the closed orbit search fails it can be useful to see what happened. find_closed_orbit() and find_closed_orbit_range() can take an optional argument record_fname. This causes them to write a log file, which can be read by this function and plotted.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">closed_orbit</span> <span class="o">=</span>  <span class="n">find_closed_orbit</span><span class="p">(</span><span class="n">tline</span><span class="p">,</span> <span class="n">init_YTZP</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">record_fname</span><span class="o">=</span><span class="s2">&quot;res/closedorbit.log&quot;</span><span class="p">)</span>
<span class="n">plot_find_closed_orbit</span><span class="p">(</span><span class="n">data_fname</span><span class="o">=</span><span class="s2">&quot;res/closedorbit.log&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="s2">&quot;res/closedorbit.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will show you the succession of guesses. If using plot_find_closed_orbit_range() it will also show a plot of all the coordinates that survive being tracked through the lattice.</p>
<p>From the plots it may be clear whether the lattice is unstable, or if the convergence is just too slow. In the latter case it may help to repeat the cell using REBELOTE, or to increase the number of iterations allowed.</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.readArray">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">readArray</tt><big>(</big><em>filename</em>, <em>skipchar='#'</em>, <em>dtype=&lt;type 'float'&gt;</em><big>)</big><a class="headerlink" href="#zgoubi.utils.readArray" title="Permalink to this definition">¶</a></dt>
<dd><p># PURPOSE: read an array from a file. Skip empty lines or lines
#          starting with the comment delimiter (defaulted to &#8216;#&#8217;).
#
# OUTPUT: a float numpy array
#
# EXAMPLE: &gt;&gt;&gt; data = readArray(&#8220;/home/albert/einstein.dat&#8221;)
#          &gt;&gt;&gt; x = data[:,0]        # first column
#          &gt;&gt;&gt; y = data[:,1]        # second column
from <a class="reference external" href="http://www.scipy.org/Cookbook/InputOutput">http://www.scipy.org/Cookbook/InputOutput</a></p>
<p>Note: please switch to using numpy functions: numpy.savetxt(), numpy.loadtxt() or numpy.genfromtxt()</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.scaling_to_dipole">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">scaling_to_dipole</tt><big>(</big><em>k</em>, <em>r0</em>, <em>b0_in</em>, <em>d_r0=0</em>, <em>scale_factor=1.0</em>, <em>terms=4</em><big>)</big><a class="headerlink" href="#zgoubi.utils.scaling_to_dipole" title="Permalink to this definition">¶</a></dt>
<dd><p>A scaling FFAG has field given by B/B0 = (r/r0)^k where k is the scaling factor.
The Taylor expansion about r0 yields</p>
<p>B(r)/B0 = (k!/(n!(k-n)!)) * (r-r0)^n/r0^n for each multipole n</p>
<p>In DIPOLES the magnetic field (ignoring fringe field factor) is given by</p>
<p>B(r)/B0 = bcoef[n] (r-r0)^n/r0^n for each multipole n</p>
<p>It follows that setting bcoef[n] = (k!/(n!(k-n)!)) will create a DIPOLE magnet whose field approximates the scaling law.
Routine returns bcoef up to number of terms specified.</p>
<p>If r0 is scaled by scale_factor, the coefficients are scaled accordingly. 
If r0 is shifted by d_r0, the routine will update B0 (b0_in) according to the scaling law</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.scaling_to_poly">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">scaling_to_poly</tt><big>(</big><em>b0</em>, <em>k</em>, <em>r0</em>, <em>rmin</em>, <em>rmax</em>, <em>step</em>, <em>order=5</em><big>)</big><a class="headerlink" href="#zgoubi.utils.scaling_to_poly" title="Permalink to this definition">¶</a></dt>
<dd><p>In a scaling FFAG, the magnetic field follows the scaling law given by B=B0*(r/r0)^k where r is the radial coordinate,
B0 is the field at r=r0 and k is the scaling factor.
This def fits a polynomial of a given order to the scaling field at points in the region rmin &lt; r &lt; rmax, where the number of points is determined by the increment step. The coefficients of 
polynomial are returned.</p>
<p>Required input - 
b0 - the field at r0
r0 - the reference radius
rmin,rmax - region of fit
step - step size in (rmin,rmax) at which scaling field is evaluated</p>
<p>Optional input-
order - Order of polynomial fit (default 5)</p>
<p>Author -  S. Sheehy</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.scan_dynamic_aperture">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">scan_dynamic_aperture</tt><big>(</big><em>line</em>, <em>emit_list_h</em>, <em>emit_list_v</em>, <em>closedorb_YTZP</em>, <em>npass</em>, <em>D_mom</em>, <em>beta_gamma_input=1</em>, <em>ellipse_coords=1</em>, <em>coord_pick=0</em>, <em>twiss_parameters=[]</em>, <em>plot_data=False</em><big>)</big><a class="headerlink" href="#zgoubi.utils.scan_dynamic_aperture" title="Permalink to this definition">¶</a></dt>
<dd><p>Check a list of emittances (emit_list, units Pi m rad) to see if tracking succeeds. Can be used to establish the dynamic aperture. If the elements in emit_list are increasing then will stop tracking once it finds the lowest emittance where a particle is lost. On the other hand, if the elements in emit_list are decreasing then will stop tracking once it reaches the first point where tracking succeeds without loss.</p>
<dl class="docutils">
<dt>Required input:</dt>
<dd><p class="first">emit_list_h - List of emittances in horizontal plane to check
emit_list_v - List of emittances in vertical plane to check</p>
<p>closedorb_YTZP - Closed orbit coordinates as returned by find_closed_orbit</p>
<p>npass - Number of passes through lattice</p>
<p class="last">D_mom - Momentum factor p/pref</p>
</dd>
<dt>Optional input</dt>
<dd><p class="first">beta_gamma_input - If this is supplied then the emittances supplied in emit_list are assumed to be normalised and a conversion to geometrical emittance is made. Otherwise the emittances supplied are assumed to be geometrical.</p>
<p>ellipse_coords - If greater than 1 will test uniformly distributed set of coordinates around around phase space
ellipse. The points are generated by emittance_to_coords. ellipse_coords = 1 (or -1) will take single point where phase space cuts either the y, t, z or p axes (decided by coord_pick). ellipse_coords = -1 selects the negative point in the phase space ellipse. The default settings ellipse_coords = 1, coord_pick = 0 selects the point where the phase space ellipse cuts the y, z axis to the outside of the closed orbit point.</p>
<p>coord_pick - Choose one of ellipse coords, i.e. ellipse_coords[coord_pick] is selected. If ellipse_coords equal 1 or -1, then coords_pick = 0 selects the points where the phase space ellipse crosses the Y, Z axes. If coord_pick = 1 then selects the point where the phase space ellipse crosses the T, P axes. If coord_pick = None, will select all points generated by emittance_to_coords.</p>
<p>Can also specify ellipse coords = [n,m] &#8211; distribute n points around ellipse but only test point m of these.</p>
<p>twiss_parameters - Can supply twiss parameters in format [beta_y, alpha_y, gamma_y, disp_y, disp_py, beta_z, alpha_z, gamma_z, disp_z, disp_pz], i.e the output of r.get_twiss_parameters(). If not supplied an attempt will be made to calculate the twiss parameters in this function.</p>
<p>plot_data - If True, creates phase space plots at all emittances scanned in both transverse planes.</p>
<p>Returns [index_lost, coord_index], fourier_tune_emit, coords_YTZP_ini]  where 
index_lost is the index in emit_list where particle is lost (0 if no loss). 
coord_index indicates at which coord in ellipse_coords the particle is lost. 
fourier_tune_emit is a list of tunes found at each emittance using Fourier analysis. 
coords_YTZP_ini_list is a list of all initial coordinates tested.</p>
<p class="last">If a particle is lost, returns index_lost in emit_list where the loss occurs. Otherwise index_lost remains 0.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.show_file">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">show_file</tt><big>(</big><em>file_path</em>, <em>mode</em><big>)</big><a class="headerlink" href="#zgoubi.utils.show_file" title="Permalink to this definition">¶</a></dt>
<dd><p>shows a file. mode can be:
cat - dumps to screen
less - scrollable view
win - scollable new win (less in an xterm)</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.tune_diagram">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">tune_diagram</tt><big>(</big><em>tune_list</em>, <em>order=3</em>, <em>xlim=None</em>, <em>ylim=None</em><big>)</big><a class="headerlink" href="#zgoubi.utils.tune_diagram" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot a list of tunes on a tune diagram with resonance line up to a given order.</p>
<dl class="docutils">
<dt>Required input </dt>
<dd>tune_list - format [[list of horizontal tunes],[list of vertical tunes]]</dd>
<dt>Optional</dt>
<dd>order - Integer denoting order up to which resonance lines are drawn. Default value 3 (third order).
xlim = [lower_value, upper_value] - Limit horizontal axis
ylim = [lower_value, upper_value] - Limit vertical axis</dd>
</dl>
<p>At the moment, since the tune diagram covers the range [0,1] just fractional tunes can be shown.
The default value of order is 3. 
Written by Y. Giboudet</p>
</dd></dl>

<dl class="function">
<dt id="zgoubi.utils.uniquify_labels">
<tt class="descclassname">zgoubi.utils.</tt><tt class="descname">uniquify_labels</tt><big>(</big><em>line</em><big>)</big><a class="headerlink" href="#zgoubi.utils.uniquify_labels" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new line where every element has a unique label.</p>
<p>Checks for repeating labels and appends a count to each that repeats. Ignores elements with blank labels.</p>
<p>Note: New line contains deep copies of original elements.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">API Reference</a><ul>
<li><a class="reference internal" href="#module-zgoubi.core"><tt class="docutils literal"><span class="pre">zgoubi.core</span></tt></a><ul>
<li><a class="reference internal" href="#zgoubi-core-line"><tt class="docutils literal"><span class="pre">zgoubi.core.Line</span></tt></a></li>
<li><a class="reference internal" href="#zgoubi-core-results"><tt class="docutils literal"><span class="pre">zgoubi.core.Results</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-zgoubi.bunch"><tt class="docutils literal"><span class="pre">zgoubi.bunch</span></tt></a></li>
<li><a class="reference internal" href="#module-zgoubi.common"><tt class="docutils literal"><span class="pre">zgoubi.common</span></tt></a></li>
<li><a class="reference internal" href="#module-zgoubi.constants"><tt class="docutils literal"><span class="pre">zgoubi.constants</span></tt></a></li>
<li><a class="reference internal" href="#module-zgoubi.ellipse"><tt class="docutils literal"><span class="pre">zgoubi.ellipse</span></tt></a></li>
<li><a class="reference internal" href="#module-zgoubi.exceptions"><tt class="docutils literal"><span class="pre">zgoubi.execptions</span></tt></a></li>
<li><a class="reference internal" href="#module-zgoubi.gcp"><tt class="docutils literal"><span class="pre">zgoubi.gcp</span></tt></a></li>
<li><a class="reference internal" href="#module-zgoubi.io"><tt class="docutils literal"><span class="pre">zgoubi.io</span></tt></a></li>
<li><a class="reference internal" href="#module-zgoubi.lab_plot"><tt class="docutils literal"><span class="pre">zgoubi.lab_plot</span></tt></a></li>
<li><a class="reference internal" href="#module-zgoubi.rel_conv"><tt class="docutils literal"><span class="pre">zgoubi.rel_conv</span></tt></a></li>
<li><a class="reference internal" href="#module-zgoubi.utils"><tt class="docutils literal"><span class="pre">zgoubi.utils</span></tt></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="doc.html"
                        title="previous chapter">PyZgoubi Documentation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/api.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="doc.html" title="PyZgoubi Documentation"
             >previous</a> |</li>
        <li><a href="index.html">PyZgoubi 0.6.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Sam Tygier.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>