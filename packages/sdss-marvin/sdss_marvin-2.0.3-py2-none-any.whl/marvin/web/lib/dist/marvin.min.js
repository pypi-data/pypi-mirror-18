/*! marvin 2016-11-05 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Carousel=function(){function a(b,c){_classCallCheck(this,a),this.carouseldiv=$(b),this.thumbsdiv=void 0!==c?$(c):$("[id^=carousel-selector-]"),this.carouseldiv.carousel({interval:5e3}),this.thumbsdiv.on("click",this,this.handleThumbs),this.carouseldiv.on("slid.bs.carousel",this,this.updateText)}return _createClass(a,[{key:"print",value:function(){console.log("I am Carousel!")}},{key:"handleThumbs",value:function(a){var b=a.data,c=$(this).attr("id");try{var d=/-(\d+)$/.exec(c)[1];b.carouseldiv.carousel(parseInt(d))}catch(e){console.log("MyCarousel: Regex failed!",e)}}},{key:"updateText",value:function(a){var b=(a.data,$(".item.active").data("slide-number"));$("#carousel-text").html($("#slide-content-"+b).html())}}]),a}(),_slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Galaxy=function(){function a(b,c){_classCallCheck(this,a),this.setPlateIfu(b),this.toggleon=c,this.maindiv=$("#"+this.plateifu),this.metadiv=this.maindiv.find("#metadata"),this.specdiv=this.maindiv.find("#specview"),this.imagediv=this.specdiv.find("#imagediv"),this.mapsdiv=this.specdiv.find("#mapsdiv"),this.mapdiv=this.specdiv.find("#mapdiv1"),this.graphdiv=this.specdiv.find("#graphdiv"),this.specmsg=this.specdiv.find("#specmsg"),this.mapmsg=this.specdiv.find("#mapmsg"),this.webspec=null,this.staticdiv=this.specdiv.find("#staticdiv"),this.dynamicdiv=this.specdiv.find("#dynamicdiv"),this.togglediv=$("#toggleinteract"),this.toggleload=$("#toggle-load"),this.togglediv.bootstrapToggle("off"),this.qualpop=$("#qualitypopover"),this.targpops=$(".targpopovers"),this.dapmapsbut=$("#dapmapsbut"),this.dapselect=$("#dapmapchoices"),this.dapbt=$("#dapbtchoices"),this.dapselect.selectpicker("deselectAll"),this.resetmapsbut=$("#resetmapsbut"),this.initFlagPopovers(),this.dapmapsbut.on("click",this,this.getDapMaps),this.resetmapsbut.on("click",this,this.resetMaps),this.togglediv.on("change",this,this.initDynamic)}return _createClass(a,[{key:"print",value:function(){console.log("We are now printing galaxy",this.plateifu,this.plate,this.ifu)}},{key:"setPlateIfu",value:function(a){void 0===a?this.plateifu=$(".singlegalaxy").attr("id"):this.plateifu=a;var b=this.plateifu.split("-"),c=_slicedToArray(b,2);this.plate=c[0],this.ifu=c[1]}},{key:"loadSpaxel",value:function(a,b){var c=3==a[0].length?["Wavelength","Flux","Model Fit"]:["Wavelength","Flux"];this.webspec=new Dygraph(this.graphdiv[0],a,{title:b,labels:c,errorBars:!0,ylabel:"Flux [10<sup>-17</sup> erg/cm<sup>2</sup>/s/Å]",xlabel:"Wavelength [Ångströms]"})}},{key:"updateSpecMsg",value:function(a,b){this.specmsg.hide(),void 0!==b&&b===-1&&this.specmsg.show();var c="<strong>"+a+"</strong>";this.specmsg.empty(),this.specmsg.html(c)}},{key:"updateSpaxel",value:function(a,b){this.updateSpecMsg(b),this.webspec.updateOptions({file:a,title:b})}},{key:"initOpenLayers",value:function(a){this.image=a,this.olmap=new OLMap(a),this.olmap.map.on("singleclick",this.getSpaxel,this)}},{key:"initHeatmap",value:function(a){console.log("initHeatmap",this.mapsdiv);var b=this.mapsdiv.children("div");console.log("mapchildren",b);var c=this;$.each(b,function(b,d){var e=$(d).find("div").first();e.empty(),void 0!==a[b]&&null!==a[b].data&&(this.heatmap=new HeatMap(e,a[b].data,a[b].msg,c),this.heatmap.mapdiv.highcharts().reflow())})}},{key:"getSpaxel",value:function(a){var b=void 0===a.coordinate?null:a.coordinate,c=$(a.target).parents("div").first().attr("id"),d=void 0!==c&&c.search("highcharts")!==-1?"heatmap":"optical",e=void 0===a.point?null:a.point.x,f=void 0===a.point?null:a.point.y,g=["plateifu","image","imwidth","imheight","mousecoords","type","x","y"],h=m.utils.buildForm(g,this.plateifu,this.image,this.olmap.imwidth,this.olmap.imheight,b,d,e,f),i=this;$.post(Flask.url_for("galaxy_page.getspaxel"),h,"json").done(function(a){a.result.status!==-1?i.updateSpaxel(a.result.spectra,a.result.specmsg):i.updateSpecMsg("Error: "+a.result.specmsg,a.result.status)}).fail(function(a){i.updateSpecMsg("Error: "+a.result.specmsg,a.result.status)})}},{key:"checkToggle",value:function(){this.toggleon?this.toggleOn():this.toggleOff()}},{key:"toggleOn",value:function(){this.toggleon=!0,this.staticdiv.hide(),this.dynamicdiv.show()}},{key:"toggleOff",value:function(){this.toggleon=!1,this.dynamicdiv.hide(),this.staticdiv.show()}},{key:"testTogg",value:function(a){var b=a.data;console.log("toggling",b.togglediv.prop("checked"),b.togglediv.hasClass("active"))}},{key:"initDynamic",value:function(a){var b=a.data;if(b.togglediv.prop("checked")){b.toggleOn();var c=(b.graphdiv.is(":empty"),b.imagediv.is(":empty"));b.mapdiv.is(":empty");if(c){var d=["plateifu","toggleon"],e=m.utils.buildForm(d,b.plateifu,b.toggleon);b.toggleload.show(),$.post(Flask.url_for("galaxy_page.initdynamic"),e,"json").done(function(a){var c=a.result.image,d=a.result.spectra,e=a.result.specmsg,f=a.result.maps,g=a.result.mapmsg;b.initOpenLayers(c),b.toggleload.hide(),a.result.specstatus!==-1?b.loadSpaxel(d,e):b.updateSpecMsg("Error: "+e,a.result.specstatus),a.result.mapstatus!==-1?b.initHeatmap(f):b.updateMapMsg("Error: "+g,a.result.mapstatus)}).fail(function(a){b.updateSpecMsg("Error: "+a.result.specmsg,a.result.specstatus),b.updateMapMsg("Error: "+a.result.mapmsg,a.result.mapstatus),b.toggleload.hide()})}}else b.toggleOff()}},{key:"toggleInteract",value:function(a,b,c,d,e){if(this.togglediv.hasClass("active"))this.toggleon=!1,this.togglediv.toggleClass("btn-danger").toggleClass("btn-success"),this.togglediv.button("reset"),this.dynamicdiv.hide(),this.staticdiv.show();else{this.toggleon=!0,this.togglediv.toggleClass("btn-danger").toggleClass("btn-success"),this.togglediv.button("complete"),this.staticdiv.hide(),this.dynamicdiv.show();var f=this.graphdiv.is(":empty"),g=this.imagediv.is(":empty"),h=this.mapdiv.is(":empty");void 0!==this.graphdiv&&f&&this.loadSpaxel(c,d),g&&this.initOpenLayers(a),h&&this.initHeatmap(b),null!==e&&this.updateMapMsg(e,-1)}}},{key:"initFlagPopovers",value:function(){this.qualpop.popover({html:!0,content:$("#list_drp3quality").html()}),$.each(this.targpops,function(a,b){var c=b.id,d=c.split("_"),e=_slicedToArray(d,2),f=(e[0],e[1]),g="#list_"+f;$("#"+c).popover({html:!0,content:$(g).html()})})}},{key:"getDapMaps",value:function(a){var b=a.data;console.log("getting dap maps",b.dapselect.selectpicker("val"));var c=b.dapselect.selectpicker("val"),d=b.dapbt.selectpicker("val"),e=["plateifu","params","bintemp"],f=m.utils.buildForm(e,b.plateifu,c,d);b.mapmsg.hide(),$(this).button("loading"),$.post(Flask.url_for("galaxy_page.updatemaps"),f,"json").done(function(a){a.result.status!==-1?(b.dapmapsbut.button("reset"),b.initHeatmap(a.result.maps)):(b.updateMapMsg("Error: "+a.result.mapmsg,a.result.status),b.dapmapsbut.button("reset"))}).fail(function(a){b.updateMapMsg("Error: "+a.result.mapmsg,a.result.status),b.dapmapsbut.button("reset")})}},{key:"updateMapMsg",value:function(a,b){this.mapmsg.hide(),void 0!==b&&b===-1&&this.mapmsg.show();var c="<strong>"+a+"</strong>";this.mapmsg.empty(),this.mapmsg.html(c)}},{key:"resetMaps",value:function(a){var b=a.data;b.mapmsg.hide(),b.dapselect.selectpicker("deselectAll"),b.dapselect.selectpicker("refresh")}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Header=function(){function a(){_classCallCheck(this,a),this.navbar=$(".navbar"),this.galidform=$("#headform"),this.typeahead=$("#headform .typeahead"),this.mplform=$("#mplform"),this.mplselect=$("#mplselect"),this.initTypeahead(),this.mplselect.on("change",this,this.selectMPL)}return _createClass(a,[{key:"print",value:function(){console.log("I am Header!")}},{key:"initTypeahead",value:function(a,b,c,d){var a=void 0===a?this.typeahead:$(a),b=void 0===b?this.galidform:$(b),e=void 0===c?Flask.url_for("index_page.getgalidlist"):c;this.galids=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:e,remote:{url:e,filter:function(a){return a}}}),this.galids.initialize(),a.typeahead("destroy"),a.typeahead({showHintOnFocus:!0,items:30,source:this.galids.ttAdapter(),afterSelect:function(){b.submit()}})}},{key:"selectMPL",value:function(a){var b=a.data,c="index_page.selectmpl",d=m.utils.serializeForm("#mplform");console.log("setting new mpl",d),b.sendAjax(d,c,b.reloadPage)}},{key:"reloadPage",value:function(){location.reload(!0)}},{key:"sendAjax",value:function(a,b,c){var d=this;$.post(Flask.url_for(b),a,"json").done(function(a){1==a.result.status?(c(),d.galids.clearPrefetchCache(),d.galids.initialize()):alert("Failed to set the versions! "+a.result.msg)}).fail(function(a){alert("Failed to set the versions! Problem with Flask setversion. "+a.result.msg)})}}]),a}(),_slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),HeatMap=function(){function a(b,c,d,e){_classCallCheck(this,a),void 0===c?console.error("Must specify input map data to initialize a HeatMap!"):void 0===b?console.error("Must specify an input mapdiv to initialize a HeatMap"):(this.mapdiv=b,this.data=c,this.title=d,this.galthis=e,this.parseTitle(),this.initMap(),this.setColorNoData(this,Highcharts))}return _createClass(a,[{key:"print",value:function(){console.log("We are now printing heatmap for ",this.title)}},{key:"parseTitle",value:function(){var a=this.title.split(":"),b=_slicedToArray(a,2),c=(b[0],b[1]),d=c.split("_"),e=_slicedToArray(d,3);this.category=e[0],this.parameter=e[1],this.channel=e[2]}},{key:"getRange",value:function(){var a=this.data.values.length,b=Array.apply(null,{length:a}).map(Number.call,Number),c=[].concat.apply([],this.data.values);return[b,c]}},{key:"filterRange",value:function(a){return void 0!==a&&"number"==typeof a&&!isNaN(a)}},{key:"getMinMax",value:function(a){var b=Math.min.apply(null,a),c=Math.max.apply(null,a);return[b,c]}},{key:"setNull",value:function(a){for(var b=a.values,c=a.ivar,d=a.mask,e=Array(),f=0;f<b.length;f++)for(var g=0;g<b.length;g++){var h=b[f][g];if(null!==d)var i=d[f][g]&&Math.pow(2,0),j=d[f][g]&&Math.pow(2,5),k=d[f][g]&&Math.pow(2,6),l=d[f][g]&&Math.pow(2,7),m=d[f][g]&&Math.pow(2,30),n=i,o=j||k||l||m;if(null!==c)var p=Math.abs(h)*Math.sqrt(c[f][g]),q=1;n?h="no-data":o?h=null:null!==c&&p<q?h=null:null===c&&(this.title.search("binid")!==-1?h=h==-1?"no-data":h:0===h&&(h="no-data")),e.push([f,g,h])}return e}},{key:"setColorNoData",value:function(a,b){b.wrap(b.ColorAxis.prototype,"toColor",function(a,b,c){return"no-data"===b?"rgba(0,0,0,0)":"low-sn"===b?"rgba(0,191,255,0.5)":a.apply(this,Array.prototype.slice.call(arguments,1))})}},{key:"setColorMapHex",value:function(a){var b=["#040404","#0a0308","#0d040b","#10050e","#120510","#150612","#160713","#180815","#1a0816","#1b0918","#1c0a19","#1e0b1a","#1f0c1b","#200c1c","#210d1d","#230e1f","#240e20","#250f20","#260f21","#271022","#281123","#291124","#2a1226","#2b1326","#2c1327","#2e1429","#2e142d","#2e1532","#2d1537","#2d153c","#2d1640","#2d1743","#2d1747","#2d184b","#2d184d","#2d1951","#2d1954","#2c1a57","#2c1b5a","#2d1b5c","#2d1c5f","#2c1d62","#2c1d64","#2c1e67","#2c1f6a","#2c1f6d","#2c206e","#2c2171","#2c2274","#2c2276","#2a2379","#282678","#262877","#242a78","#222c78","#212e78","#202f78","#1f3179","#1e327a","#1e337b","#1d347b","#1d357d","#1c377d","#1c387e","#1b397f","#1c3a80","#1c3b81","#1b3c81","#1b3d83","#1b3e84","#1b3f85","#1c4086","#1b4187","#1b4288","#1b4489","#1b458a","#194788","#164986","#154a85","#144c83","#114e81","#104f80","#0f517e","#0e527d","#0a547b","#0a557a","#095778","#085877","#075976","#065b75","#045c73","#045e72","#045f72","#036070","#01626f","#01636e","#00646d","#00656c","#00676b","#00686a","#006969","#006b68","#006c65","#006e64","#006f63","#007062","#007260","#00735f","#00745d","#00765c","#00775a","#007859","#007958","#007b56","#007c55","#007d53","#007f52","#008050","#00814f","#00834d","#00844b","#008549","#008648","#008846","#008944","#008a42","#008b41","#008d40","#008e3f","#008f3d","#00913c","#00923c","#00933a","#009539","#009638","#009737","#009935","#009a34","#009b33","#009d32","#009e30","#009f2f","#00a02d","#00a22c","#00a32a","#00a429","#00a527","#00a724","#00a822","#00a91f","#00aa17","#00a908","#09aa00","#14ab00","#1dac00","#23ad00","#28ae00","#2daf00","#30b000","#34b100","#37b200","#3bb300","#3db400","#40b500","#42b600","#44b700","#47b800","#49b900","#4cba00","#4ebb00","#4fbc00","#51bd00","#53be00","#55bf00","#57c000","#5cc000","#63c100","#6ac100","#72c100","#77c200","#7dc200","#82c200","#87c300","#8cc300","#91c300","#95c400","#99c400","#9dc500","#a1c500","#a5c500","#a9c600","#acc600","#b0c700","#b4c700","#b8c700","#bac800","#bec900","#c1c900","#c5c900","#c8ca00","#c9c918","#cbca33","#ceca41","#cfcb4d","#d1cb57","#d4cb5f","#d5cc67","#d7cd6d","#dacd74","#dbce79","#ddcf7f","#dfcf84","#e2cf8a","#e3d08f","#e5d193","#e7d197","#e8d29b","#ebd39f","#edd3a4","#eed4a8","#f0d4ac","#f3d5af","#f3d6b3","#f5d6b7","#f8d7ba","#f8d8bd","#f8dac1","#f7dbc3","#f7dcc6","#f7dec9","#f8dfcc","#f7e0ce","#f7e2d1","#f7e3d3","#f7e5d6","#f7e6d8","#f7e7da","#f7e8dc","#f8eae0","#f7ebe1","#f7ece5","#f7eee7","#f7efe8","#f8f0eb","#f8f2ed","#f7f3ef","#f8f4f1","#f8f6f4","#f8f7f6","#f8f8f8","#f9f9f9","#fbfbfb","#fcfcfc","#fdfdfd","#fefefe","#ffffff"],c=["#000004","#010005","#010106","#010108","#02010a","#02020c","#02020e","#030210","#040312","#040314","#050417","#060419","#07051b","#08051d","#09061f","#0a0722","#0b0724","#0c0826","#0d0829","#0e092b","#10092d","#110a30","#120a32","#140b34","#150b37","#160b39","#180c3c","#190c3e","#1b0c41","#1c0c43","#1e0c45","#1f0c48","#210c4a","#230c4c","#240c4f","#260c51","#280b53","#290b55","#2b0b57","#2d0b59","#2f0a5b","#310a5c","#320a5e","#340a5f","#360961","#380962","#390963","#3b0964","#3d0965","#3e0966","#400a67","#420a68","#440a68","#450a69","#470b6a","#490b6a","#4a0c6b","#4c0c6b","#4d0d6c","#4f0d6c","#510e6c","#520e6d","#540f6d","#550f6d","#57106e","#59106e","#5a116e","#5c126e","#5d126e","#5f136e","#61136e","#62146e","#64156e","#65156e","#67166e","#69166e","#6a176e","#6c186e","#6d186e","#6f196e","#71196e","#721a6e","#741a6e","#751b6e","#771c6d","#781c6d","#7a1d6d","#7c1d6d","#7d1e6d","#7f1e6c","#801f6c","#82206c","#84206b","#85216b","#87216b","#88226a","#8a226a","#8c2369","#8d2369","#8f2469","#902568","#922568","#932667","#952667","#972766","#982766","#9a2865","#9b2964","#9d2964","#9f2a63","#a02a63","#a22b62","#a32c61","#a52c60","#a62d60","#a82e5f","#a92e5e","#ab2f5e","#ad305d","#ae305c","#b0315b","#b1325a","#b3325a","#b43359","#b63458","#b73557","#b93556","#ba3655","#bc3754","#bd3853","#bf3952","#c03a51","#c13a50","#c33b4f","#c43c4e","#c63d4d","#c73e4c","#c83f4b","#ca404a","#cb4149","#cc4248","#ce4347","#cf4446","#d04545","#d24644","#d34743","#d44842","#d54a41","#d74b3f","#d84c3e","#d94d3d","#da4e3c","#db503b","#dd513a","#de5238","#df5337","#e05536","#e15635","#e25734","#e35933","#e45a31","#e55c30","#e65d2f","#e75e2e","#e8602d","#e9612b","#ea632a","#eb6429","#eb6628","#ec6726","#ed6925","#ee6a24","#ef6c23","#ef6e21","#f06f20","#f1711f","#f1731d","#f2741c","#f3761b","#f37819","#f47918","#f57b17","#f57d15","#f67e14","#f68013","#f78212","#f78410","#f8850f","#f8870e","#f8890c","#f98b0b","#f98c0a","#f98e09","#fa9008","#fa9207","#fa9407","#fb9606","#fb9706","#fb9906","#fb9b06","#fb9d07","#fc9f07","#fca108","#fca309","#fca50a","#fca60c","#fca80d","#fcaa0f","#fcac11","#fcae12","#fcb014","#fcb216","#fcb418","#fbb61a","#fbb81d","#fbba1f","#fbbc21","#fbbe23","#fac026","#fac228","#fac42a","#fac62d","#f9c72f","#f9c932","#f9cb35","#f8cd37","#f8cf3a","#f7d13d","#f7d340","#f6d543","#f6d746","#f5d949","#f5db4c","#f4dd4f","#f4df53","#f4e156","#f3e35a","#f3e55d","#f2e661","#f2e865","#f2ea69","#f1ec6d","#f1ed71","#f1ef75","#f1f179","#f2f27d","#f2f482","#f3f586","#f3f68a","#f4f88e","#f5f992","#f6fa96","#f8fb9a","#f9fc9d","#fafda1","#fcffa4"],d=["#053061","#063264","#073467","#08366a","#09386d","#0a3b70","#0c3d73","#0d3f76","#0e4179","#0f437b","#10457e","#114781","#124984","#134c87","#144e8a","#15508d","#175290","#185493","#195696","#1a5899","#1b5a9c","#1c5c9f","#1d5fa2","#1e61a5","#1f63a8","#2065ab","#2267ac","#2369ad","#246aae","#266caf","#276eb0","#2870b1","#2a71b2","#2b73b3","#2c75b4","#2e77b5","#2f79b5","#307ab6","#327cb7","#337eb8","#3480b9","#3681ba","#3783bb","#3885bc","#3a87bd","#3b88be","#3c8abe","#3e8cbf","#3f8ec0","#408fc1","#4291c2","#4393c3","#4695c4","#4997c5","#4c99c6","#4f9bc7","#529dc8","#569fc9","#59a1ca","#5ca3cb","#5fa5cd","#62a7ce","#65a9cf","#68abd0","#6bacd1","#6eaed2","#71b0d3","#75b2d4","#78b4d5","#7bb6d6","#7eb8d7","#81bad8","#84bcd9","#87beda","#8ac0db","#8dc2dc","#90c4dd","#93c6de","#96c7df","#98c8e0","#9bc9e0","#9dcbe1","#a0cce2","#a2cde3","#a5cee3","#a7d0e4","#a9d1e5","#acd2e5","#aed3e6","#b1d5e7","#b3d6e8","#b6d7e8","#b8d8e9","#bbdaea","#bddbea","#c0dceb","#c2ddec","#c5dfec","#c7e0ed","#cae1ee","#cce2ef","#cfe4ef","#d1e5f0","#d2e6f0","#d4e6f1","#d5e7f1","#d7e8f1","#d8e9f1","#dae9f2","#dbeaf2","#ddebf2","#deebf2","#e0ecf3","#e1edf3","#e3edf3","#e4eef4","#e6eff4","#e7f0f4","#e9f0f4","#eaf1f5","#ecf2f5","#edf2f5","#eff3f5","#f0f4f6","#f2f5f6","#f3f5f6","#f5f6f7","#f6f7f7","#f7f6f6","#f7f5f4","#f8f4f2","#f8f3f0","#f8f2ef","#f8f1ed","#f9f0eb","#f9efe9","#f9eee7","#f9ede5","#f9ebe3","#faeae1","#fae9df","#fae8de","#fae7dc","#fbe6da","#fbe5d8","#fbe4d6","#fbe3d4","#fce2d2","#fce0d0","#fcdfcf","#fcdecd","#fdddcb","#fddcc9","#fddbc7","#fdd9c4","#fcd7c2","#fcd5bf","#fcd3bc","#fbd0b9","#fbceb7","#fbccb4","#facab1","#fac8af","#f9c6ac","#f9c4a9","#f9c2a7","#f8bfa4","#f8bda1","#f8bb9e","#f7b99c","#f7b799","#f7b596","#f6b394","#f6b191","#f6af8e","#f5ac8b","#f5aa89","#f5a886","#f4a683","#f3a481","#f2a17f","#f19e7d","#f09c7b","#ef9979","#ee9677","#ec9374","#eb9172","#ea8e70","#e98b6e","#e8896c","#e6866a","#e58368","#e48066","#e37e64","#e27b62","#e17860","#df765e","#de735c","#dd7059","#dc6e57","#db6b55","#da6853","#d86551","#d7634f","#d6604d","#d55d4c","#d35a4a","#d25849","#d05548","#cf5246","#ce4f45","#cc4c44","#cb4942","#c94741","#c84440","#c6413e","#c53e3d","#c43b3c","#c2383a","#c13639","#bf3338","#be3036","#bd2d35","#bb2a34","#ba2832","#b82531","#b72230","#b61f2e","#b41c2d","#b3192c","#b1182b","#ae172a","#ab162a","#a81529","#a51429","#a21328","#9f1228","#9c1127","#991027","#960f27","#930e26","#900d26","#8d0c25","#8a0b25","#870a24","#840924","#810823","#7f0823","#7c0722","#790622","#760521","#730421","#700320","#6d0220","#6a011f","#67001f"];return"linearLab"===a?b:"inferno"===a?c:"RdBu"===a?d:["#000000","#FFFFFF"]}},{key:"setColorStops",value:function(a){for(var b=this.setColorMapHex(a),c=b.length,d=new Array(c),e=0;e<c;e++)d[e]=[e/(c-1),b[e]];return d}},{key:"quantileClip",value:function(a){var b,c,d,e,f=this.getMinMax(a),g=_slicedToArray(f,2);return d=g[0],e=g[1],this.title.toLowerCase().indexOf("vel")>=0||this.title.toLowerCase().indexOf("sigma")>=0?(b=10,c=90):this.title.toLowerCase().indexOf("flux")>=0&&(b=5,c=95),a.length>0&&(b>0&&(d=math.quantileSeq(a,b/100)),c<100&&(e=math.quantileSeq(a,c/100))),[d,e]}},{key:"initMap",value:function(){var a,b,c=this.galthis,d=this.getRange(),e=_slicedToArray(d,2);a=e[0],b=e[1];var f,g,h,i,j=this.getMinMax(a),k=_slicedToArray(j,2);f=k[0],g=k[1];var l=this.getMinMax(b),m=_slicedToArray(l,2);h=m[0],i=m[1];var n=this.setNull(this.data);b=n.map(function(a){return a[2]}),b=b.filter(this.filterRange);var o=this.quantileClip(b),p=_slicedToArray(o,2);if(h=p[0],i=p[1],this.title.toLowerCase().indexOf("vel")>=0){var q="RdBu",r=Math.max.apply(null,[Math.abs(h),Math.abs(i)]);h=-r,i=r}else if(this.title.toLowerCase().indexOf("sigma")>=0)var q="inferno";else var q="linearLab";var s=this.setColorStops(q);this.mapdiv.highcharts({chart:{type:"heatmap",marginTop:40,marginBottom:80,plotBorderWidth:1,backgroundColor:null,plotBackgroundColor:"#A8A8A8"},credits:{enabled:!1},title:{text:this.title},navigation:{buttonOptions:{theme:{fill:null}}},xAxis:{title:{text:"Spaxel X"},minorGridLineWidth:0,min:f,max:g,tickInterval:1,tickLength:0},yAxis:{title:{text:"Spaxel Y"},min:f,max:g,tickInterval:1,endOnTick:!1,gridLineWidth:0},colorAxis:{min:h,max:i,minColor:s[0][1],maxColor:s[s.length-1][1],stops:s,labels:{align:"center"},reversed:!1,startOnTick:!1,endOnTick:!1,tickPixelInterval:30,type:"linear"},plotOptions:{heatmap:{nullColor:"url(#custom-pattern)"}},defs:{patterns:[{width:3,height:3,id:"custom-pattern",path:{d:"M 0 0 L 3 3 M 0 3 L 3 0",stroke:"white",strokeWidth:.3}}]},legend:{align:"right",layout:"vertical",verticalAlign:"middle",title:{text:this.parameter}},tooltip:{formatter:function(){return"<br>("+this.point.x+", "+this.point.y+"): <b>"+this.point.value+"</b><br>"}},series:[{type:"heatmap",data:n,dataLabels:{enabled:!1},events:{click:function(a){c.getSpaxel(a)}}}]})}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Marvin=function(){function a(b){_classCallCheck(this,a),this.options=b,this.utils=new Utils,this.utils.print(),this.utils.initInfoPopOvers(),this.utils.initToolTips(),this.header=new Header,this.header.print(),this.setupRaven()}return _createClass(a,[{key:"setupRaven",value:function(){Raven.config("https://98bc7162624049ffa3d8d9911e373430@sentry.io/107924",{release:"0.2.0b1",whitelistUrls:["/(sas|api).sdss.org/marvin/","/(sas|api).sdss.org/marvin2/"],includePaths:["/https?://((sas|api).)?sdss.org/marvin","/https?://((sas|api).)?sdss.org/marvin2"]}).install()}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),OLMap=function(){function a(b){_classCallCheck(this,a),void 0===b?console.error("Must specify an input image to initialize a Map!"):(this.image=b,this.staticimdiv=$("#staticimage")[0],this.mapdiv=$("#imagediv")[0],this.getImageSize(),this.setProjection(),this.setView(),this.initMap(),this.addDrawInteraction())}return _createClass(a,[{key:"print",value:function(){console.log("We are now printing openlayers map")}},{key:"getImageSize",value:function(){void 0!==this.staticimdiv&&(this.imwidth=this.staticimdiv.naturalWidth,this.imheight=this.staticimdiv.naturalHeight)}},{key:"setMouseControl",value:function(){var a=new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(4),projection:"EPSG:4326",undefinedHTML:"&nbsp;"});return a}},{key:"setProjection",value:function(){this.extent=[0,0,this.imwidth,this.imheight],this.projection=new ol.proj.Projection({code:"ifu",units:"pixels",extent:this.extent})}},{key:"setBaseImageLayer",value:function(){var a=new ol.layer.Image({source:new ol.source.ImageStatic({url:this.image,projection:this.projection,imageExtent:this.extent})});return a}},{key:"setView",value:function(){this.view=new ol.View({projection:this.projection,center:ol.extent.getCenter(this.extent),zoom:1,maxZoom:8,maxResolution:1.4})}},{key:"initMap",value:function(){var a=this.setMouseControl(),b=this.setBaseImageLayer();this.map=new ol.Map({controls:ol.control.defaults({attributionOptions:{collapsible:!1}}).extend([a]),layers:[b],target:this.mapdiv,view:this.view})}},{key:"addDrawInteraction",value:function(){var a,b=new ol.source.Vector({wrapX:!1}),c=this.newVectorLayer(b);this.map.addLayer(c);var d,e,f="Point";this.draw=new ol.interaction.Draw({source:b,type:f,geometryFunction:d,maxPoints:e}),this.draw.on("drawend",function(c){a&&b.removeFeature(a),a=c.feature}),this.map.addInteraction(this.draw)}},{key:"newVectorLayer",value:function(a){var b=new ol.layer.Vector({source:a,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#FF0808",width:2}),image:new ol.style.Circle({radius:3,fill:new ol.style.Fill({color:"#FF0808"})})})});return b}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Search=function(){function a(){_classCallCheck(this,a),this.searchform=$("#searchform"),this.typeahead=$("#searchform .typeahead"),this.returnparams=$("#returnparams"),this.parambox=$("#parambox"),this.searchbox=$("#searchbox")}return _createClass(a,[{key:"print",value:function(){console.log("I am Search!")}},{key:"extractor",value:function(a){var b=new RegExp("([^,]+)$"),c=b.exec(a);return c&&c[1]?c[1].trim():""}},{key:"initTypeahead",value:function(a,b,c,d){function e(a){var b=a.toString();return[f.extractor(b)]}var f=this,a=void 0===a?this.typeahead:$(a),b=void 0===b?this.searchform:$(b),g=void 0===c?Flask.url_for("search_page.getparams"):c;this.queryparams=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:e,prefetch:g,remote:{url:g,filter:function(a){return a}}}),this.queryparams.initialize(),a.typeahead("destroy"),a.typeahead({showHintOnFocus:!0,items:"all",source:this.queryparams.ttAdapter(),updater:function(a){var b=this.$element.val(),c=b.replace(/[^,]*$/,""),d=c+a+", ";return d},matcher:function(a){var b=f.extractor(this.query);return!!b&&~a.toLowerCase().indexOf(b.toLowerCase())},highlighter:function(a){var b=f.extractor(this.query),c=b.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return a.replace(new RegExp("("+c+")","ig"),function(a,b){return"<strong>"+b+"</strong>"})}})}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Table=function(){function a(b){_classCallCheck(this,a),this.setTable(b)}return _createClass(a,[{key:"print",value:function(){console.log("I am Table!")}},{key:"setTable",value:function(a){void 0!==a&&(console.log("setting the table"),this.table=a)}},{key:"initTable",value:function(a,b){if(this.url=a,null!==b.columns)var c=this.makeColumns(b.columns);this.table.bootstrapTable({classes:"table table-bordered table-condensed table-hover",toggle:"table",pagination:!0,pageSize:10,pageList:"[10, 20, 50]",sidePagination:"server",method:"post",contentType:"application/x-www-form-urlencoded",data:b.rows,totalRows:b.total,columns:c,url:a,search:!0,showColumns:!0,showToggle:!0,sortName:"cube.mangaid",sortOrder:"asc",formatNoMatches:function(){return"This table is empty..."}})}},{key:"makeColumns",value:function(a){var b=[];return a.forEach(function(a,c){var d={};d.field=a,d.title=a,d.sortable=!0,b.push(d)}),b}},{key:"handleResponse",value:function(a){null===this.table&&this.setTable(),this.table=$("#table");var b=a.columns,b=[];return a.columns.forEach(function(a,c){var d={};d.field=a,d.title=a,d.sortable=!0,b.push(d)}),this.table.bootstrapTable("refreshOptions",{columns:b,totalRows:a.total}),a}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Utils=function(){function a(){_classCallCheck(this,a),$("#login-user").on("keyup",this,this.submitLogin),$("#login-pass").on("keyup",this,this.submitLogin),$("#login-drop").on("hide.bs.dropdown",this,this.resetLogin)}return _createClass(a,[{key:"print",value:function(){console.log("I am Utils!")}},{key:"buildForm",value:function(a){var b=Array.prototype.slice.call(arguments,1),c={};return a.forEach(function(a,d){c[a]=b[d]}),c}},{key:"serializeForm",value:function(a){var b=$(a).serializeArray();return b}},{key:"unique",value:function(a){return new Set(a)}},{key:"scrollTo",value:function(a){if(void 0!==a){var b=$(a);$("html,body").animate({scrollTop:b.offset().top},1500,"easeInOutExpo")}else $("html,body").animate({scrollTop:0},1500,"easeInOutExpo")}},{key:"initInfoPopOvers",value:function(){$('.infopop [data-toggle="popover"]').popover()}},{key:"initToolTips",value:function(){$('[data-toggle="tooltip"]').tooltip()}},{key:"login",value:function(){var a=$("#loginform").serialize(),b=this;$.post(Flask.url_for("index_page.login"),a,"json").done(function(a){if(a.result.status<0)b.resetLogin();else{if(""!==a.result.message){var c=0===a.result.status?"danger":"success",d="<div class='alert alert-"+c+"' role='alert'><h4>"+a.result.message+"</h4></div>";$("#loginmessage").html(d)}1===a.result.status&&location.reload(!0)}}).fail(function(a){alert("Bad login attempt")})}},{key:"resetLogin",value:function(){$("#loginform").trigger("reset"),$("#loginmessage").empty()}},{key:"submitLogin",value:function(a){var b=a.data;13==a.keyCode&&$("#login-user").val()&&$("#login-pass").val()&&b.login()}}]),a}();