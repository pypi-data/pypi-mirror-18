

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>stem.version &mdash; Stem 1.5.2 documentation</title>
    
    <link rel="stylesheet" href="../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.5.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="top" title="Stem 1.5.2 documentation" href="../../index.html" />
    <link rel="up" title="stem" href="../stem.html" /> 
  </head>
  <body>
      <div class="header"><img class="rightlogo" src="../../_static/logo.png" alt="Logo"/><h1 class="heading"><a href="../../index.html">
          <span>Stem Docs</span></a></h1>
        <h2 class="heading"><span>stem.version</span></h2>
      </div>
      <div class="topnav">
      
        <p>

        <ul id="navbar">
          <li><a href="../../index.html">Home</a></li>
          <li><a href="../../tutorials.html">Tutorials</a>
            <ul>
              <li><a href="../../tutorials/the_little_relay_that_could.html">Hello World</a></li>
              <li><a href="../../tutorials/to_russia_with_love.html">Client Usage</a></li>
              <li><a href="../../tutorials/tortoise_and_the_hare.html">Event Listening</a></li>
              <li><a href="../../tutorials/over_the_river.html">Hidden Services</a></li>
              <li><a href="../../tutorials/mirror_mirror_on_the_wall.html">Tor Descriptors</a></li>
              <li><a href="../../tutorials/east_of_the_sun.html">Utilities</a></li>
              <li><a href="../../tutorials/down_the_rabbit_hole.html">Interpreter</a></li>
              <li><a href="../../tutorials/double_double_toil_and_trouble.html">Examples</a></li>
            </ul>
          </li>
          <li><a href="../../api.html">API</a>
            <ul>
              <li><a href="../../api/control.html">stem.control</a></li>
              <li><a href="../../api/connection.html">stem.connection</a></li>
              <li><a href="../../api/socket.html">stem.socket</a></li>
              <li><a href="../../api/process.html">stem.process</a></li>
              <li><a href="../../api/response.html">stem.response</a></li>
              <li><a href="../../api/exit_policy.html">stem.exit_policy</a></li>
              <li><a href="../../api/version.html">stem.version</a></li>
              <li><a href="../../api.html#descriptors">Descriptors</a></li>
              <li><a href="../../api.html#utilities">Utilities</a></li>
            </ul>
          </li>
          <li><a href="https://trac.torproject.org/projects/tor/wiki/doc/stem">Development</a>
            <ul>
              <li><a href="../../faq.html">FAQ</a></li>
              <li><a href="../../change_log.html">Change Log</a></li>
              <li><a href="https://trac.torproject.org/projects/tor/wiki/doc/stem/bugs">Bug Tracker</a></li>
              <li><a href="https://trac.torproject.org/projects/tor/wiki/doc/stem">Wiki</a></li>
              <li><a href="../../download.html">Download</a></li>
            </ul>
          </li>
          <li><a href="../../faq.html#where-can-i-get-help">Contact</a>
            <ul>
              <li><a href="https://lists.torproject.org/cgi-bin/mailman/listinfo/tor-dev">Email List</a></li>
              <li><a href="https://www.torproject.org/about/contact.html.en#irc">IRC</a></li>
              <li><a href="https://www.atagar.com/contact/">Author</a></li>
            </ul>
          </li>
        </ul>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for stem.version</h1><div class="highlight"><pre>
<span class="c"># Copyright 2011-2016, Damian Johnson and The Tor Project</span>
<span class="c"># See LICENSE for licensing information</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tor versioning information and requirements for its features. These can be</span>
<span class="sd">easily parsed and compared, for instance...</span>

<span class="sd">::</span>

<span class="sd">  &gt;&gt;&gt; from stem.version import get_system_tor_version, Requirement</span>
<span class="sd">  &gt;&gt;&gt; my_version = get_system_tor_version()</span>
<span class="sd">  &gt;&gt;&gt; print(my_version)</span>
<span class="sd">  0.2.1.30</span>
<span class="sd">  &gt;&gt;&gt; my_version &gt;= Requirement.TORRC_CONTROL_SOCKET</span>
<span class="sd">  True</span>

<span class="sd">**Module Overview:**</span>

<span class="sd">::</span>

<span class="sd">  get_system_tor_version - gets the version of our system&#39;s tor installation</span>

<span class="sd">  Version - Tor versioning information</span>

<span class="sd">.. data:: Requirement (enum)</span>

<span class="sd">  Enumerations for the version requirements of features.</span>

<span class="sd">  ===================================== ===========</span>
<span class="sd">  Requirement                           Description</span>
<span class="sd">  ===================================== ===========</span>
<span class="sd">  **AUTH_SAFECOOKIE**                   SAFECOOKIE authentication method</span>
<span class="sd">  **DROPGUARDS**                        DROPGUARDS requests</span>
<span class="sd">  **EVENT_AUTHDIR_NEWDESCS**            AUTHDIR_NEWDESC events</span>
<span class="sd">  **EVENT_BUILDTIMEOUT_SET**            BUILDTIMEOUT_SET events</span>
<span class="sd">  **EVENT_CIRC_MINOR**                  CIRC_MINOR events</span>
<span class="sd">  **EVENT_CLIENTS_SEEN**                CLIENTS_SEEN events</span>
<span class="sd">  **EVENT_CONF_CHANGED**                CONF_CHANGED events</span>
<span class="sd">  **EVENT_DESCCHANGED**                 DESCCHANGED events</span>
<span class="sd">  **EVENT_GUARD**                       GUARD events</span>
<span class="sd">  **EVENT_HS_DESC_CONTENT**             HS_DESC_CONTENT events</span>
<span class="sd">  **EVENT_NETWORK_LIVENESS**            NETWORK_LIVENESS events</span>
<span class="sd">  **EVENT_NEWCONSENSUS**                NEWCONSENSUS events</span>
<span class="sd">  **EVENT_NS**                          NS events</span>
<span class="sd">  **EVENT_SIGNAL**                      SIGNAL events</span>
<span class="sd">  **EVENT_STATUS**                      STATUS_GENERAL, STATUS_CLIENT, and STATUS_SERVER events</span>
<span class="sd">  **EVENT_STREAM_BW**                   STREAM_BW events</span>
<span class="sd">  **EVENT_TRANSPORT_LAUNCHED**          TRANSPORT_LAUNCHED events</span>
<span class="sd">  **EVENT_CONN_BW**                     CONN_BW events</span>
<span class="sd">  **EVENT_CIRC_BW**                     CIRC_BW events</span>
<span class="sd">  **EVENT_CELL_STATS**                  CELL_STATS events</span>
<span class="sd">  **EVENT_TB_EMPTY**                    TB_EMPTY events</span>
<span class="sd">  **EVENT_HS_DESC**                     HS_DESC events</span>
<span class="sd">  **EXTENDCIRCUIT_PATH_OPTIONAL**       EXTENDCIRCUIT queries can omit the path if the circuit is zero</span>
<span class="sd">  **FEATURE_EXTENDED_EVENTS**           &#39;EXTENDED_EVENTS&#39; optional feature</span>
<span class="sd">  **FEATURE_VERBOSE_NAMES**             &#39;VERBOSE_NAMES&#39; optional feature</span>
<span class="sd">  **GETINFO_CONFIG_TEXT**               &#39;GETINFO config-text&#39; query</span>
<span class="sd">  **HSFETCH**                           HSFETCH requests</span>
<span class="sd">  **HSPOST**                            HSPOST requests</span>
<span class="sd">  **ADD_ONION**                         ADD_ONION and DEL_ONION requests</span>
<span class="sd">  **ADD_ONION_BASIC_AUTH**              ADD_ONION supports basic authentication</span>
<span class="sd">  **ADD_ONION_NON_ANONYMOUS**           ADD_ONION supports non-anonymous mode</span>
<span class="sd">  **LOADCONF**                          LOADCONF requests</span>
<span class="sd">  **MICRODESCRIPTOR_IS_DEFAULT**        Tor gets microdescriptors by default rather than server descriptors</span>
<span class="sd">  **TAKEOWNERSHIP**                     TAKEOWNERSHIP requests</span>
<span class="sd">  **TORRC_CONTROL_SOCKET**              &#39;ControlSocket &lt;path&gt;&#39; config option</span>
<span class="sd">  **TORRC_PORT_FORWARDING**             &#39;PortForwarding&#39; config option</span>
<span class="sd">  **TORRC_DISABLE_DEBUGGER_ATTACHMENT** &#39;DisableDebuggerAttachment&#39; config option</span>
<span class="sd">  **TORRC_VIA_STDIN**                   Allow torrc options via &#39;tor -f -&#39; (:trac:`13865`)</span>
<span class="sd">  ===================================== ===========</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">stem.util.enum</span>
<span class="kn">import</span> <span class="nn">stem.util.system</span>

<span class="kn">from</span> <span class="nn">stem.util</span> <span class="kn">import</span> <span class="n">_hash_attr</span>

<span class="k">try</span><span class="p">:</span>
  <span class="c"># added in python 3.2</span>
  <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
  <span class="kn">from</span> <span class="nn">stem.util.lru_cache</span> <span class="kn">import</span> <span class="n">lru_cache</span>

<span class="c"># cache for the get_system_tor_version function</span>
<span class="n">VERSION_CACHE</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="get_system_tor_version"><a class="viewcode-back" href="../../api/version.html#stem.version.get_system_tor_version">[docs]</a><span class="k">def</span> <span class="nf">get_system_tor_version</span><span class="p">(</span><span class="n">tor_cmd</span> <span class="o">=</span> <span class="s">&#39;tor&#39;</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Queries tor for its version. This is os dependent, only working on linux,</span>
<span class="sd">  osx, and bsd.</span>

<span class="sd">  :param str tor_cmd: command used to run tor</span>

<span class="sd">  :returns: :class:`~stem.version.Version` provided by the tor command</span>

<span class="sd">  :raises: **IOError** if unable to query or parse the version</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">if</span> <span class="n">tor_cmd</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VERSION_CACHE</span><span class="p">:</span>
    <span class="n">version_cmd</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> --version&#39;</span> <span class="o">%</span> <span class="n">tor_cmd</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="n">version_output</span> <span class="o">=</span> <span class="n">stem</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">version_cmd</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
      <span class="c"># make the error message nicer if this is due to tor being unavialable</span>

      <span class="k">if</span> <span class="s">&#39;No such file or directory&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">tor_cmd</span><span class="p">):</span>
          <span class="n">exc</span> <span class="o">=</span> <span class="s">&quot;Unable to check tor&#39;s version. &#39;</span><span class="si">%s</span><span class="s">&#39; doesn&#39;t exist.&quot;</span> <span class="o">%</span> <span class="n">tor_cmd</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">exc</span> <span class="o">=</span> <span class="s">&quot;Unable to run &#39;</span><span class="si">%s</span><span class="s">&#39;. Mabye tor isn&#39;t in your PATH?&quot;</span> <span class="o">%</span> <span class="n">version_cmd</span>

      <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">version_output</span><span class="p">:</span>
      <span class="c"># output example:</span>
      <span class="c"># Oct 21 07:19:27.438 [notice] Tor v0.2.1.30. This is experimental software. Do not rely on it for strong anonymity. (Running on Linux i686)</span>
      <span class="c"># Tor version 0.2.1.30.</span>

      <span class="n">last_line</span> <span class="o">=</span> <span class="n">version_output</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

      <span class="k">if</span> <span class="n">last_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;Tor version &#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">last_line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
          <span class="n">version_str</span> <span class="o">=</span> <span class="n">last_line</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
          <span class="n">VERSION_CACHE</span><span class="p">[</span><span class="n">tor_cmd</span><span class="p">]</span> <span class="o">=</span> <span class="n">Version</span><span class="p">(</span><span class="n">version_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Unexpected response from &#39;</span><span class="si">%s</span><span class="s">&#39;: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">version_cmd</span><span class="p">,</span> <span class="n">last_line</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; didn&#39;t have any output&quot;</span> <span class="o">%</span> <span class="n">version_cmd</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">VERSION_CACHE</span><span class="p">[</span><span class="n">tor_cmd</span><span class="p">]</span>

</div>
<span class="nd">@lru_cache</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">_get_version</span><span class="p">(</span><span class="n">version_str</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">Version</span><span class="p">(</span><span class="n">version_str</span><span class="p">)</span>


<div class="viewcode-block" id="Version"><a class="viewcode-back" href="../../api/version.html#stem.version.Version">[docs]</a><span class="k">class</span> <span class="nc">Version</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Comparable tor version. These are constructed from strings that conform to</span>
<span class="sd">  the &#39;new&#39; style in the `tor version-spec</span>
<span class="sd">  &lt;https://gitweb.torproject.org/torspec.git/tree/version-spec.txt&gt;`_,</span>
<span class="sd">  such as &quot;0.1.4&quot; or &quot;0.2.2.23-alpha (git-7dcd105be34a4f44)&quot;.</span>

<span class="sd">  :var int major: major version</span>
<span class="sd">  :var int minor: minor version</span>
<span class="sd">  :var int micro: micro version</span>
<span class="sd">  :var int patch: patch level (**None** if undefined)</span>
<span class="sd">  :var str status: status tag such as &#39;alpha&#39; or &#39;beta-dev&#39; (**None** if undefined)</span>
<span class="sd">  :var str extra: extra information without its parentheses such as</span>
<span class="sd">    &#39;git-8be6058d8f31e578&#39; (**None** if undefined)</span>
<span class="sd">  :var str git_commit: git commit id (**None** if it wasn&#39;t provided)</span>

<span class="sd">  :param str version_str: version to be parsed</span>

<span class="sd">  :raises: **ValueError** if input isn&#39;t a valid tor version</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_str</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">version_str</span> <span class="o">=</span> <span class="n">version_str</span>
    <span class="n">version_parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&#39;^([0-9]+)\.([0-9]+)\.([0-9]+)(\.[0-9]+)?(-\S*)?( \(\S*\))?$&#39;</span><span class="p">,</span> <span class="n">version_str</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="n">version_parts</span><span class="p">:</span>
      <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">micro</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">version_parts</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>

      <span class="c"># The patch and status matches are optional (may be None) and have an extra</span>
      <span class="c"># proceeding period or dash if they exist. Stripping those off.</span>

      <span class="k">if</span> <span class="n">patch</span><span class="p">:</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">patch</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

      <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

      <span class="k">if</span> <span class="n">extra</span><span class="p">:</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="n">extra</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">major</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">minor</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">minor</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">micro</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">micro</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">extra</span> <span class="o">=</span> <span class="n">extra</span>

      <span class="k">if</span> <span class="n">extra</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^git-[0-9a-f]{16}$&#39;</span><span class="p">,</span> <span class="n">extra</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">git_commit</span> <span class="o">=</span> <span class="n">extra</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">git_commit</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; isn&#39;t a properly formatted tor version&quot;</span> <span class="o">%</span> <span class="n">version_str</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides the string used to construct the version.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_str</span>

  <span class="k">def</span> <span class="nf">_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compares version ordering according to the spec.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Version</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">False</span>

    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;major&#39;</span><span class="p">,</span> <span class="s">&#39;minor&#39;</span><span class="p">,</span> <span class="s">&#39;micro&#39;</span><span class="p">,</span> <span class="s">&#39;patch&#39;</span><span class="p">):</span>
      <span class="n">my_version</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
      <span class="n">other_version</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">my_version</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">my_version</span> <span class="o">=</span> <span class="mi">0</span>

      <span class="k">if</span> <span class="n">other_version</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">other_version</span> <span class="o">=</span> <span class="mi">0</span>

      <span class="k">if</span> <span class="n">my_version</span> <span class="o">!=</span> <span class="n">other_version</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">my_version</span><span class="p">,</span> <span class="n">other_version</span><span class="p">)</span>

    <span class="c"># According to the version spec...</span>
    <span class="c">#</span>
    <span class="c">#   If we *do* encounter two versions that differ only by status tag, we</span>
    <span class="c">#   compare them lexically as ASCII byte strings.</span>

    <span class="n">my_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    <span class="n">other_status</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">status</span> <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">status</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>

    <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">my_status</span><span class="p">,</span> <span class="n">other_status</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">=</span> <span class="n">_hash_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;major&#39;</span><span class="p">,</span> <span class="s">&#39;minor&#39;</span><span class="p">,</span> <span class="s">&#39;micro&#39;</span><span class="p">,</span> <span class="s">&#39;patch&#39;</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>

  <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="n">s</span> <span class="o">==</span> <span class="n">o</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

  <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if this version meets the requirements for a given feature. We can</span>
<span class="sd">    be compared to either a :class:`~stem.version.Version` or</span>
<span class="sd">    :class:`~stem.version._VersionRequirements`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_VersionRequirements</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
          <span class="k">return</span> <span class="bp">True</span>

      <span class="k">return</span> <span class="bp">False</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="n">o</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_VersionRequirements</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
          <span class="k">return</span> <span class="bp">True</span>

      <span class="k">return</span> <span class="bp">False</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="n">o</span><span class="p">)</span>

</div>
<span class="k">class</span> <span class="nc">_VersionRequirements</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Series of version constraints that can be compared to. For instance, this</span>
<span class="sd">  allows for comparisons like &#39;if I&#39;m greater than version X in the 0.2.2</span>
<span class="sd">  series, or greater than version Y in the 0.2.3 series&#39;.</span>

<span class="sd">  This is a logical &#39;or&#39; of the series of rules.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="k">def</span> <span class="nf">greater_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">inclusive</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a constraint that we&#39;re greater than the given version.</span>

<span class="sd">    :param stem.version.Version version: version we&#39;re checking against</span>
<span class="sd">    :param bool inclusive: if comparison is inclusive or not</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">inclusive</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">version</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">version</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">less_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">inclusive</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a constraint that we&#39;re less than the given version.</span>

<span class="sd">    :param stem.version.Version version: version we&#39;re checking against</span>
<span class="sd">    :param bool inclusive: if comparison is inclusive or not</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">inclusive</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">version</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">version</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">in_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_version</span><span class="p">,</span> <span class="n">to_version</span><span class="p">,</span> <span class="n">from_inclusive</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">to_inclusive</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds constraint that we&#39;re within the range from one version to another.</span>

<span class="sd">    :param stem.version.Version from_version: beginning of the comparison range</span>
<span class="sd">    :param stem.version.Version to_version: end of the comparison range</span>
<span class="sd">    :param bool from_inclusive: if comparison is inclusive with the starting version</span>
<span class="sd">    :param bool to_inclusive: if comparison is inclusive with the ending version</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">new_rule</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">from_inclusive</span> <span class="ow">and</span> <span class="n">to_inclusive</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">from_version</span> <span class="o">&lt;=</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="n">to_version</span>
      <span class="k">elif</span> <span class="n">from_inclusive</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">from_version</span> <span class="o">&lt;=</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">to_version</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">from_version</span> <span class="o">&lt;</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">to_version</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_rule</span><span class="p">)</span>

<span class="n">safecookie_req</span> <span class="o">=</span> <span class="n">_VersionRequirements</span><span class="p">()</span>
<span class="n">safecookie_req</span><span class="o">.</span><span class="n">in_range</span><span class="p">(</span><span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.2.36&#39;</span><span class="p">),</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.3.0&#39;</span><span class="p">))</span>
<span class="n">safecookie_req</span><span class="o">.</span><span class="n">greater_than</span><span class="p">(</span><span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.3.13&#39;</span><span class="p">))</span>

<span class="n">Requirement</span> <span class="o">=</span> <span class="n">stem</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span>
  <span class="p">(</span><span class="s">&#39;AUTH_SAFECOOKIE&#39;</span><span class="p">,</span> <span class="n">safecookie_req</span><span class="p">),</span>
  <span class="p">(</span><span class="s">&#39;DROPGUARDS&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.5.1-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_AUTHDIR_NEWDESCS&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.1.1.10-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_BUILDTIMEOUT_SET&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.2.7-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_CIRC_MINOR&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.3.11-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_CLIENTS_SEEN&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.1.10-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_CONF_CHANGED&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.3.3-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_DESCCHANGED&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.1.2.2-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_GUARD&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.1.2.5-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_HS_DESC_CONTENT&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.7.1-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_NS&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.1.2.3-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_NETWORK_LIVENESS&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.7.2-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_NEWCONSENSUS&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.1.13-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_SIGNAL&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.3.1-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_STATUS&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.1.2.3-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_STREAM_BW&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.1.2.8-beta&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_TRANSPORT_LAUNCHED&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.5.0-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_CONN_BW&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.5.2-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_CIRC_BW&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.5.2-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_CELL_STATS&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.5.2-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_TB_EMPTY&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.5.2-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EVENT_HS_DESC&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.5.2-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;EXTENDCIRCUIT_PATH_OPTIONAL&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.2.9&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;FEATURE_EXTENDED_EVENTS&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.2.1-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;FEATURE_VERBOSE_NAMES&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.2.1-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;GETINFO_CONFIG_TEXT&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.2.7-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;HSFETCH&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.7.1-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;HSPOST&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.7.1-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;ADD_ONION&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.7.1-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;ADD_ONION_BASIC_AUTH&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.9.1-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;ADD_ONION_NON_ANONYMOUS&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.9.3-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;LOADCONF&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.1.1&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;MICRODESCRIPTOR_IS_DEFAULT&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.3.3&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;TAKEOWNERSHIP&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.2.28-beta&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;TORRC_CONTROL_SOCKET&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.0.30&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;TORRC_PORT_FORWARDING&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.3.1-alpha&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;TORRC_DISABLE_DEBUGGER_ATTACHMENT&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.3.9&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s">&#39;TORRC_VIA_STDIN&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="p">(</span><span class="s">&#39;0.2.6.3-alpha&#39;</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>

      </div>
      <div class="bottomnav">
      </div>

    <div class="footer">
    </div>
  </body>
</html>