

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Frequently Asked Questions &mdash; Stem 1.5.2 documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.5.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="top" title="Stem 1.5.2 documentation" href="index.html" /> 
  </head>
  <body>
      <div class="header"><img class="rightlogo" src="_static/logo.png" alt="Logo"/><h1 class="heading"><a href="index.html">
          <span>Stem Docs</span></a></h1>
        <h2 class="heading"><span>Frequently Asked Questions</span></h2>
      </div>
      <div class="topnav">
      
        <p>

        <ul id="navbar">
          <li><a href="index.html">Home</a></li>
          <li><a href="tutorials.html">Tutorials</a>
            <ul>
              <li><a href="tutorials/the_little_relay_that_could.html">Hello World</a></li>
              <li><a href="tutorials/to_russia_with_love.html">Client Usage</a></li>
              <li><a href="tutorials/tortoise_and_the_hare.html">Event Listening</a></li>
              <li><a href="tutorials/over_the_river.html">Hidden Services</a></li>
              <li><a href="tutorials/mirror_mirror_on_the_wall.html">Tor Descriptors</a></li>
              <li><a href="tutorials/east_of_the_sun.html">Utilities</a></li>
              <li><a href="tutorials/down_the_rabbit_hole.html">Interpreter</a></li>
              <li><a href="tutorials/double_double_toil_and_trouble.html">Examples</a></li>
            </ul>
          </li>
          <li><a href="api.html">API</a>
            <ul>
              <li><a href="api/control.html">stem.control</a></li>
              <li><a href="api/connection.html">stem.connection</a></li>
              <li><a href="api/socket.html">stem.socket</a></li>
              <li><a href="api/process.html">stem.process</a></li>
              <li><a href="api/response.html">stem.response</a></li>
              <li><a href="api/exit_policy.html">stem.exit_policy</a></li>
              <li><a href="api/version.html">stem.version</a></li>
              <li><a href="api.html#descriptors">Descriptors</a></li>
              <li><a href="api.html#utilities">Utilities</a></li>
            </ul>
          </li>
          <li><a href="https://trac.torproject.org/projects/tor/wiki/doc/stem">Development</a>
            <ul>
              <li><a href="#">FAQ</a></li>
              <li><a href="change_log.html">Change Log</a></li>
              <li><a href="https://trac.torproject.org/projects/tor/wiki/doc/stem/bugs">Bug Tracker</a></li>
              <li><a href="https://trac.torproject.org/projects/tor/wiki/doc/stem">Wiki</a></li>
              <li><a href="download.html">Download</a></li>
            </ul>
          </li>
          <li><a href="##where-can-i-get-help">Contact</a>
            <ul>
              <li><a href="https://lists.torproject.org/cgi-bin/mailman/listinfo/tor-dev">Email List</a></li>
              <li><a href="https://www.torproject.org/about/contact.html.en#irc">IRC</a></li>
              <li><a href="https://www.atagar.com/contact/">Author</a></li>
            </ul>
          </li>
        </ul>
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="frequently-asked-questions">
<h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><strong>General Information</strong></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#what-is-stem"><em>What is Stem?</em></a></li>
<li><a class="reference internal" href="#does-stem-have-any-dependencies"><em>Does Stem have any dependencies?</em></a></li>
<li><a class="reference internal" href="#what-python-versions-is-stem-compatible-with"><em>What Python versions is Stem compatible with?</em></a></li>
<li><a class="reference internal" href="#can-i-interact-with-tors-controller-interface-directly"><em>Can I interact with Tor's controller interface directly?</em></a></li>
<li><a class="reference internal" href="#are-there-any-other-controller-libraries"><em>Are there any other controller libraries?</em></a></li>
<li><a class="reference internal" href="#what-license-is-stem-under"><em>What license is Stem under?</em></a></li>
<li><a class="reference internal" href="#where-can-i-get-help"><em>Where can I get help?</em></a></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><strong>Usage</strong></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#how-do-i-connect-to-tor"><em>How do I connect to Tor?</em></a></li>
<li><a class="reference internal" href="#how-do-i-request-a-new-identity-from-tor"><em>How do I request a new identity from Tor?</em></a></li>
<li><a class="reference internal" href="#how-do-i-reload-my-torrc"><em>How do I reload my torrc?</em></a></li>
<li><a class="reference internal" href="#how-do-i-read-tar-xz-descriptor-archives"><em>How do I read *.tar.xz descriptor archives?</em></a></li>
<li><a class="reference internal" href="#what-is-that-with-keyword-i-keep-seeing-in-the-tutorials"><em>What is that 'with' keyword I keep seeing in the tutorials?</em></a></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><strong>Development</strong></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#how-do-i-get-started"><em>How do I get started?</em></a></li>
<li><a class="reference internal" href="#how-do-i-run-the-tests"><em>How do I run the tests?</em></a></li>
<li><a class="reference internal" href="#how-do-i-test-compatibility-with-multiple-python-versions"><em>How can I test compatibility with multiple python versions?</em></a></li>
<li><a class="reference internal" href="#how-do-i-build-the-site"><em>How do I build the site?</em></a></li>
<li><a class="reference internal" href="#what-is-the-copyright-for-patches"><em>What is the copyright for patches?</em></a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="general-information">
<h1>General Information<a class="headerlink" href="#general-information" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-stem">
<span id="id1"></span><h2>What is Stem?<a class="headerlink" href="#what-is-stem" title="Permalink to this headline">¶</a></h2>
<p>Stem is a Python controller library that you can use to interact with <a class="reference external" href="https://www.torproject.org/">Tor</a>. With it you can write scripts and applications
with capabilities similar <a class="reference external" href="https://www.atagar.com/arm/">arm</a>.</p>
<p>From a technical standpoint, Stem is a Python implementation of Tor's
<a class="reference external" href="https://gitweb.torproject.org/torspec.git/tree/dir-spec.txt">directory</a> and
<a class="reference external" href="https://gitweb.torproject.org/torspec.git/tree/control-spec.txt">control specifications</a>. <a class="reference external" href="tutorials.html">To get
started see our tutorials!</a></p>
</div>
<div class="section" id="does-stem-have-any-dependencies">
<span id="id2"></span><h2>Does Stem have any dependencies?<a class="headerlink" href="#does-stem-have-any-dependencies" title="Permalink to this headline">¶</a></h2>
<p><strong>No.</strong> All you need in order to use Stem is Python.</p>
<p>When it is available Stem will use <a class="reference external" href="https://www.dlitz.net/software/pycrypto/">pycrypto</a> to validate descriptor signatures.
However, there is no need to install pycrypto unless you need this
functionality.</p>
</div>
<div class="section" id="what-python-versions-is-stem-compatible-with">
<span id="id3"></span><h2>What Python versions is Stem compatible with?<a class="headerlink" href="#what-python-versions-is-stem-compatible-with" title="Permalink to this headline">¶</a></h2>
<p>Stem works with <strong>Python 2.6 and greater</strong>, including the Python 3.x series.</p>
</div>
<div class="section" id="can-i-interact-with-tor-s-controller-interface-directly">
<span id="can-i-interact-with-tors-controller-interface-directly"></span><h2>Can I interact with Tor's controller interface directly?<a class="headerlink" href="#can-i-interact-with-tor-s-controller-interface-directly" title="Permalink to this headline">¶</a></h2>
<p>Yup. You don't need a library to interact with Tor's <a class="reference external" href="https://gitweb.torproject.org/torspec.git/tree/control-spec.txt">controller interface</a>, and
interacting with it directly is a great way to learn about what it can do. The
exact details for how you connect to Tor depend on two things...</p>
<ul class="simple">
<li>Where is Tor listening for controller connections? This is specified by
either the <strong>ControlPort</strong> or <strong>ControlSocket</strong> option in your torrc. If you
have neither then Tor will not accept controller connections.</li>
<li>What type of authentication is Tor's controller interface using? This is
defined by your <strong>CookieAuthentication</strong> or <strong>HashedControlPassword</strong> option.
If you have neither then Tor does not restrict access.</li>
</ul>
<p>We'll tackle each of these scenarios one at a time...</p>
<div class="section" id="i-m-using-a-controlport">
<h3><strong>I'm using a ControlPort</strong><a class="headerlink" href="#i-m-using-a-controlport" title="Permalink to this headline">¶</a></h3>
<p>If you are using a <strong>ControlPort</strong> then the easiest method of talking with Tor
is via <strong>telnet</strong>. You always need to authenticate after connecting, even if
Tor does not restrict access. If your torrc doesn't have a
<strong>CookieAuthentication</strong> or <strong>HashedControlPassword</strong> then to authenticate you
will simply call <strong>AUTHENTICATE</strong> after connecting without any credentials.</p>
<div class="highlight-python"><pre>% cat ~/.tor/torrc
ControlPort 9051

% telnet localhost 9051
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
AUTHENTICATE
250 OK
GETINFO version
250-version=0.2.5.1-alpha-dev (git-245ecfff36c0cecc)
250 OK
QUIT
250 closing connection
Connection closed by foreign host.</pre>
</div>
</div>
<div class="section" id="i-m-using-a-controlsocket">
<h3><strong>I'm using a ControlSocket</strong><a class="headerlink" href="#i-m-using-a-controlsocket" title="Permalink to this headline">¶</a></h3>
<p>A <strong>ControlSocket</strong> is a file based socket, so we'll use <strong>socat</strong> to connect
to it...</p>
<div class="highlight-python"><pre>% cat ~/.tor/torrc
ControlSocket /home/atagar/.tor/socket

% socat UNIX-CONNECT:/home/atagar/.tor/socket STDIN
AUTHENTICATE
250 OK
GETINFO version
250-version=0.2.5.1-alpha-dev (git-245ecfff36c0cecc)
250 OK
QUIT
250 closing connection</pre>
</div>
</div>
<div class="section" id="i-m-using-cookie-authentication">
<h3><strong>I'm using cookie authentication</strong><a class="headerlink" href="#i-m-using-cookie-authentication" title="Permalink to this headline">¶</a></h3>
<p>Cookie authentication simply means that your credential is the content of a
file in Tor's <strong>DataDirectory</strong>. You can learn information about Tor's method
of authentication (including the cookie file's location) by calling
<strong>PROTOCOLINFO</strong>...</p>
<div class="highlight-python"><pre>% cat ~/.tor/torrc
ControlPort 9051
CookieAuthentication 1

% telnet localhost 9051
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
PROTOCOLINFO
250-PROTOCOLINFO 1
250-AUTH METHODS=COOKIE,SAFECOOKIE COOKIEFILE="/home/atagar/.tor/control_auth_cookie"
250-VERSION Tor="0.2.5.1-alpha-dev"
250 OK</pre>
</div>
<p>Cookie authentication has two flavors: <strong>COOKIE</strong> and <strong>SAFECOOKIE</strong>. Below
we'll show you how to authenticate via COOKIE. SAFECOOKIE authentication is a
lot more involved, and not something you will want to do by hand (though Stem
supports it transparently).</p>
<p>To get the credential for your AUTHENTICATE command we will use <strong>hexdump</strong>...</p>
<div class="highlight-python"><pre>% hexdump -e '32/1 "%02x""\n"' /home/atagar/.tor/control_auth_cookie
be9c9e18364e33d5eb8ba820d456aa2bc03444c0420f089ba4569b6aeecc6254

% telnet localhost 9051
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
AUTHENTICATE be9c9e18364e33d5eb8ba820d456aa2bc03444c0420f089ba4569b6aeecc6254
250 OK
GETINFO version
250-version=0.2.5.1-alpha-dev (git-245ecfff36c0cecc)
250 OK
QUIT
250 closing connection
Connection closed by foreign host.</pre>
</div>
</div>
<div class="section" id="i-m-using-password-authentication">
<h3><strong>I'm using password authentication</strong><a class="headerlink" href="#i-m-using-password-authentication" title="Permalink to this headline">¶</a></h3>
<p>Tor's other method of authentication is a credential you know. To use it ask
Tor to hash your password, then use that in your torrc...</p>
<div class="highlight-python"><pre>% tor --hash-password "my_password"
16:E600ADC1B52C80BB6022A0E999A7734571A451EB6AE50FED489B72E3DF</pre>
</div>
<p>Authenticating with this simply involves giving Tor the credential...</p>
<div class="highlight-python"><pre>% cat ~/.tor/torrc
ControlPort 9051
HashedControlPassword 16:E600ADC1B52C80BB6022A0E999A7734571A451EB6AE50FED489B72E3DF

% telnet localhost 9051
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
AUTHENTICATE "my_password"
250 OK
GETINFO version
250-version=0.2.5.1-alpha-dev (git-245ecfff36c0cecc)
250 OK
QUIT
250 closing connection
Connection closed by foreign host.</pre>
</div>
</div>
</div>
<div class="section" id="are-there-any-other-controller-libraries">
<span id="id4"></span><h2>Are there any other controller libraries?<a class="headerlink" href="#are-there-any-other-controller-libraries" title="Permalink to this headline">¶</a></h2>
<p>Yup. The most mature controller libraries are written in Python, but there's a
few options in other languages as well. By far the most mature alternative to
Stem are <a class="reference external" href="https://txtorcon.readthedocs.org/">Txtorcon</a> and <a class="reference external" href="https://gitweb.torproject.org/pytorctl.git">TorCtl</a>.</p>
<p><a class="reference external" href="https://txtorcon.readthedocs.org/">Txtorcon</a> is an actively maintained
controller library written by Meejah for <a class="reference external" href="https://twistedmatrix.com/trac/">Twisted</a>. In the future we plan to <a class="reference external" href="https://www.torproject.org/getinvolved/volunteer.html.en#txtorcon-stemIntegration">integrate Stem
and Txtorcon</a>
to some degree, but that is still a ways off.</p>
<p><a class="reference external" href="https://gitweb.torproject.org/pytorctl.git">TorCtl</a> was Stem's predecessor
and <a class="reference external" href="https://blog.torproject.org/blog/torctl-deprecation-and-stem-plans">deprecated in December 2012</a> in favor
of Stem. Though no longer actively developed, it's still quite functional and
still used for several <a class="reference external" href="https://gitweb.torproject.org/torflow.git">TorFlow</a>
based projects.</p>
<p>The following are the functional controller libraries I'm aware of. Dates are
for highly active development. If I missed one then please <a class="reference external" href="https://www.atagar.com/contact/">let me know</a>!</p>
<table border="1" class="docutils">
<colgroup>
<col width="62%" />
<col width="15%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Library</th>
<th class="head">Language</th>
<th class="head">Developed</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference external" href="https://stem.torproject.org/">Stem</a></td>
<td>Python</td>
<td>October 2011 - Present</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://txtorcon.readthedocs.org/">Txtorcon</a></td>
<td>Python (Twisted)</td>
<td>February 2012 - Present</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://gitweb.torproject.org/pytorctl.git">TorCtl</a></td>
<td>Python</td>
<td>July 2008 - November 2011</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://github.com/dunglas/php-torcontrol/">PHP TorCtl</a></td>
<td>PHP</td>
<td>February 2013</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://gitweb.torproject.org/jtorctl.git">JTorCtl</a></td>
<td>Java</td>
<td>June 2005 - May 2009</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://github.com/sycamoreone/orc">Orc</a></td>
<td>Go</td>
<td>January 2015</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://github.com/Yawning/bulb">Bulb</a></td>
<td>Go</td>
<td>March 2015</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://github.com/Dhole/rust-tor-controller">Rust Controller</a></td>
<td>Rust</td>
<td>May 2016</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="what-license-is-stem-under">
<span id="id9"></span><h2>What license is Stem under?<a class="headerlink" href="#what-license-is-stem-under" title="Permalink to this headline">¶</a></h2>
<p>Stem is under the <a class="reference external" href="https://www.gnu.org/licenses/lgpl">LGPLv3</a>.</p>
</div>
<div class="section" id="where-can-i-get-help">
<span id="id10"></span><h2>Where can I get help?<a class="headerlink" href="#where-can-i-get-help" title="Permalink to this headline">¶</a></h2>
<p>Do you have a Tor related question or project that you would like to discuss?
If so then find us on the <a class="reference external" href="https://lists.torproject.org/cgi-bin/mailman/listinfo/tor-dev">tor-dev&#64; email list</a> and <a class="reference external" href="https://www.torproject.org/about/contact.html.en#irc">IRC</a>.</p>
</div>
</div>
<div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="how-do-i-connect-to-tor">
<span id="id11"></span><h2>How do I connect to Tor?<a class="headerlink" href="#how-do-i-connect-to-tor" title="Permalink to this headline">¶</a></h2>
<p>Once you have Tor running and <a class="reference external" href="tutorials/the_little_relay_that_could.html">properly configured</a> you have a few ways of connecting to it. The following are the most common methods for getting a <a class="reference internal" href="api/control.html#stem.control.Controller" title="stem.control.Controller"><tt class="xref py py-class docutils literal"><span class="pre">Controller</span></tt></a> instance, from the highest to lowest level...</p>
<ol class="arabic">
<li><p class="first"><a class="reference external" href="api/connection.html">Connection Module</a></p>
<p>Writing a commandline script? Then the <a class="reference internal" href="api/connection.html#stem.connection.connect" title="stem.connection.connect"><tt class="xref py py-func docutils literal"><span class="pre">connect()</span></tt></a>
function provide you the quickest and most hassle free method for getting a
<a class="reference internal" href="api/control.html#stem.control.Controller" title="stem.control.Controller"><tt class="xref py py-class docutils literal"><span class="pre">Controller</span></tt></a>.</p>
<p>This function connects and authenticates to the given port or socket,
providing you a one-line method of getting a
<a class="reference internal" href="api/control.html#stem.control.Controller" title="stem.control.Controller"><tt class="xref py py-class docutils literal"><span class="pre">Controller</span></tt></a> that's ready to use. If Tor requires a
password then the user will be prompted for it. When the connection cannot
be established this prints a description of the problem to stdout and
returns <strong>None</strong>.</p>
</li>
<li><p class="first"><a class="reference external" href="api/control.html">Control Module</a></p>
<p>The connection module helpers above are all well and good when you need a
quick-and-dirty connection for your commandline script, but they're
inflexible. In particular their lack of exceptions and direct use of
stdin/stdout make them undesirable for more complicated situations. That's
where the Controller's <a class="reference internal" href="api/control.html#stem.control.Controller.from_port" title="stem.control.Controller.from_port"><tt class="xref py py-func docutils literal"><span class="pre">from_port()</span></tt></a> and
<a class="reference internal" href="api/control.html#stem.control.Controller.from_socket_file" title="stem.control.Controller.from_socket_file"><tt class="xref py py-func docutils literal"><span class="pre">from_socket_file()</span></tt></a> methods come in.</p>
<p>These provide the most flexible method of connecting to Tor, and for
sophisticated applications is what you'll want.</p>
</li>
<li><p class="first"><a class="reference external" href="api/socket.html">Socket Module</a></p>
<p>For the diehards among us you can skip the conveniences of a high level
<a class="reference internal" href="api/control.html#stem.control.Controller" title="stem.control.Controller"><tt class="xref py py-class docutils literal"><span class="pre">Controller</span></tt></a> and work directly with the raw components.
At Stem's lowest level your connection with Tor is a
<a class="reference internal" href="api/socket.html#stem.socket.ControlSocket" title="stem.socket.ControlSocket"><tt class="xref py py-class docutils literal"><span class="pre">ControlSocket</span></tt></a> subclass. This provides methods to send,
receive, disconnect, and reconnect to Tor.</p>
</li>
</ol>
</div>
<div class="section" id="how-do-i-request-a-new-identity-from-tor">
<span id="id12"></span><h2>How do I request a new identity from Tor?<a class="headerlink" href="#how-do-i-request-a-new-identity-from-tor" title="Permalink to this headline">¶</a></h2>
<p>In Tor your identity is the three-hop <strong>circuit</strong> over which your traffic travels through the Tor network.</p>
<p>Tor periodically creates new circuits. When a circuit is used it becomes <strong>dirty</strong>, and after ten minutes new connections will not use it. When all of the connections using an expired circuit are done the circuit is closed.</p>
<p>An important thing to note is that a new circuit does not necessarily mean a new IP address. Paths are randomly selected based on heuristics like speed and stability. There are only so many large exits in the Tor network, so it's not uncommon to reuse an exit you have had previously.</p>
<p>Tor does not have a method for cycling your IP address. This is on purpose, and done for a couple reasons. The first is that this capability is usually requested for not-so-nice reasons such as ban evasion or SEO. Second, repeated circuit creation puts a very high load on the Tor network, so please don't!</p>
<p>With all that out of the way, how do you create a new circuit? You can customize the rate at which Tor cycles circuits with the <strong>MaxCircuitDirtiness</strong> option in your <a class="reference external" href="https://www.torproject.org/docs/faq.html.en#torrc">torrc</a>. <a class="reference external" href="https://en.wikipedia.org/wiki/Vidalia_%28software%29">Vidalia</a> and <a class="reference external" href="https://www.atagar.com/arm/">arm</a> both provide a method to request a new identity, and you can do so programmatically by sending Tor a NEWNYM signal.</p>
<p>To do this with telnet...</p>
<div class="highlight-python"><pre>% telnet localhost 9051
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
AUTHENTICATE
250 OK
SIGNAL NEWNYM
250 OK</pre>
</div>
<p>And with Stem...</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">stem</span> <span class="kn">import</span> <span class="n">Signal</span>
<span class="kn">from</span> <span class="nn">stem.control</span> <span class="kn">import</span> <span class="n">Controller</span>

<span class="k">with</span> <span class="n">Controller</span><span class="o">.</span><span class="n">from_port</span><span class="p">(</span><span class="n">port</span> <span class="o">=</span> <span class="mi">9051</span><span class="p">)</span> <span class="k">as</span> <span class="n">controller</span><span class="p">:</span>
  <span class="n">controller</span><span class="o">.</span><span class="n">authenticate</span><span class="p">()</span>
  <span class="n">controller</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">Signal</span><span class="o">.</span><span class="n">NEWNYM</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-reload-my-torrc">
<span id="id14"></span><h2>How do I reload my torrc?<a class="headerlink" href="#how-do-i-reload-my-torrc" title="Permalink to this headline">¶</a></h2>
<p>Tor is configured through its <a class="reference external" href="https://www.torproject.org/docs/faq.html.en#torrc">torrc</a>. When you edit this file
you need to either restart Tor or issue a <strong>HUP</strong> for the changes to be
reflected. To issue a HUP you can either...</p>
<blockquote>
<div><ul class="simple">
<li>Run <strong>pkill -sighup tor</strong>.</li>
<li>Send Tor a <strong>HUP</strong> signal through its control port...</li>
</ul>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">stem</span> <span class="kn">import</span> <span class="n">Signal</span>
<span class="kn">from</span> <span class="nn">stem.control</span> <span class="kn">import</span> <span class="n">Controller</span>

<span class="k">with</span> <span class="n">Controller</span><span class="o">.</span><span class="n">from_port</span><span class="p">(</span><span class="n">port</span> <span class="o">=</span> <span class="mi">9051</span><span class="p">)</span> <span class="k">as</span> <span class="n">controller</span><span class="p">:</span>
  <span class="n">controller</span><span class="o">.</span><span class="n">authenticate</span><span class="p">()</span>
  <span class="n">controller</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">Signal</span><span class="o">.</span><span class="n">HUP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-read-tar-xz-descriptor-archives">
<span id="id16"></span><h2>How do I read *.tar.xz descriptor archives?<a class="headerlink" href="#how-do-i-read-tar-xz-descriptor-archives" title="Permalink to this headline">¶</a></h2>
<p>Stem's <a class="reference internal" href="api/descriptor/descriptor.html#stem.descriptor.__init__.parse_file" title="stem.descriptor.__init__.parse_file"><tt class="xref py py-func docutils literal"><span class="pre">parse_file()</span></tt></a> and
<a class="reference internal" href="api/descriptor/reader.html#stem.descriptor.reader.DescriptorReader" title="stem.descriptor.reader.DescriptorReader"><tt class="xref py py-class docutils literal"><span class="pre">DescriptorReader</span></tt></a>
can read plaintext descriptors and tarballs. However, <a class="reference external" href="https://lists.torproject.org/pipermail/tor-dev/2014-May/006884.html">metrics uses *.xz
compression</a>. Python
3.3 adds builtin xz support, but if you're using an earlier version of python
you will need to decompress the archives yourself.</p>
<p>With modern versions of tar you can simply decompress archives via <strong>tar xf
archive.tar.xz</strong>, or programmatically using <a class="reference external" href="https://pypi.python.org/pypi/pyliblzma">lzma</a>.</p>
</div>
<div class="section" id="what-is-that-with-keyword-i-keep-seeing-in-the-tutorials">
<span id="id17"></span><h2>What is that 'with' keyword I keep seeing in the tutorials?<a class="headerlink" href="#what-is-that-with-keyword-i-keep-seeing-in-the-tutorials" title="Permalink to this headline">¶</a></h2>
<p>Python's <a class="reference external" href="http://effbot.org/zone/python-with-statement.htm">with</a> keyword
is shorthand for a try/finally block. With a <a class="reference internal" href="api/control.html#stem.control.Controller" title="stem.control.Controller"><tt class="xref py py-class docutils literal"><span class="pre">Controller</span></tt></a>
the following...</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">Controller</span><span class="o">.</span><span class="n">from_port</span><span class="p">(</span><span class="n">port</span> <span class="o">=</span> <span class="mi">9051</span><span class="p">)</span> <span class="k">as</span> <span class="n">controller</span><span class="p">:</span>
  <span class="c"># do my stuff</span>
</pre></div>
</div>
<p>... is equivalent to...</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">controller</span> <span class="o">=</span> <span class="n">Controller</span><span class="o">.</span><span class="n">from_port</span><span class="p">(</span><span class="n">port</span> <span class="o">=</span> <span class="mi">9051</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
  <span class="c"># do my stuff</span>
<span class="k">finally</span><span class="p">:</span>
  <span class="n">controller</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>This helps to make sure that regardless of if your code raises an exception or
not the control connection will be cleaned up afterward. Note that this means
that if you leave the 'with' scope your <a class="reference internal" href="api/control.html#stem.control.Controller" title="stem.control.Controller"><tt class="xref py py-class docutils literal"><span class="pre">Controller</span></tt></a> will
be closed. The following for instance is a bug common when first learning
Stem...</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">BandwidthReporter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>

  <span class="k">def</span> <span class="nf">print_bandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">bytes_read</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="s">&quot;traffic/read&quot;</span><span class="p">)</span>
    <span class="n">bytes_written</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="s">&quot;traffic/written&quot;</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;My Tor relay has read </span><span class="si">%s</span><span class="s"> bytes and written </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bytes_read</span><span class="p">,</span> <span class="n">bytes_written</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="k">with</span> <span class="n">Controller</span><span class="o">.</span><span class="n">from_port</span><span class="p">(</span><span class="n">port</span> <span class="o">=</span> <span class="mi">9051</span><span class="p">)</span> <span class="k">as</span> <span class="n">controller</span><span class="p">:</span>
    <span class="n">reporter</span> <span class="o">=</span> <span class="n">BandwidthReporter</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

  <span class="c"># The following line is broken because the &#39;controller&#39; we initialised</span>
  <span class="c"># above was disconnected once we left the &#39;with&#39; scope. To fix this the</span>
  <span class="c"># print_bandwidth() call should be in the &#39;with&#39; block.</span>

  <span class="n">reporter</span><span class="o">.</span><span class="n">print_bandwidth</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="development">
<h1>Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h1>
<div class="section" id="how-do-i-get-started">
<span id="id18"></span><h2>How do I get started?<a class="headerlink" href="#how-do-i-get-started" title="Permalink to this headline">¶</a></h2>
<p>The best way of getting involved with any project is to jump right in! Our <a class="reference external" href="https://trac.torproject.org/projects/tor/wiki/doc/stem/bugs">bug
tracker</a> lists
several development tasks. In particular look for the 'easy' keyword when
getting started. If you have any questions then I'm always more than happy to
help! I'm <strong>atagar</strong> on <a class="reference external" href="http://www.oftc.net/">oftc</a> and also available
<a class="reference external" href="https://www.atagar.com/contact/">via email</a>.</p>
<p>To start hacking on Stem please do the following and don't hesitate to let me
know if you get stuck or would like to discuss anything!</p>
<ol class="arabic simple">
<li>Clone our <a class="reference external" href="http://git-scm.com/">git</a> repository: <strong>git clone https://git.torproject.org/stem.git</strong></li>
<li>Get our test dependencies: <strong>sudo pip install mock pycodestyle pyflakes</strong>.</li>
<li>Find a <a class="reference external" href="https://trac.torproject.org/projects/tor/wiki/doc/stem/bugs">bug or feature</a> that sounds interesting.</li>
<li>When you have something that you would like to contribute back do the following...</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>If you don't already have a publicly accessible Stem repository then set one up. <a class="reference external" href="https://github.com/">GitHub</a> in particular is great for this.</li>
<li>File a <a class="reference external" href="https://trac.torproject.org/projects/tor/newticket">trac ticket</a>, the only fields you'll need are...</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Summary: short description of your change</li>
<li>Description: longer description and a link to your repository with either the git commits or branch that has your change</li>
<li>Type: 'defect' if this is a bug fix and 'enhancement' otherwise</li>
<li>Priority: rough guess at the priority of your change</li>
<li>Component: Core Tor / Stem</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>I'll review the change and give suggestions. When we're both happy with it I'll push your change to the official repository.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="how-do-i-run-the-tests">
<span id="id19"></span><h2>How do I run the tests?<a class="headerlink" href="#how-do-i-run-the-tests" title="Permalink to this headline">¶</a></h2>
<p>Stem has three kinds of tests: <strong>unit</strong>, <strong>integration</strong>, and <strong>static</strong>.</p>
<p><strong>Unit</strong> tests are our most frequently ran tests. They're quick, they're easy,
and provide good test coverage...</p>
<div class="highlight-python"><pre>~$ cd stem/
~/stem$ ./run_tests.py --unit</pre>
</div>
<p><strong>Integration</strong> tests start a live Tor instance and test against that. This not
only provides additional test coverage, but lets us check our continued
interoperability with new releases of Tor. Running these require that you have
<a class="reference external" href="https://www.torproject.org/download/download.html.en">Tor installed</a>. You
can exercise alternate Tor configurations with the <tt class="docutils literal"><span class="pre">--target</span></tt> argument (see
<tt class="docutils literal"><span class="pre">run_tests.py</span> <span class="pre">--help</span></tt> for a list of its options).</p>
<div class="highlight-python"><pre>~/stem$ ./run_tests.py --integ
~/stem$ ./run_tests.py --integ --tor /path/to/tor
~/stem$ ./run_tests.py --integ --target RUN_COOKIE</pre>
</div>
<p><strong>Static</strong> tests use <a class="reference external" href="https://launchpad.net/pyflakes">pyflakes</a> to do static
error checking and <a class="reference external" href="http://pycodestyle.readthedocs.org/en/latest/">pycodestyle</a> for style checking. If you
have them installed then they automatically take place as part of all test
runs.</p>
<p>See <tt class="docutils literal"><span class="pre">run_tests.py</span> <span class="pre">--help</span></tt> for more usage information.</p>
</div>
<div class="section" id="how-can-i-test-compatibility-with-multiple-python-versions">
<span id="how-do-i-test-compatibility-with-multiple-python-versions"></span><h2>How can I test compatibility with multiple python versions?<a class="headerlink" href="#how-can-i-test-compatibility-with-multiple-python-versions" title="Permalink to this headline">¶</a></h2>
<p>Stem supports python versions 2.6 and above, including the 3.x series. You can
test all versions of python you currently have installed on your system with
<a class="reference external" href="https://testrun.org/tox/">tox</a>. If you're using a Debian based system this
can be as simple as...</p>
<div class="highlight-python"><pre>~/stem$ sudo apt-get install python-tox python2.7 python3.3 python-dev python3-dev
~/stem$ tox
...
____ summary _____
  py27: commands succeeded
  py33: commands succeeded</pre>
</div>
<p>Tox fetches Stem's dependencies for each version of python. One of these
dependencies is pycrypto which requires <strong>python-dev</strong> (or <strong>python3-dev</strong> if
testing with python3).</p>
<p>Tox also allows you to customize the underlying commands and environments. For
example...</p>
<div class="highlight-python"><pre># run the tests with just python 2.6
~/stem$ tox -e py26

# pass arguments to 'run_tests.py'
~/stem$ tox -e py26 -- -u --test response.events</pre>
</div>
</div>
<div class="section" id="how-do-i-build-the-site">
<span id="id20"></span><h2>How do I build the site?<a class="headerlink" href="#how-do-i-build-the-site" title="Permalink to this headline">¶</a></h2>
<p>If you have <a class="reference external" href="http://sphinx-doc.org/">Sphinx</a> version 1.1 or later installed
then building our site is as easy as...</p>
<div class="highlight-python"><pre>~$ cd stem/docs
~/stem/docs$ make html</pre>
</div>
<p>When it's finished you can direct your browser to the <em>_build</em> directory with a
URI similar to...</p>
<div class="highlight-python"><pre>file:///home/atagar/stem/docs/_build/html/index.html</pre>
</div>
</div>
<div class="section" id="what-is-the-copyright-for-patches">
<span id="id21"></span><h2>What is the copyright for patches?<a class="headerlink" href="#what-is-the-copyright-for-patches" title="Permalink to this headline">¶</a></h2>
<p>Stem is under the LGPLv3 which is a fine license, but poses a bit of a problem
for sharing code with our other projects (which are mostly BSD). To share code
without needing to hunt down prior contributors we need Tor to have the
copyright for the whole Stem codebase. Presently the copyright of Stem is
jointly held by its main author (<a class="reference external" href="https://www.atagar.com/">Damian</a>) and the
<a class="reference external" href="https://www.torproject.org/">Tor Project</a>.</p>
<p>If you submit a substantial patch I'll ask if you're fine with it being in the
public domain. This would mean that there are no legal restrictions for using
your contribution, and hence won't pose a problem if we reuse Stem code in
other projects.</p>
</div>
</div>


      </div>
      <div class="bottomnav">
      </div>

    <div class="footer">
    </div>
  </body>
</html>