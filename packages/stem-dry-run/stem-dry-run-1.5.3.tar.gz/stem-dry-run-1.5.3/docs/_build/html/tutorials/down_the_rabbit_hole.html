

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Down the Rabbit Hole &mdash; Stem 1.5.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.5.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="top" title="Stem 1.5.2 documentation" href="../index.html" /> 
  </head>
  <body>
      <div class="header"><img class="rightlogo" src="../_static/logo.png" alt="Logo"/><h1 class="heading"><a href="../index.html">
          <span>Stem Docs</span></a></h1>
        <h2 class="heading"><span>Down the Rabbit Hole</span></h2>
      </div>
      <div class="topnav">
      
        <p>

        <ul id="navbar">
          <li><a href="../index.html">Home</a></li>
          <li><a href="../tutorials.html">Tutorials</a>
            <ul>
              <li><a href="the_little_relay_that_could.html">Hello World</a></li>
              <li><a href="to_russia_with_love.html">Client Usage</a></li>
              <li><a href="tortoise_and_the_hare.html">Event Listening</a></li>
              <li><a href="over_the_river.html">Hidden Services</a></li>
              <li><a href="mirror_mirror_on_the_wall.html">Tor Descriptors</a></li>
              <li><a href="east_of_the_sun.html">Utilities</a></li>
              <li><a href="#">Interpreter</a></li>
              <li><a href="double_double_toil_and_trouble.html">Examples</a></li>
            </ul>
          </li>
          <li><a href="../api.html">API</a>
            <ul>
              <li><a href="../api/control.html">stem.control</a></li>
              <li><a href="../api/connection.html">stem.connection</a></li>
              <li><a href="../api/socket.html">stem.socket</a></li>
              <li><a href="../api/process.html">stem.process</a></li>
              <li><a href="../api/response.html">stem.response</a></li>
              <li><a href="../api/exit_policy.html">stem.exit_policy</a></li>
              <li><a href="../api/version.html">stem.version</a></li>
              <li><a href="../api.html#descriptors">Descriptors</a></li>
              <li><a href="../api.html#utilities">Utilities</a></li>
            </ul>
          </li>
          <li><a href="https://trac.torproject.org/projects/tor/wiki/doc/stem">Development</a>
            <ul>
              <li><a href="../faq.html">FAQ</a></li>
              <li><a href="../change_log.html">Change Log</a></li>
              <li><a href="https://trac.torproject.org/projects/tor/wiki/doc/stem/bugs">Bug Tracker</a></li>
              <li><a href="https://trac.torproject.org/projects/tor/wiki/doc/stem">Wiki</a></li>
              <li><a href="../download.html">Download</a></li>
            </ul>
          </li>
          <li><a href="../faq.html#where-can-i-get-help">Contact</a>
            <ul>
              <li><a href="https://lists.torproject.org/cgi-bin/mailman/listinfo/tor-dev">Email List</a></li>
              <li><a href="https://www.torproject.org/about/contact.html.en#irc">IRC</a></li>
              <li><a href="https://www.atagar.com/contact/">Author</a></li>
            </ul>
          </li>
        </ul>
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="down-the-rabbit-hole">
<h1>Down the Rabbit Hole<a class="headerlink" href="#down-the-rabbit-hole" title="Permalink to this headline">¶</a></h1>
<p>Underneath it all Stem is a Python implementation of Tor's <a class="reference external" href="https://gitweb.torproject.org/torspec.git/tree/control-spec.txt">control</a> and
<a class="reference external" href="https://gitweb.torproject.org/torspec.git/tree/dir-spec.txt">directory specifications</a>.
Anything you can do with Stem you can also do <a class="reference external" href="../faq.html#can-i-interact-with-tors-controller-interface-directly">with telnet</a> (albeit
with quite a bit of extra work).</p>
<p>Playing with Tor's control port directly is a great way of learning what
Tor can and cannot do. This is handy because Stem can take advantage of
anything the control interface offers, but conversely is also limited by
things it lacks.</p>
<p>To help Stem offers a control prompt with nice usability improvements over
telnet...</p>
<ul class="simple">
<li>Irc-style commands like '<strong>/help</strong>'.</li>
<li>Is a <strong>python interpreter</strong> (like IDLE).</li>
<li>Tab completion for Tor's controller commands.</li>
<li>History scrollback by pressing up/down.</li>
<li>Transparently handles Tor authentication at startup.</li>
<li>Colorized output for improved readability.</li>
</ul>
<div class="section" id="getting-started">
<span id="id1"></span><h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>Getting started with the control prompt is easy. Assuming you have Stem
installed it will be available under <strong>/usr/local/bin/tor-prompt</strong>, and can
attach to either an existing Tor instance or start one of its own.</p>
<p>If Tor's already running <a class="reference external" href="the_little_relay_that_could.html">with a control port</a> then you can attach to it using
<strong>--interface</strong> or <strong>--socket</strong> (by default it checks on <strong>port 9051</strong>)...</p>
<img alt="../_images/attach.png" src="../_images/attach.png" />
<p>If Tor isn't running this prompt will start a temporary instance of its own.
Tor will have a minimal non-relaying configuration, and be shut down when
you're done.</p>
<img alt="../_images/starting_tor.png" src="../_images/starting_tor.png" />
</div>
<div class="section" id="what-can-i-do-with-it">
<span id="id2"></span><h2>What can I do with it?<a class="headerlink" href="#what-can-i-do-with-it" title="Permalink to this headline">¶</a></h2>
<p>This prompt accepts three types of commands...</p>
<ul class="simple">
<li>Commands for the interpreter itself, such as <strong>/help</strong> and <strong>/info</strong>. These
are handled by the interpreter and always begin with a slash.</li>
<li>Commands for Tor's control port, such as <strong>GETINFO version</strong> and <strong>GETCONF
ExitPolicy</strong>. These are passed along directly to Tor.</li>
<li>Commands that do not match either of the above are treated as Python.</li>
</ul>
<p>To get a list of the interpreter and Tor commands run <strong>/help</strong>. You can also
run <strong>/help [command]</strong> (such as <strong>/help SIGNAL</strong>) to get details on what
does...</p>
<img alt="../_images/help.png" src="../_images/help.png" />
<p>Another useful interpreter command is <strong>/info [relay]</strong> which provides
information about a relay. With this you can look up details about any relay by
its IP address, fingerprint, or nickname...</p>
<img alt="../_images/info.png" src="../_images/info.png" />
<p>Tor commands are passed along directly to Tor's control port, providing raw
responses just as telnet would...</p>
<img alt="../_images/tor_commands.png" src="../_images/tor_commands.png" />
<p>And last but certainly not least this prompt provides a Python interpreter,
just like IDLE. You start with a <a class="reference internal" href="../api/control.html#stem.control.Controller" title="stem.control.Controller"><tt class="xref py py-class docutils literal"><span class="pre">Controller</span></tt></a> for you Tor
instance available as your <strong>controller</strong> variable. This makes it easy to
experiment with Stem and see what it can do...</p>
<img alt="../_images/python.png" src="../_images/python.png" />
</div>
<div class="section" id="event-handling">
<span id="id3"></span><h2>Event handling<a class="headerlink" href="#event-handling" title="Permalink to this headline">¶</a></h2>
<p>As mentioned in an <a class="reference external" href="tortoise_and_the_hare.html">earlier tutorial</a> you can
subscribe to receive events from Tor. Stem's <a class="reference internal" href="../api/control.html#stem.control.Controller" title="stem.control.Controller"><tt class="xref py py-class docutils literal"><span class="pre">Controller</span></tt></a>
does this with its <a class="reference internal" href="../api/control.html#stem.control.Controller.add_event_listener" title="stem.control.Controller.add_event_listener"><tt class="xref py py-func docutils literal"><span class="pre">add_event_listener()</span></tt></a> method,
but with our raw Tor access we can also subscribe with <strong>SETEVENTS [event
types]</strong>.</p>
<p>Events we've received are available in two different ways. First, <strong>/events</strong>
provides a quick dump of the events we've received thus far...</p>
<img alt="../_images/events_command.png" src="../_images/events_command.png" />
<p>You can list events of just a certain type by saying which (for instance
<strong>/events BW</strong>). More useful though is the <strong>events()</strong> function, which
provides a list of <a class="reference internal" href="../api/response.html#stem.response.events.Event" title="stem.response.events.Event"><tt class="xref py py-class docutils literal"><span class="pre">Event</span></tt></a> instances we've
received...</p>
<img alt="../_images/events_variable.png" src="../_images/events_variable.png" />
<p>You can specify event types to either <strong>/events</strong> or <strong>events()</strong> to just
receive events of those types (for instance, <strong>events('BW', 'DEBUG')</strong>).</p>
<p>To stop receiving events run <strong>SETEVENTS</strong> without any event types, and to
clear the backlog of events we've received run <strong>/events clear</strong>.</p>
</div>
</div>


      </div>
      <div class="bottomnav">
      </div>

    <div class="footer">
    </div>
  </body>
</html>