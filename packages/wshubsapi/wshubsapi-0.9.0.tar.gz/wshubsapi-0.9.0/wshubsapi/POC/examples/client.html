<html>
<head>
    <title>WebSocket example</title>
    <!--File auto-generated by the server.
    Path needs to match with Hub.construct_js_file path parameter-->
    <script type="text/javascript" src="client_api/hubsApi.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.4.2.js"></script>
</head>
<body>
<div>
    <h1>WebSocket example with WSHubsAPI</h1>
    <hr>
    WebSocket status : <span id="status">Waiting connection</span><br>
    Name: <input type="text" id="name" value="Kevin"/><br>
    <input type="text" id="message"/>
    <input type="button" id="post" value="Post"/>
    <ul id="discussion">
    </ul>
</div>
<script>
    var hubsApi = new HubsAPI('ws://127.0.0.1:8888/');
    function postMessage() {
        var name = $('#name').val(),
            message = $('#message').val();

        hubsApi.ForumHub.server.publishMessage(name, message)
            .then(function (serverReplay) {
                console.log("Server replayed:  " + serverReplay);
            });
        $('#message').val('').focus();
    }

    hubsApi.connect().then(function () {
        $('#status').text("Connected");
    });
    hubsApi.ForumHub.client.messagePublished = function (from, message) {
        $('#discussion').append('<li><strong>' + from
            + '</strong>: ' + message + '</li>');
    };

    $('#post').click(postMessage);
</script>
</body>
</html>